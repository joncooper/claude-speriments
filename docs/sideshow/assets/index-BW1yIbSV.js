(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const yp=()=>{};var ul={};const lh=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e},Tp=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const s=n[t++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=n[t++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=n[t++],a=n[t++],l=n[t++],u=((s&7)<<18|(i&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const i=n[t++],a=n[t++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|a&63)}}return e.join("")},uh={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const i=n[s],a=s+1<n.length,l=a?n[s+1]:0,u=s+2<n.length,d=u?n[s+2]:0,f=i>>2,g=(i&3)<<4|l>>4;let T=(l&15)<<2|d>>6,S=d&63;u||(S=64,a||(T=64)),r.push(t[f],t[g],t[T],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(lh(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Tp(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const i=t[n.charAt(s++)],l=s<n.length?t[n.charAt(s)]:0;++s;const d=s<n.length?t[n.charAt(s)]:64;++s;const g=s<n.length?t[n.charAt(s)]:64;if(++s,i==null||l==null||d==null||g==null)throw new Ep;const T=i<<2|l>>4;if(r.push(T),d!==64){const S=l<<4&240|d>>2;if(r.push(S),g!==64){const P=d<<6&192|g;r.push(P)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Ep extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const wp=function(n){const e=lh(n);return uh.encodeByteArray(e,!0)},Pi=function(n){return wp(n).replace(/\./g,"")},hh=function(n){try{return uh.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Ip(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const vp=()=>Ip().__FIREBASE_DEFAULTS__,Ap=()=>{if(typeof process>"u"||typeof ul>"u")return;const n=ul.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},bp=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&hh(n[1]);return e&&JSON.parse(e)},Zi=()=>{try{return yp()||vp()||Ap()||bp()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},dh=n=>Zi()?.emulatorHosts?.[n],Rp=n=>{const e=dh(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},fh=()=>Zi()?.config,ph=n=>Zi()?.[`_${n}`];class Sp{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function br(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function gh(n){return(await fetch(n,{credentials:"include"})).ok}function kp(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",s=n.iat||0,i=n.sub||n.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Pi(JSON.stringify(t)),Pi(JSON.stringify(a)),""].join(".")}const fs={};function Cp(){const n={prod:[],emulator:[]};for(const e of Object.keys(fs))fs[e]?n.emulator.push(e):n.prod.push(e);return n}function Pp(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let hl=!1;function mh(n,e){if(typeof window>"u"||typeof document>"u"||!br(window.location.host)||fs[n]===e||fs[n]||hl)return;fs[n]=e;function t(T){return`__firebase__banner__${T}`}const r="__firebase__banner",i=Cp().prod.length>0;function a(){const T=document.getElementById(r);T&&T.remove()}function l(T){T.style.display="flex",T.style.background="#7faaf0",T.style.position="fixed",T.style.bottom="5px",T.style.left="5px",T.style.padding=".5em",T.style.borderRadius="5px",T.style.alignItems="center"}function u(T,S){T.setAttribute("width","24"),T.setAttribute("id",S),T.setAttribute("height","24"),T.setAttribute("viewBox","0 0 24 24"),T.setAttribute("fill","none"),T.style.marginLeft="-6px"}function d(){const T=document.createElement("span");return T.style.cursor="pointer",T.style.marginLeft="16px",T.style.fontSize="24px",T.innerHTML=" &times;",T.onclick=()=>{hl=!0,a()},T}function f(T,S){T.setAttribute("id",S),T.innerText="Learn more",T.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",T.setAttribute("target","__blank"),T.style.paddingLeft="5px",T.style.textDecoration="underline"}function g(){const T=Pp(r),S=t("text"),P=document.getElementById(S)||document.createElement("span"),V=t("learnmore"),x=document.getElementById(V)||document.createElement("a"),j=t("preprendIcon"),G=document.getElementById(j)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(T.created){const W=T.element;l(W),f(x,V);const ee=d();u(G,j),W.append(G,P,x,ee),document.body.appendChild(W)}i?(P.innerText="Preview backend disconnected.",G.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(G.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,P.innerText="Preview backend running in this workspace."),P.setAttribute("id",S)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",g):g()}function Be(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Dp(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Be())}function Np(){const n=Zi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function xp(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Op(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Vp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Lp(){const n=Be();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Mp(){return!Np()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Up(){try{return typeof indexedDB=="object"}catch{return!1}}function Fp(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{e(s.error?.message||"")}}catch(t){e(t)}})}const $p="FirebaseError";class Wt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=$p,Object.setPrototypeOf(this,Wt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ps.prototype.create)}}class Ps{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},s=`${this.service}/${e}`,i=this.errors[e],a=i?Bp(i,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new Wt(s,l,r)}}function Bp(n,e){return n.replace(qp,(t,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const qp=/\{\$([^}]+)}/g;function zp(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function jn(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const s of t){if(!r.includes(s))return!1;const i=n[s],a=e[s];if(dl(i)&&dl(a)){if(!jn(i,a))return!1}else if(i!==a)return!1}for(const s of r)if(!t.includes(s))return!1;return!0}function dl(n){return n!==null&&typeof n=="object"}function Ds(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function jp(n,e){const t=new Hp(n,e);return t.subscribe.bind(t)}class Hp{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let s;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Gp(e,["next","error","complete"])?s=e:s={next:e,error:t,complete:r},s.next===void 0&&(s.next=Vo),s.error===void 0&&(s.error=Vo),s.complete===void 0&&(s.complete=Vo);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Gp(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Vo(){}function Le(n){return n&&n._delegate?n._delegate:n}class Hn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Fn="[DEFAULT]";class Wp{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Sp;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){const t=this.normalizeInstanceIdentifier(e?.identifier),r=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Qp(e))try{this.getOrInitializeService({instanceIdentifier:Fn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Fn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Fn){return this.instances.has(e)}getOptions(e=Fn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(i);r===l&&a.resolve(s)}return s}onInit(e,t){const r=this.normalizeInstanceIdentifier(t),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const s of r)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Kp(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Fn){return this.component?this.component.multipleInstances?e:Fn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Kp(n){return n===Fn?void 0:n}function Qp(n){return n.instantiationMode==="EAGER"}class Yp{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Wp(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var Y;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Y||(Y={}));const Xp={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},Jp=Y.INFO,Zp={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},eg=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),s=Zp[e];if(s)console[s](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Da{constructor(e){this.name=e,this._logLevel=Jp,this._logHandler=eg,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Y))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Xp[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...e),this._logHandler(this,Y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...e),this._logHandler(this,Y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...e),this._logHandler(this,Y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...e),this._logHandler(this,Y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...e),this._logHandler(this,Y.ERROR,...e)}}const tg=(n,e)=>e.some(t=>n instanceof t);let fl,pl;function ng(){return fl||(fl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rg(){return pl||(pl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const _h=new WeakMap,Zo=new WeakMap,yh=new WeakMap,Lo=new WeakMap,Na=new WeakMap;function sg(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",a)},i=()=>{t(un(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&_h.set(t,n)}).catch(()=>{}),Na.set(e,n),e}function ig(n){if(Zo.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",a),n.removeEventListener("abort",a)},i=()=>{t(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",a),n.addEventListener("abort",a)});Zo.set(n,e)}let ea={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Zo.get(n);if(e==="objectStoreNames")return n.objectStoreNames||yh.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return un(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function og(n){ea=n(ea)}function ag(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Mo(this),e,...t);return yh.set(r,e.sort?e.sort():[e]),un(r)}:rg().includes(n)?function(...e){return n.apply(Mo(this),e),un(_h.get(this))}:function(...e){return un(n.apply(Mo(this),e))}}function cg(n){return typeof n=="function"?ag(n):(n instanceof IDBTransaction&&ig(n),tg(n,ng())?new Proxy(n,ea):n)}function un(n){if(n instanceof IDBRequest)return sg(n);if(Lo.has(n))return Lo.get(n);const e=cg(n);return e!==n&&(Lo.set(n,e),Na.set(e,n)),e}const Mo=n=>Na.get(n);function lg(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const a=indexedDB.open(n,e),l=un(a);return r&&a.addEventListener("upgradeneeded",u=>{r(un(a.result),u.oldVersion,u.newVersion,un(a.transaction),u)}),t&&a.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),l.then(u=>{i&&u.addEventListener("close",()=>i()),s&&u.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const ug=["get","getKey","getAll","getAllKeys","count"],hg=["put","add","delete","clear"],Uo=new Map;function gl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Uo.get(e))return Uo.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=hg.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ug.includes(t)))return;const i=async function(a,...l){const u=this.transaction(a,s?"readwrite":"readonly");let d=u.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[t](...l),s&&u.done]))[0]};return Uo.set(e,i),i}og(n=>({...n,get:(e,t,r)=>gl(e,t)||n.get(e,t,r),has:(e,t)=>!!gl(e,t)||n.has(e,t)}));class dg{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(fg(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function fg(n){return n.getComponent()?.type==="VERSION"}const ta="@firebase/app",ml="0.14.5";const qt=new Da("@firebase/app"),pg="@firebase/app-compat",gg="@firebase/analytics-compat",mg="@firebase/analytics",_g="@firebase/app-check-compat",yg="@firebase/app-check",Tg="@firebase/auth",Eg="@firebase/auth-compat",wg="@firebase/database",Ig="@firebase/data-connect",vg="@firebase/database-compat",Ag="@firebase/functions",bg="@firebase/functions-compat",Rg="@firebase/installations",Sg="@firebase/installations-compat",kg="@firebase/messaging",Cg="@firebase/messaging-compat",Pg="@firebase/performance",Dg="@firebase/performance-compat",Ng="@firebase/remote-config",xg="@firebase/remote-config-compat",Og="@firebase/storage",Vg="@firebase/storage-compat",Lg="@firebase/firestore",Mg="@firebase/ai",Ug="@firebase/firestore-compat",Fg="firebase",$g="12.5.0";const na="[DEFAULT]",Bg={[ta]:"fire-core",[pg]:"fire-core-compat",[mg]:"fire-analytics",[gg]:"fire-analytics-compat",[yg]:"fire-app-check",[_g]:"fire-app-check-compat",[Tg]:"fire-auth",[Eg]:"fire-auth-compat",[wg]:"fire-rtdb",[Ig]:"fire-data-connect",[vg]:"fire-rtdb-compat",[Ag]:"fire-fn",[bg]:"fire-fn-compat",[Rg]:"fire-iid",[Sg]:"fire-iid-compat",[kg]:"fire-fcm",[Cg]:"fire-fcm-compat",[Pg]:"fire-perf",[Dg]:"fire-perf-compat",[Ng]:"fire-rc",[xg]:"fire-rc-compat",[Og]:"fire-gcs",[Vg]:"fire-gcs-compat",[Lg]:"fire-fst",[Ug]:"fire-fst-compat",[Mg]:"fire-vertex","fire-js":"fire-js",[Fg]:"fire-js-all"};const Di=new Map,qg=new Map,ra=new Map;function _l(n,e){try{n.container.addComponent(e)}catch(t){qt.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function mr(n){const e=n.name;if(ra.has(e))return qt.debug(`There were multiple attempts to register component ${e}.`),!1;ra.set(e,n);for(const t of Di.values())_l(t,n);for(const t of qg.values())_l(t,n);return!0}function xa(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function lt(n){return n==null?!1:n.settings!==void 0}const zg={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hn=new Ps("app","Firebase",zg);class jg{constructor(e,t,r){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Hn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw hn.create("app-deleted",{appName:this._name})}}const Rr=$g;function Th(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r={name:na,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw hn.create("bad-app-name",{appName:String(s)});if(t||(t=fh()),!t)throw hn.create("no-options");const i=Di.get(s);if(i){if(jn(t,i.options)&&jn(r,i.config))return i;throw hn.create("duplicate-app",{appName:s})}const a=new Yp(s);for(const u of ra.values())a.addComponent(u);const l=new jg(t,r,a);return Di.set(s,l),l}function Eh(n=na){const e=Di.get(n);if(!e&&n===na&&fh())return Th();if(!e)throw hn.create("no-app",{appName:n});return e}function dn(n,e,t){let r=Bg[n]??n;t&&(r+=`-${t}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&a.push("and"),i&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),qt.warn(a.join(" "));return}mr(new Hn(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}const Hg="firebase-heartbeat-database",Gg=1,Es="firebase-heartbeat-store";let Fo=null;function wh(){return Fo||(Fo=lg(Hg,Gg,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Es)}catch(t){console.warn(t)}}}}).catch(n=>{throw hn.create("idb-open",{originalErrorMessage:n.message})})),Fo}async function Wg(n){try{const t=(await wh()).transaction(Es),r=await t.objectStore(Es).get(Ih(n));return await t.done,r}catch(e){if(e instanceof Wt)qt.warn(e.message);else{const t=hn.create("idb-get",{originalErrorMessage:e?.message});qt.warn(t.message)}}}async function yl(n,e){try{const r=(await wh()).transaction(Es,"readwrite");await r.objectStore(Es).put(e,Ih(n)),await r.done}catch(t){if(t instanceof Wt)qt.warn(t.message);else{const r=hn.create("idb-set",{originalErrorMessage:t?.message});qt.warn(r.message)}}}function Ih(n){return`${n.name}!${n.options.appId}`}const Kg=1024,Qg=30;class Yg{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Jg(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const t=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Tl();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:t}),this._heartbeatsCache.heartbeats.length>Qg){const s=Zg(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){qt.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Tl(),{heartbeatsToSend:t,unsentEntries:r}=Xg(this._heartbeatsCache.heartbeats),s=Pi(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return qt.warn(e),""}}}function Tl(){return new Date().toISOString().substring(0,10)}function Xg(n,e=Kg){const t=[];let r=n.slice();for(const s of n){const i=t.find(a=>a.agent===s.agent);if(i){if(i.dates.push(s.date),El(t)>e){i.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),El(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Jg{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Up()?Fp().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Wg(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return yl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return yl(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function El(n){return Pi(JSON.stringify({version:2,heartbeats:n})).length}function Zg(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}function em(n){mr(new Hn("platform-logger",e=>new dg(e),"PRIVATE")),mr(new Hn("heartbeat",e=>new Yg(e),"PRIVATE")),dn(ta,ml,n),dn(ta,ml,"esm2020"),dn("fire-js","")}em("");function vh(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const tm=vh,Ah=new Ps("auth","Firebase",vh());const Ni=new Da("@firebase/auth");function nm(n,...e){Ni.logLevel<=Y.WARN&&Ni.warn(`Auth (${Rr}): ${n}`,...e)}function Ti(n,...e){Ni.logLevel<=Y.ERROR&&Ni.error(`Auth (${Rr}): ${n}`,...e)}function Rt(n,...e){throw Va(n,...e)}function ht(n,...e){return Va(n,...e)}function Oa(n,e,t){const r={...tm(),[e]:t};return new Ps("auth","Firebase",r).create(e,{appName:n.name})}function qn(n){return Oa(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function rm(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Rt(n,"argument-error"),Oa(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Va(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Ah.create(n,...e)}function B(n,e,...t){if(!n)throw Va(e,...t)}function Ft(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Ti(e),new Error(e)}function zt(n,e){n||Ft(e)}function sa(){return typeof self<"u"&&self.location?.href||""}function sm(){return wl()==="http:"||wl()==="https:"}function wl(){return typeof self<"u"&&self.location?.protocol||null}function im(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(sm()||Op()||"connection"in navigator)?navigator.onLine:!0}function om(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Ns{constructor(e,t){this.shortDelay=e,this.longDelay=t,zt(t>e,"Short delay should be less than long delay!"),this.isMobile=Dp()||Vp()}get(){return im()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function La(n,e){zt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class bh{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ft("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ft("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ft("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const am={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const cm=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],lm=new Ns(3e4,6e4);function Ma(n,e){return n.tenantId&&!e.tenantId?{...e,tenantId:n.tenantId}:e}async function Sr(n,e,t,r,s={}){return Rh(n,s,async()=>{let i={},a={};r&&(e==="GET"?a=r:i={body:JSON.stringify(r)});const l=Ds({key:n.config.apiKey,...a}).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const d={method:e,headers:u,...i};return xp()||(d.referrerPolicy="no-referrer"),n.emulatorConfig&&br(n.emulatorConfig.host)&&(d.credentials="include"),bh.fetch()(await Sh(n,n.config.apiHost,t,l),d)})}async function Rh(n,e,t){n._canInitEmulator=!1;const r={...am,...e};try{const s=new hm(n),i=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const a=await i.json();if("needConfirmation"in a)throw ui(n,"account-exists-with-different-credential",a);if(i.ok&&!("errorMessage"in a))return a;{const l=i.ok?a.errorMessage:a.error.message,[u,d]=l.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw ui(n,"credential-already-in-use",a);if(u==="EMAIL_EXISTS")throw ui(n,"email-already-in-use",a);if(u==="USER_DISABLED")throw ui(n,"user-disabled",a);const f=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(d)throw Oa(n,f,d);Rt(n,f)}}catch(s){if(s instanceof Wt)throw s;Rt(n,"network-request-failed",{message:String(s)})}}async function um(n,e,t,r,s={}){const i=await Sr(n,e,t,r,s);return"mfaPendingCredential"in i&&Rt(n,"multi-factor-auth-required",{_serverResponse:i}),i}async function Sh(n,e,t,r){const s=`${e}${t}?${r}`,i=n,a=i.config.emulator?La(n.config,s):`${n.config.apiScheme}://${s}`;return cm.includes(t)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(a).toString():a}class hm{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(ht(this.auth,"network-request-failed")),lm.get())})}}function ui(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const s=ht(n,e,r);return s.customData._tokenResponse=t,s}async function dm(n,e){return Sr(n,"POST","/v1/accounts:delete",e)}async function xi(n,e){return Sr(n,"POST","/v1/accounts:lookup",e)}function ps(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function fm(n,e=!1){const t=Le(n),r=await t.getIdToken(e),s=Ua(r);B(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,a=i?.sign_in_provider;return{claims:s,token:r,authTime:ps($o(s.auth_time)),issuedAtTime:ps($o(s.iat)),expirationTime:ps($o(s.exp)),signInProvider:a||null,signInSecondFactor:i?.sign_in_second_factor||null}}function $o(n){return Number(n)*1e3}function Ua(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Ti("JWT malformed, contained fewer than 3 sections"),null;try{const s=hh(t);return s?JSON.parse(s):(Ti("Failed to decode base64 JWT payload"),null)}catch(s){return Ti("Caught error parsing JWT payload as JSON",s?.toString()),null}}function Il(n){const e=Ua(n);return B(e,"internal-error"),B(typeof e.exp<"u","internal-error"),B(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function ws(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Wt&&pm(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function pm({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class gm{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const t=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),t}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ia{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ps(this.lastLoginAt),this.creationTime=ps(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Oi(n){const e=n.auth,t=await n.getIdToken(),r=await ws(n,xi(e,{idToken:t}));B(r?.users.length,e,"internal-error");const s=r.users[0];n._notifyReloadListener(s);const i=s.providerUserInfo?.length?kh(s.providerUserInfo):[],a=_m(n.providerData,i),l=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!a?.length,d=l?u:!1,f={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new ia(s.createdAt,s.lastLoginAt),isAnonymous:d};Object.assign(n,f)}async function mm(n){const e=Le(n);await Oi(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function _m(n,e){return[...n.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function kh(n){return n.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function ym(n,e){const t=await Rh(n,{},async()=>{const r=Ds({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=n.config,a=await Sh(n,s,"/v1/token",`key=${i}`),l=await n._getAdditionalHeaders();l["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:l,body:r};return n.emulatorConfig&&br(n.emulatorConfig.host)&&(u.credentials="include"),bh.fetch()(a,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Tm(n,e){return Sr(n,"POST","/v2/accounts:revokeToken",Ma(n,e))}class hr{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){B(e.idToken,"internal-error"),B(typeof e.idToken<"u","internal-error"),B(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Il(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){B(e.length!==0,"internal-error");const t=Il(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(B(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:s,expiresIn:i}=await ym(e,t);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:s,expirationTime:i}=t,a=new hr;return r&&(B(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),s&&(B(typeof s=="string","internal-error",{appName:e}),a.accessToken=s),i&&(B(typeof i=="number","internal-error",{appName:e}),a.expirationTime=i),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new hr,this.toJSON())}_performRefresh(){return Ft("not implemented")}}function sn(n,e){B(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class ut{constructor({uid:e,auth:t,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new gm(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ia(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await ws(this,this.stsTokenManager.getToken(this.auth,e));return B(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return fm(this,e)}reload(){return mm(this)}_assign(e){this!==e&&(B(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>({...t})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new ut({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){B(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Oi(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(lt(this.auth.app))return Promise.reject(qn(this.auth));const e=await this.getIdToken();return await ws(this,dm(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){const r=t.displayName??void 0,s=t.email??void 0,i=t.phoneNumber??void 0,a=t.photoURL??void 0,l=t.tenantId??void 0,u=t._redirectEventId??void 0,d=t.createdAt??void 0,f=t.lastLoginAt??void 0,{uid:g,emailVerified:T,isAnonymous:S,providerData:P,stsTokenManager:V}=t;B(g&&V,e,"internal-error");const x=hr.fromJSON(this.name,V);B(typeof g=="string",e,"internal-error"),sn(r,e.name),sn(s,e.name),B(typeof T=="boolean",e,"internal-error"),B(typeof S=="boolean",e,"internal-error"),sn(i,e.name),sn(a,e.name),sn(l,e.name),sn(u,e.name),sn(d,e.name),sn(f,e.name);const j=new ut({uid:g,auth:e,email:s,emailVerified:T,displayName:r,isAnonymous:S,photoURL:a,phoneNumber:i,tenantId:l,stsTokenManager:x,createdAt:d,lastLoginAt:f});return P&&Array.isArray(P)&&(j.providerData=P.map(G=>({...G}))),u&&(j._redirectEventId=u),j}static async _fromIdTokenResponse(e,t,r=!1){const s=new hr;s.updateFromServerResponse(t);const i=new ut({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Oi(i),i}static async _fromGetAccountInfoResponse(e,t,r){const s=t.users[0];B(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?kh(s.providerUserInfo):[],a=!(s.email&&s.passwordHash)&&!i?.length,l=new hr;l.updateFromIdToken(r);const u=new ut({uid:s.localId,auth:e,stsTokenManager:l,isAnonymous:a}),d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new ia(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!i?.length};return Object.assign(u,d),u}}const vl=new Map;function $t(n){zt(n instanceof Function,"Expected a class definition");let e=vl.get(n);return e?(zt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,vl.set(n,e),e)}class Ch{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Ch.type="NONE";const Al=Ch;function Ei(n,e,t){return`firebase:${n}:${e}:${t}`}class dr{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Ei(this.userKey,s.apiKey,i),this.fullPersistenceKey=Ei("persistence",s.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await xi(this.auth,{idToken:e}).catch(()=>{});return t?ut._fromGetAccountInfoResponse(this.auth,t,e):null}return ut._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new dr($t(Al),e,r);const s=(await Promise.all(t.map(async d=>{if(await d._isAvailable())return d}))).filter(d=>d);let i=s[0]||$t(Al);const a=Ei(r,e.config.apiKey,e.name);let l=null;for(const d of t)try{const f=await d._get(a);if(f){let g;if(typeof f=="string"){const T=await xi(e,{idToken:f}).catch(()=>{});if(!T)break;g=await ut._fromGetAccountInfoResponse(e,T,f)}else g=ut._fromJSON(e,f);d!==i&&(l=g),i=d;break}}catch{}const u=s.filter(d=>d._shouldAllowMigration);return!i._shouldAllowMigration||!u.length?new dr(i,e,r):(i=u[0],l&&await i._set(a,l.toJSON()),await Promise.all(t.map(async d=>{if(d!==i)try{await d._remove(a)}catch{}})),new dr(i,e,r))}}function bl(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(xh(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ph(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Vh(e))return"Blackberry";if(Lh(e))return"Webos";if(Dh(e))return"Safari";if((e.includes("chrome/")||Nh(e))&&!e.includes("edge/"))return"Chrome";if(Oh(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if(r?.length===2)return r[1]}return"Other"}function Ph(n=Be()){return/firefox\//i.test(n)}function Dh(n=Be()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Nh(n=Be()){return/crios\//i.test(n)}function xh(n=Be()){return/iemobile/i.test(n)}function Oh(n=Be()){return/android/i.test(n)}function Vh(n=Be()){return/blackberry/i.test(n)}function Lh(n=Be()){return/webos/i.test(n)}function Fa(n=Be()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Em(n=Be()){return Fa(n)&&!!window.navigator?.standalone}function wm(){return Lp()&&document.documentMode===10}function Mh(n=Be()){return Fa(n)||Oh(n)||Lh(n)||Vh(n)||/windows phone/i.test(n)||xh(n)}function Uh(n,e=[]){let t;switch(n){case"Browser":t=bl(Be());break;case"Worker":t=`${bl(Be())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Rr}/${r}`}class Im{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=i=>new Promise((a,l)=>{try{const u=e(i);a(u)}catch(u){l(u)}});r.onAbort=t,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r?.message})}}}async function vm(n,e={}){return Sr(n,"GET","/v2/passwordPolicy",Ma(n,e))}const Am=6;class bm{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??Am,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),t.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),t.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),t.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),t.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),s&&(t.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class Rm{constructor(e,t,r,s){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Rl(this),this.idTokenSubscription=new Rl(this),this.beforeStateQueue=new Im(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ah,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$t(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await dr.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await xi(this,{idToken:e}),r=await ut._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(lt(this.app)){const i=this.app.settings.authIdToken;return i?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(i).then(a,a))}):this.directlySetCurrentUser(null)}const t=await this.assertedPersistence.getCurrentUser();let r=t,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const i=this.redirectUser?._redirectEventId,a=r?._redirectEventId,l=await this.tryRedirectSignIn(e);(!i||i===a)&&l?.user&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(i){r=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(i))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return B(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Oi(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=om()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(lt(this.app))return Promise.reject(qn(this));const t=e?Le(e):null;return t&&B(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&B(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return lt(this.app)?Promise.reject(qn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return lt(this.app)?Promise.reject(qn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence($t(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await vm(this),t=new bm(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Ps("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Tm(this,r)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$t(e)||this._popupRedirectResolver;B(t,this,"argument-error"),this.redirectPersistenceManager=await dr.create(this,[$t(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,s){if(this._deleted)return()=>{};const i=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(B(l,this,"internal-error"),l.then(()=>{a||i(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,s);return()=>{a=!0,u()}}else{const u=e.addObserver(t);return()=>{a=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return B(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Uh(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){if(lt(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&nm(`Error while retrieving App Check token: ${e.error}`),e?.token}}function eo(n){return Le(n)}class Rl{constructor(e){this.auth=e,this.observer=null,this.addObserver=jp(t=>this.observer=t)}get next(){return B(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let $a={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function Sm(n){$a=n}function km(n){return $a.loadJS(n)}function Cm(){return $a.gapiScript}function Pm(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function Dm(n,e){const t=xa(n,"auth");if(t.isInitialized()){const s=t.getImmediate(),i=t.getOptions();if(jn(i,e??{}))return s;Rt(s,"already-initialized")}return t.initialize({options:e})}function Nm(n,e){const t=e?.persistence||[],r=(Array.isArray(t)?t:[t]).map($t);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e?.popupRedirectResolver)}function xm(n,e,t){const r=eo(n);B(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=Fh(e),{host:a,port:l}=Om(e),u=l===null?"":`:${l}`,d={url:`${i}//${a}${u}/`},f=Object.freeze({host:a,port:l,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){B(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),B(jn(d,r.config.emulator)&&jn(f,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=d,r.emulatorConfig=f,r.settings.appVerificationDisabledForTesting=!0,br(a)?(gh(`${i}//${a}${u}`),mh("Auth",!0)):Vm()}function Fh(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Om(n){const e=Fh(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Sl(r.substr(i.length+1))}}else{const[i,a]=r.split(":");return{host:i,port:Sl(a)}}}function Sl(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Vm(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class $h{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ft("not implemented")}_getIdTokenResponse(e){return Ft("not implemented")}_linkToIdToken(e,t){return Ft("not implemented")}_getReauthenticationResolver(e){return Ft("not implemented")}}async function fr(n,e){return um(n,"POST","/v1/accounts:signInWithIdp",Ma(n,e))}const Lm="http://localhost";class Gn extends $h{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Gn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Rt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=t;if(!r||!s)return null;const a=new Gn(r,s);return a.idToken=i.idToken||void 0,a.accessToken=i.accessToken||void 0,a.secret=i.secret,a.nonce=i.nonce,a.pendingToken=i.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return fr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,fr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fr(e,t)}buildRequest(){const e={requestUri:Lm,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ds(t)}return e}}class Ba{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class xs extends Ba{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class on extends xs{constructor(){super("facebook.com")}static credential(e){return Gn._fromParams({providerId:on.PROVIDER_ID,signInMethod:on.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return on.credentialFromTaggedObject(e)}static credentialFromError(e){return on.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return on.credential(e.oauthAccessToken)}catch{return null}}}on.FACEBOOK_SIGN_IN_METHOD="facebook.com";on.PROVIDER_ID="facebook.com";class Ut extends xs{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Gn._fromParams({providerId:Ut.PROVIDER_ID,signInMethod:Ut.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ut.credentialFromTaggedObject(e)}static credentialFromError(e){return Ut.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ut.credential(t,r)}catch{return null}}}Ut.GOOGLE_SIGN_IN_METHOD="google.com";Ut.PROVIDER_ID="google.com";class an extends xs{constructor(){super("github.com")}static credential(e){return Gn._fromParams({providerId:an.PROVIDER_ID,signInMethod:an.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return an.credentialFromTaggedObject(e)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return an.credential(e.oauthAccessToken)}catch{return null}}}an.GITHUB_SIGN_IN_METHOD="github.com";an.PROVIDER_ID="github.com";class cn extends xs{constructor(){super("twitter.com")}static credential(e,t){return Gn._fromParams({providerId:cn.PROVIDER_ID,signInMethod:cn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return cn.credentialFromTaggedObject(e)}static credentialFromError(e){return cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return cn.credential(t,r)}catch{return null}}}cn.TWITTER_SIGN_IN_METHOD="twitter.com";cn.PROVIDER_ID="twitter.com";class _r{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,s=!1){const i=await ut._fromIdTokenResponse(e,r,s),a=kl(r);return new _r({user:i,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const s=kl(r);return new _r({user:e,providerId:s,_tokenResponse:r,operationType:t})}}function kl(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class Vi extends Wt{constructor(e,t,r,s){super(t.code,t.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Vi.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,s){return new Vi(e,t,r,s)}}function Bh(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Vi._fromErrorAndOperation(n,i,e,r):i})}async function Mm(n,e,t=!1){const r=await ws(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return _r._forOperation(n,"link",r)}async function Um(n,e,t=!1){const{auth:r}=n;if(lt(r.app))return Promise.reject(qn(r));const s="reauthenticate";try{const i=await ws(n,Bh(r,s,e,n),t);B(i.idToken,r,"internal-error");const a=Ua(i.idToken);B(a,r,"internal-error");const{sub:l}=a;return B(n.uid===l,r,"user-mismatch"),_r._forOperation(n,s,i)}catch(i){throw i?.code==="auth/user-not-found"&&Rt(r,"user-mismatch"),i}}async function Fm(n,e,t=!1){if(lt(n.app))return Promise.reject(qn(n));const r="signIn",s=await Bh(n,r,e),i=await _r._fromIdTokenResponse(n,r,s);return t||await n._updateCurrentUser(i.user),i}function $m(n,e,t,r){return Le(n).onIdTokenChanged(e,t,r)}function Bm(n,e,t){return Le(n).beforeAuthStateChanged(e,t)}function qm(n,e,t,r){return Le(n).onAuthStateChanged(e,t,r)}function zm(n){return Le(n).signOut()}const Li="__sak";class qh{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Li,"1"),this.storage.removeItem(Li),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const jm=1e3,Hm=10;class zh extends qh{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=Mh(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),s=this.localCache[t];r!==s&&e(t,s,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,u)=>{this.notifyListeners(a,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const s=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},i=this.storage.getItem(r);wm()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,Hm):s()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},jm)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}zh.type="LOCAL";const Gm=zh;class jh extends qh{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}jh.type="SESSION";const Hh=jh;function Wm(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class to{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const r=new to(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:s,data:i}=t.data,a=this.handlersMap[s];if(!a?.size)return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const l=Array.from(a).map(async d=>d(t.origin,i)),u=await Wm(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}to.receivers=[];function qa(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class Km{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,a;return new Promise((l,u)=>{const d=qa("",20);s.port1.start();const f=setTimeout(()=>{u(new Error("unsupported_event"))},r);a={messageChannel:s,onMessage(g){const T=g;if(T.data.eventId===d)switch(T.data.status){case"ack":clearTimeout(f),i=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),l(T.data.response);break;default:clearTimeout(f),clearTimeout(i),u(new Error("invalid_response"));break}}},this.handlers.add(a),s.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:d,data:t},[s.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Et(){return window}function Qm(n){Et().location.href=n}function Gh(){return typeof Et().WorkerGlobalScope<"u"&&typeof Et().importScripts=="function"}async function Ym(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Xm(){return navigator?.serviceWorker?.controller||null}function Jm(){return Gh()?self:null}const Wh="firebaseLocalStorageDb",Zm=1,Mi="firebaseLocalStorage",Kh="fbase_key";class Os{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function no(n,e){return n.transaction([Mi],e?"readwrite":"readonly").objectStore(Mi)}function e_(){const n=indexedDB.deleteDatabase(Wh);return new Os(n).toPromise()}function oa(){const n=indexedDB.open(Wh,Zm);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Mi,{keyPath:Kh})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Mi)?e(r):(r.close(),await e_(),e(await oa()))})})}async function Cl(n,e,t){const r=no(n,!0).put({[Kh]:e,value:t});return new Os(r).toPromise()}async function t_(n,e){const t=no(n,!1).get(e),r=await new Os(t).toPromise();return r===void 0?null:r.value}function Pl(n,e){const t=no(n,!0).delete(e);return new Os(t).toPromise()}const n_=800,r_=3;class Qh{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await oa(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>r_)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Gh()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=to._getInstance(Jm()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Ym(),!this.activeServiceWorker)return;this.sender=new Km(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||Xm()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await oa();return await Cl(e,Li,"1"),await Pl(e,Li),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Cl(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>t_(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Pl(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=no(s,!1).getAll();return new Os(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),n_)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Qh.type="LOCAL";const s_=Qh;new Ns(3e4,6e4);function Yh(n,e){return e?$t(e):(B(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class za extends $h{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function i_(n){return Fm(n.auth,new za(n),n.bypassAuthState)}function o_(n){const{auth:e,user:t}=n;return B(t,e,"internal-error"),Um(t,new za(n),n.bypassAuthState)}async function a_(n){const{auth:e,user:t}=n;return B(t,e,"internal-error"),Mm(t,new za(n),n.bypassAuthState)}class Xh{constructor(e,t,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:s,tenantId:i,error:a,type:l}=e;if(a){this.reject(a);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(u))}catch(d){this.reject(d)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return i_;case"linkViaPopup":case"linkViaRedirect":return a_;case"reauthViaPopup":case"reauthViaRedirect":return o_;default:Rt(this.auth,"internal-error")}}resolve(e){zt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){zt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const c_=new Ns(2e3,1e4);async function l_(n,e,t){if(lt(n.app))return Promise.reject(ht(n,"operation-not-supported-in-this-environment"));const r=eo(n);rm(n,e,Ba);const s=Yh(r,t);return new $n(r,"signInViaPopup",e,s).executeNotNull()}class $n extends Xh{constructor(e,t,r,s,i){super(e,t,s,i),this.provider=r,this.authWindow=null,this.pollId=null,$n.currentPopupAction&&$n.currentPopupAction.cancel(),$n.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return B(e,this.auth,"internal-error"),e}async onExecution(){zt(this.filter.length===1,"Popup operations only handle one event");const e=qa();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(ht(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ht(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,$n.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ht(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,c_.get())};e()}}$n.currentPopupAction=null;const u_="pendingRedirect",wi=new Map;class h_ extends Xh{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=wi.get(this.auth._key());if(!e){try{const r=await d_(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}wi.set(this.auth._key(),e)}return this.bypassAuthState||wi.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function d_(n,e){const t=g_(e),r=p_(n);if(!await r._isAvailable())return!1;const s=await r._get(t)==="true";return await r._remove(t),s}function f_(n,e){wi.set(n._key(),e)}function p_(n){return $t(n._redirectPersistence)}function g_(n){return Ei(u_,n.config.apiKey,n.name)}async function m_(n,e,t=!1){if(lt(n.app))return Promise.reject(qn(n));const r=eo(n),s=Yh(r,e),a=await new h_(r,s,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}const __=600*1e3;class y_{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!T_(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!Jh(e)){const r=e.error.code?.split("auth/")[1]||"internal-error";t.onError(ht(this.auth,r))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=__&&this.cachedEventUids.clear(),this.cachedEventUids.has(Dl(e))}saveEventToCache(e){this.cachedEventUids.add(Dl(e)),this.lastProcessedEventTime=Date.now()}}function Dl(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Jh({type:n,error:e}){return n==="unknown"&&e?.code==="auth/no-auth-event"}function T_(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Jh(n);default:return!1}}async function E_(n,e={}){return Sr(n,"GET","/v1/projects",e)}const w_=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,I_=/^https?/;async function v_(n){if(n.config.emulator)return;const{authorizedDomains:e}=await E_(n);for(const t of e)try{if(A_(t))return}catch{}Rt(n,"unauthorized-domain")}function A_(n){const e=sa(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!I_.test(t))return!1;if(w_.test(n))return r===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}const b_=new Ns(3e4,6e4);function Nl(){const n=Et().___jsl;if(n?.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function R_(n){return new Promise((e,t)=>{function r(){Nl(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Nl(),t(ht(n,"network-request-failed"))},timeout:b_.get()})}if(Et().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(Et().gapi?.load)r();else{const s=Pm("iframefcb");return Et()[s]=()=>{gapi.load?r():t(ht(n,"network-request-failed"))},km(`${Cm()}?onload=${s}`).catch(i=>t(i))}}).catch(e=>{throw Ii=null,e})}let Ii=null;function S_(n){return Ii=Ii||R_(n),Ii}const k_=new Ns(5e3,15e3),C_="__/auth/iframe",P_="emulator/auth/iframe",D_={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},N_=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function x_(n){const e=n.config;B(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?La(e,P_):`https://${n.config.authDomain}/${C_}`,r={apiKey:e.apiKey,appName:n.name,v:Rr},s=N_.get(n.config.apiHost);s&&(r.eid=s);const i=n._getFrameworks();return i.length&&(r.fw=i.join(",")),`${t}?${Ds(r).slice(1)}`}async function O_(n){const e=await S_(n),t=Et().gapi;return B(t,n,"internal-error"),e.open({where:document.body,url:x_(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:D_,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const a=ht(n,"network-request-failed"),l=Et().setTimeout(()=>{i(a)},k_.get());function u(){Et().clearTimeout(l),s(r)}r.ping(u).then(u,()=>{i(a)})}))}const V_={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},L_=500,M_=600,U_="_blank",F_="http://localhost";class xl{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function $_(n,e,t,r=L_,s=M_){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const u={...V_,width:r.toString(),height:s.toString(),top:i,left:a},d=Be().toLowerCase();t&&(l=Nh(d)?U_:t),Ph(d)&&(e=e||F_,u.scrollbars="yes");const f=Object.entries(u).reduce((T,[S,P])=>`${T}${S}=${P},`,"");if(Em(d)&&l!=="_self")return B_(e||"",l),new xl(null);const g=window.open(e||"",l,f);B(g,n,"popup-blocked");try{g.focus()}catch{}return new xl(g)}function B_(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const q_="__/auth/handler",z_="emulator/auth/handler",j_=encodeURIComponent("fac");async function Ol(n,e,t,r,s,i){B(n.config.authDomain,n,"auth-domain-config-required"),B(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Rr,eventId:s};if(e instanceof Ba){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",zp(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[f,g]of Object.entries({}))a[f]=g}if(e instanceof xs){const f=e.getScopes().filter(g=>g!=="");f.length>0&&(a.scopes=f.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const f of Object.keys(l))l[f]===void 0&&delete l[f];const u=await n._getAppCheckToken(),d=u?`#${j_}=${encodeURIComponent(u)}`:"";return`${H_(n)}?${Ds(l).slice(1)}${d}`}function H_({config:n}){return n.emulator?La(n,z_):`https://${n.authDomain}/${q_}`}const Bo="webStorageSupport";class G_{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Hh,this._completeRedirectFn=m_,this._overrideRedirectResult=f_}async _openPopup(e,t,r,s){zt(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const i=await Ol(e,t,r,sa(),s);return $_(e,i,qa())}async _openRedirect(e,t,r,s){await this._originValidation(e);const i=await Ol(e,t,r,sa(),s);return Qm(i),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:i}=this.eventManagers[t];return s?Promise.resolve(s):(zt(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await O_(e),r=new y_(e);return t.register("authEvent",s=>(B(s?.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Bo,{type:Bo},s=>{const i=s?.[0]?.[Bo];i!==void 0&&t(!!i),Rt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=v_(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Mh()||Dh()||Fa()}}const W_=G_;var Vl="@firebase/auth",Ll="1.11.1";class K_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e(r?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){B(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Q_(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Y_(n){mr(new Hn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;B(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Uh(n)},d=new Rm(r,s,i,u);return Nm(d,t),d},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),mr(new Hn("auth-internal",e=>{const t=eo(e.getProvider("auth").getImmediate());return(r=>new K_(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),dn(Vl,Ll,Q_(n)),dn(Vl,Ll,"esm2020")}const X_=300,J_=ph("authIdTokenMaxAge")||X_;let Ml=null;const Z_=n=>async e=>{const t=e&&await e.getIdTokenResult(),r=t&&(new Date().getTime()-Date.parse(t.issuedAtTime))/1e3;if(r&&r>J_)return;const s=t?.token;Ml!==s&&(Ml=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function ey(n=Eh()){const e=xa(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Dm(n,{popupRedirectResolver:W_,persistence:[s_,Gm,Hh]}),r=ph("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const a=Z_(i.toString());Bm(t,a,()=>a(t.currentUser)),$m(t,l=>a(l))}}const s=dh("auth");return s&&xm(t,`http://${s}`),t}function ty(){return document.getElementsByTagName("head")?.[0]??document}Sm({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=s=>{const i=ht("internal-error");i.customData=s,t(i)},r.type="text/javascript",r.charset="UTF-8",ty().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Y_("Browser");var ny="firebase",ry="12.5.0";dn(ny,ry,"app");var Ul=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var fn,Zh;(function(){var n;function e(I,m){function y(){}y.prototype=m.prototype,I.F=m.prototype,I.prototype=new y,I.prototype.constructor=I,I.D=function(v,E,b){for(var _=Array(arguments.length-2),Ce=2;Ce<arguments.length;Ce++)_[Ce-2]=arguments[Ce];return m.prototype[E].apply(v,_)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,t),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(I,m,y){y||(y=0);const v=Array(16);if(typeof m=="string")for(var E=0;E<16;++E)v[E]=m.charCodeAt(y++)|m.charCodeAt(y++)<<8|m.charCodeAt(y++)<<16|m.charCodeAt(y++)<<24;else for(E=0;E<16;++E)v[E]=m[y++]|m[y++]<<8|m[y++]<<16|m[y++]<<24;m=I.g[0],y=I.g[1],E=I.g[2];let b=I.g[3],_;_=m+(b^y&(E^b))+v[0]+3614090360&4294967295,m=y+(_<<7&4294967295|_>>>25),_=b+(E^m&(y^E))+v[1]+3905402710&4294967295,b=m+(_<<12&4294967295|_>>>20),_=E+(y^b&(m^y))+v[2]+606105819&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(m^E&(b^m))+v[3]+3250441966&4294967295,y=E+(_<<22&4294967295|_>>>10),_=m+(b^y&(E^b))+v[4]+4118548399&4294967295,m=y+(_<<7&4294967295|_>>>25),_=b+(E^m&(y^E))+v[5]+1200080426&4294967295,b=m+(_<<12&4294967295|_>>>20),_=E+(y^b&(m^y))+v[6]+2821735955&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(m^E&(b^m))+v[7]+4249261313&4294967295,y=E+(_<<22&4294967295|_>>>10),_=m+(b^y&(E^b))+v[8]+1770035416&4294967295,m=y+(_<<7&4294967295|_>>>25),_=b+(E^m&(y^E))+v[9]+2336552879&4294967295,b=m+(_<<12&4294967295|_>>>20),_=E+(y^b&(m^y))+v[10]+4294925233&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(m^E&(b^m))+v[11]+2304563134&4294967295,y=E+(_<<22&4294967295|_>>>10),_=m+(b^y&(E^b))+v[12]+1804603682&4294967295,m=y+(_<<7&4294967295|_>>>25),_=b+(E^m&(y^E))+v[13]+4254626195&4294967295,b=m+(_<<12&4294967295|_>>>20),_=E+(y^b&(m^y))+v[14]+2792965006&4294967295,E=b+(_<<17&4294967295|_>>>15),_=y+(m^E&(b^m))+v[15]+1236535329&4294967295,y=E+(_<<22&4294967295|_>>>10),_=m+(E^b&(y^E))+v[1]+4129170786&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(m^y))+v[6]+3225465664&4294967295,b=m+(_<<9&4294967295|_>>>23),_=E+(m^y&(b^m))+v[11]+643717713&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(E^b))+v[0]+3921069994&4294967295,y=E+(_<<20&4294967295|_>>>12),_=m+(E^b&(y^E))+v[5]+3593408605&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(m^y))+v[10]+38016083&4294967295,b=m+(_<<9&4294967295|_>>>23),_=E+(m^y&(b^m))+v[15]+3634488961&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(E^b))+v[4]+3889429448&4294967295,y=E+(_<<20&4294967295|_>>>12),_=m+(E^b&(y^E))+v[9]+568446438&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(m^y))+v[14]+3275163606&4294967295,b=m+(_<<9&4294967295|_>>>23),_=E+(m^y&(b^m))+v[3]+4107603335&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(E^b))+v[8]+1163531501&4294967295,y=E+(_<<20&4294967295|_>>>12),_=m+(E^b&(y^E))+v[13]+2850285829&4294967295,m=y+(_<<5&4294967295|_>>>27),_=b+(y^E&(m^y))+v[2]+4243563512&4294967295,b=m+(_<<9&4294967295|_>>>23),_=E+(m^y&(b^m))+v[7]+1735328473&4294967295,E=b+(_<<14&4294967295|_>>>18),_=y+(b^m&(E^b))+v[12]+2368359562&4294967295,y=E+(_<<20&4294967295|_>>>12),_=m+(y^E^b)+v[5]+4294588738&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^E)+v[8]+2272392833&4294967295,b=m+(_<<11&4294967295|_>>>21),_=E+(b^m^y)+v[11]+1839030562&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^m)+v[14]+4259657740&4294967295,y=E+(_<<23&4294967295|_>>>9),_=m+(y^E^b)+v[1]+2763975236&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^E)+v[4]+1272893353&4294967295,b=m+(_<<11&4294967295|_>>>21),_=E+(b^m^y)+v[7]+4139469664&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^m)+v[10]+3200236656&4294967295,y=E+(_<<23&4294967295|_>>>9),_=m+(y^E^b)+v[13]+681279174&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^E)+v[0]+3936430074&4294967295,b=m+(_<<11&4294967295|_>>>21),_=E+(b^m^y)+v[3]+3572445317&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^m)+v[6]+76029189&4294967295,y=E+(_<<23&4294967295|_>>>9),_=m+(y^E^b)+v[9]+3654602809&4294967295,m=y+(_<<4&4294967295|_>>>28),_=b+(m^y^E)+v[12]+3873151461&4294967295,b=m+(_<<11&4294967295|_>>>21),_=E+(b^m^y)+v[15]+530742520&4294967295,E=b+(_<<16&4294967295|_>>>16),_=y+(E^b^m)+v[2]+3299628645&4294967295,y=E+(_<<23&4294967295|_>>>9),_=m+(E^(y|~b))+v[0]+4096336452&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~E))+v[7]+1126891415&4294967295,b=m+(_<<10&4294967295|_>>>22),_=E+(m^(b|~y))+v[14]+2878612391&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~m))+v[5]+4237533241&4294967295,y=E+(_<<21&4294967295|_>>>11),_=m+(E^(y|~b))+v[12]+1700485571&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~E))+v[3]+2399980690&4294967295,b=m+(_<<10&4294967295|_>>>22),_=E+(m^(b|~y))+v[10]+4293915773&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~m))+v[1]+2240044497&4294967295,y=E+(_<<21&4294967295|_>>>11),_=m+(E^(y|~b))+v[8]+1873313359&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~E))+v[15]+4264355552&4294967295,b=m+(_<<10&4294967295|_>>>22),_=E+(m^(b|~y))+v[6]+2734768916&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~m))+v[13]+1309151649&4294967295,y=E+(_<<21&4294967295|_>>>11),_=m+(E^(y|~b))+v[4]+4149444226&4294967295,m=y+(_<<6&4294967295|_>>>26),_=b+(y^(m|~E))+v[11]+3174756917&4294967295,b=m+(_<<10&4294967295|_>>>22),_=E+(m^(b|~y))+v[2]+718787259&4294967295,E=b+(_<<15&4294967295|_>>>17),_=y+(b^(E|~m))+v[9]+3951481745&4294967295,I.g[0]=I.g[0]+m&4294967295,I.g[1]=I.g[1]+(E+(_<<21&4294967295|_>>>11))&4294967295,I.g[2]=I.g[2]+E&4294967295,I.g[3]=I.g[3]+b&4294967295}r.prototype.v=function(I,m){m===void 0&&(m=I.length);const y=m-this.blockSize,v=this.C;let E=this.h,b=0;for(;b<m;){if(E==0)for(;b<=y;)s(this,I,b),b+=this.blockSize;if(typeof I=="string"){for(;b<m;)if(v[E++]=I.charCodeAt(b++),E==this.blockSize){s(this,v),E=0;break}}else for(;b<m;)if(v[E++]=I[b++],E==this.blockSize){s(this,v),E=0;break}}this.h=E,this.o+=m},r.prototype.A=function(){var I=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);I[0]=128;for(var m=1;m<I.length-8;++m)I[m]=0;m=this.o*8;for(var y=I.length-8;y<I.length;++y)I[y]=m&255,m/=256;for(this.v(I),I=Array(16),m=0,y=0;y<4;++y)for(let v=0;v<32;v+=8)I[m++]=this.g[y]>>>v&255;return I};function i(I,m){var y=l;return Object.prototype.hasOwnProperty.call(y,I)?y[I]:y[I]=m(I)}function a(I,m){this.h=m;const y=[];let v=!0;for(let E=I.length-1;E>=0;E--){const b=I[E]|0;v&&b==m||(y[E]=b,v=!1)}this.g=y}var l={};function u(I){return-128<=I&&I<128?i(I,function(m){return new a([m|0],m<0?-1:0)}):new a([I|0],I<0?-1:0)}function d(I){if(isNaN(I)||!isFinite(I))return g;if(I<0)return x(d(-I));const m=[];let y=1;for(let v=0;I>=y;v++)m[v]=I/y|0,y*=4294967296;return new a(m,0)}function f(I,m){if(I.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(I.charAt(0)=="-")return x(f(I.substring(1),m));if(I.indexOf("-")>=0)throw Error('number format error: interior "-" character');const y=d(Math.pow(m,8));let v=g;for(let b=0;b<I.length;b+=8){var E=Math.min(8,I.length-b);const _=parseInt(I.substring(b,b+E),m);E<8?(E=d(Math.pow(m,E)),v=v.j(E).add(d(_))):(v=v.j(y),v=v.add(d(_)))}return v}var g=u(0),T=u(1),S=u(16777216);n=a.prototype,n.m=function(){if(V(this))return-x(this).m();let I=0,m=1;for(let y=0;y<this.g.length;y++){const v=this.i(y);I+=(v>=0?v:4294967296+v)*m,m*=4294967296}return I},n.toString=function(I){if(I=I||10,I<2||36<I)throw Error("radix out of range: "+I);if(P(this))return"0";if(V(this))return"-"+x(this).toString(I);const m=d(Math.pow(I,6));var y=this;let v="";for(;;){const E=ee(y,m).g;y=j(y,E.j(m));let b=((y.g.length>0?y.g[0]:y.h)>>>0).toString(I);if(y=E,P(y))return b+v;for(;b.length<6;)b="0"+b;v=b+v}},n.i=function(I){return I<0?0:I<this.g.length?this.g[I]:this.h};function P(I){if(I.h!=0)return!1;for(let m=0;m<I.g.length;m++)if(I.g[m]!=0)return!1;return!0}function V(I){return I.h==-1}n.l=function(I){return I=j(this,I),V(I)?-1:P(I)?0:1};function x(I){const m=I.g.length,y=[];for(let v=0;v<m;v++)y[v]=~I.g[v];return new a(y,~I.h).add(T)}n.abs=function(){return V(this)?x(this):this},n.add=function(I){const m=Math.max(this.g.length,I.g.length),y=[];let v=0;for(let E=0;E<=m;E++){let b=v+(this.i(E)&65535)+(I.i(E)&65535),_=(b>>>16)+(this.i(E)>>>16)+(I.i(E)>>>16);v=_>>>16,b&=65535,_&=65535,y[E]=_<<16|b}return new a(y,y[y.length-1]&-2147483648?-1:0)};function j(I,m){return I.add(x(m))}n.j=function(I){if(P(this)||P(I))return g;if(V(this))return V(I)?x(this).j(x(I)):x(x(this).j(I));if(V(I))return x(this.j(x(I)));if(this.l(S)<0&&I.l(S)<0)return d(this.m()*I.m());const m=this.g.length+I.g.length,y=[];for(var v=0;v<2*m;v++)y[v]=0;for(v=0;v<this.g.length;v++)for(let E=0;E<I.g.length;E++){const b=this.i(v)>>>16,_=this.i(v)&65535,Ce=I.i(E)>>>16,Ct=I.i(E)&65535;y[2*v+2*E]+=_*Ct,G(y,2*v+2*E),y[2*v+2*E+1]+=b*Ct,G(y,2*v+2*E+1),y[2*v+2*E+1]+=_*Ce,G(y,2*v+2*E+1),y[2*v+2*E+2]+=b*Ce,G(y,2*v+2*E+2)}for(I=0;I<m;I++)y[I]=y[2*I+1]<<16|y[2*I];for(I=m;I<2*m;I++)y[I]=0;return new a(y,0)};function G(I,m){for(;(I[m]&65535)!=I[m];)I[m+1]+=I[m]>>>16,I[m]&=65535,m++}function W(I,m){this.g=I,this.h=m}function ee(I,m){if(P(m))throw Error("division by zero");if(P(I))return new W(g,g);if(V(I))return m=ee(x(I),m),new W(x(m.g),x(m.h));if(V(m))return m=ee(I,x(m)),new W(x(m.g),m.h);if(I.g.length>30){if(V(I)||V(m))throw Error("slowDivide_ only works with positive integers.");for(var y=T,v=m;v.l(I)<=0;)y=he(y),v=he(v);var E=ie(y,1),b=ie(v,1);for(v=ie(v,2),y=ie(y,2);!P(v);){var _=b.add(v);_.l(I)<=0&&(E=E.add(y),b=_),v=ie(v,1),y=ie(y,1)}return m=j(I,E.j(m)),new W(E,m)}for(E=g;I.l(m)>=0;){for(y=Math.max(1,Math.floor(I.m()/m.m())),v=Math.ceil(Math.log(y)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),b=d(y),_=b.j(m);V(_)||_.l(I)>0;)y-=v,b=d(y),_=b.j(m);P(b)&&(b=T),E=E.add(b),I=j(I,_)}return new W(E,I)}n.B=function(I){return ee(this,I).h},n.and=function(I){const m=Math.max(this.g.length,I.g.length),y=[];for(let v=0;v<m;v++)y[v]=this.i(v)&I.i(v);return new a(y,this.h&I.h)},n.or=function(I){const m=Math.max(this.g.length,I.g.length),y=[];for(let v=0;v<m;v++)y[v]=this.i(v)|I.i(v);return new a(y,this.h|I.h)},n.xor=function(I){const m=Math.max(this.g.length,I.g.length),y=[];for(let v=0;v<m;v++)y[v]=this.i(v)^I.i(v);return new a(y,this.h^I.h)};function he(I){const m=I.g.length+1,y=[];for(let v=0;v<m;v++)y[v]=I.i(v)<<1|I.i(v-1)>>>31;return new a(y,I.h)}function ie(I,m){const y=m>>5;m%=32;const v=I.g.length-y,E=[];for(let b=0;b<v;b++)E[b]=m>0?I.i(b+y)>>>m|I.i(b+y+1)<<32-m:I.i(b+y);return new a(E,I.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Zh=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,fn=a}).apply(typeof Ul<"u"?Ul:typeof self<"u"?self:typeof window<"u"?window:{});var hi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ed,cs,td,vi,aa,nd,rd,sd;(function(){var n,e=Object.defineProperty;function t(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof hi=="object"&&hi];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var r=t(this);function s(o,c){if(c)e:{var h=r;o=o.split(".");for(var p=0;p<o.length-1;p++){var A=o[p];if(!(A in h))break e;h=h[A]}o=o[o.length-1],p=h[o],c=c(p),c!=p&&c!=null&&e(h,o,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(o){return o||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(o){return o||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(o){return o||function(c){var h=[],p;for(p in c)Object.prototype.hasOwnProperty.call(c,p)&&h.push([p,c[p]]);return h}});var i=i||{},a=this||self;function l(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function u(o,c,h){return o.call.apply(o.bind,arguments)}function d(o,c,h){return d=u,d.apply(null,arguments)}function f(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var p=h.slice();return p.push.apply(p,arguments),o.apply(this,p)}}function g(o,c){function h(){}h.prototype=c.prototype,o.Z=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Ob=function(p,A,R){for(var N=Array(arguments.length-2),H=2;H<arguments.length;H++)N[H-2]=arguments[H];return c.prototype[A].apply(p,N)}}var T=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?o=>o&&AsyncContext.Snapshot.wrap(o):o=>o;function S(o){const c=o.length;if(c>0){const h=Array(c);for(let p=0;p<c;p++)h[p]=o[p];return h}return[]}function P(o,c){for(let p=1;p<arguments.length;p++){const A=arguments[p];var h=typeof A;if(h=h!="object"?h:A?Array.isArray(A)?"array":h:"null",h=="array"||h=="object"&&typeof A.length=="number"){h=o.length||0;const R=A.length||0;o.length=h+R;for(let N=0;N<R;N++)o[h+N]=A[N]}else o.push(A)}}class V{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function x(o){a.setTimeout(()=>{throw o},0)}function j(){var o=I;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class G{constructor(){this.h=this.g=null}add(c,h){const p=W.get();p.set(c,h),this.h?this.h.next=p:this.g=p,this.h=p}}var W=new V(()=>new ee,o=>o.reset());class ee{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let he,ie=!1,I=new G,m=()=>{const o=Promise.resolve(void 0);he=()=>{o.then(y)}};function y(){for(var o;o=j();){try{o.h.call(o.g)}catch(h){x(h)}var c=W;c.j(o),c.h<100&&(c.h++,o.next=c.g,c.g=o)}ie=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var b=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{const h=()=>{};a.addEventListener("test",h,c),a.removeEventListener("test",h,c)}catch{}return o})();function _(o){return/^[\s\xa0]*$/.test(o)}function Ce(o,c){E.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o&&this.init(o,c)}g(Ce,E),Ce.prototype.init=function(o,c){const h=this.type=o.type,p=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget,c||(h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement)),this.relatedTarget=c,p?(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=o.pointerType,this.state=o.state,this.i=o,o.defaultPrevented&&Ce.Z.h.call(this)},Ce.prototype.h=function(){Ce.Z.h.call(this);const o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var Ct="closure_listenable_"+(Math.random()*1e6|0),bo=0;function Ro(o,c,h,p,A){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!p,this.ha=A,this.key=++bo,this.da=this.fa=!1}function An(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Zn(o,c,h){for(const p in o)c.call(h,o[p],p,o)}function Hs(o,c){for(const h in o)c.call(void 0,o[h],h,o)}function ge(o){const c={};for(const h in o)c[h]=o[h];return c}const xr="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ee(o,c){let h,p;for(let A=1;A<arguments.length;A++){p=arguments[A];for(h in p)o[h]=p[h];for(let R=0;R<xr.length;R++)h=xr[R],Object.prototype.hasOwnProperty.call(p,h)&&(o[h]=p[h])}}function bn(o){this.src=o,this.g={},this.h=0}bn.prototype.add=function(o,c,h,p,A){const R=o.toString();o=this.g[R],o||(o=this.g[R]=[],this.h++);const N=Pt(o,c,p,A);return N>-1?(c=o[N],h||(c.fa=!1)):(c=new Ro(c,this.src,R,!!p,A),c.fa=h,o.push(c)),c};function le(o,c){const h=c.type;if(h in o.g){var p=o.g[h],A=Array.prototype.indexOf.call(p,c,void 0),R;(R=A>=0)&&Array.prototype.splice.call(p,A,1),R&&(An(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function Pt(o,c,h,p){for(let A=0;A<o.length;++A){const R=o[A];if(!R.da&&R.listener==c&&R.capture==!!h&&R.ha==p)return A}return-1}var Rn="closure_lm_"+(Math.random()*1e6|0),ft={};function Or(o,c,h,p,A){if(Array.isArray(c)){for(let R=0;R<c.length;R++)Or(o,c[R],h,p,A);return null}return h=Nt(h),o&&o[Ct]?o.J(c,h,l(p)?!!p.capture:!1,A):Vr(o,c,h,!1,p,A)}function Vr(o,c,h,p,A,R){if(!c)throw Error("Invalid event type");const N=l(A)?!!A.capture:!!A;let H=kn(o);if(H||(o[Rn]=H=new bn(o)),h=H.add(c,h,p,N,R),h.proxy)return h;if(p=Gs(),h.proxy=p,p.src=o,p.listener=h,o.addEventListener)b||(A=N),A===void 0&&(A=!1),o.addEventListener(c.toString(),p,A);else if(o.attachEvent)o.attachEvent(Sn(c.toString()),p);else if(o.addListener&&o.removeListener)o.addListener(p);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Gs(){function o(h){return c.call(o.src,o.listener,h)}const c=Dt;return o}function Lr(o,c,h,p,A){if(Array.isArray(c))for(var R=0;R<c.length;R++)Lr(o,c[R],h,p,A);else p=l(p)?!!p.capture:!!p,h=Nt(h),o&&o[Ct]?(o=o.i,R=String(c).toString(),R in o.g&&(c=o.g[R],h=Pt(c,h,p,A),h>-1&&(An(c[h]),Array.prototype.splice.call(c,h,1),c.length==0&&(delete o.g[R],o.h--)))):o&&(o=kn(o))&&(c=o.g[c.toString()],o=-1,c&&(o=Pt(c,h,p,A)),(h=o>-1?c[o]:null)&&pt(h))}function pt(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[Ct])le(c.i,o);else{var h=o.type,p=o.proxy;c.removeEventListener?c.removeEventListener(h,p,o.capture):c.detachEvent?c.detachEvent(Sn(h),p):c.addListener&&c.removeListener&&c.removeListener(p),(h=kn(c))?(le(h,o),h.h==0&&(h.src=null,c[Rn]=null)):An(o)}}}function Sn(o){return o in ft?ft[o]:ft[o]="on"+o}function Dt(o,c){if(o.da)o=!0;else{c=new Ce(c,this);const h=o.listener,p=o.ha||o.src;o.fa&&pt(o),o=h.call(p,c)}return o}function kn(o){return o=o[Rn],o instanceof bn?o:null}var Cn="__closure_events_fn_"+(Math.random()*1e9>>>0);function Nt(o){return typeof o=="function"?o:(o[Cn]||(o[Cn]=function(c){return o.handleEvent(c)}),o[Cn])}function me(){v.call(this),this.i=new bn(this),this.M=this,this.G=null}g(me,v),me.prototype[Ct]=!0,me.prototype.removeEventListener=function(o,c,h,p){Lr(this,o,c,h,p)};function we(o,c){var h,p=o.G;if(p)for(h=[];p;p=p.G)h.push(p);if(o=o.M,p=c.type||c,typeof c=="string")c=new E(c,o);else if(c instanceof E)c.target=c.target||o;else{var A=c;c=new E(p,o),Ee(c,A)}A=!0;let R,N;if(h)for(N=h.length-1;N>=0;N--)R=c.g=h[N],A=Pn(R,p,!0,c)&&A;if(R=c.g=o,A=Pn(R,p,!0,c)&&A,A=Pn(R,p,!1,c)&&A,h)for(N=0;N<h.length;N++)R=c.g=h[N],A=Pn(R,p,!1,c)&&A}me.prototype.N=function(){if(me.Z.N.call(this),this.i){var o=this.i;for(const c in o.g){const h=o.g[c];for(let p=0;p<h.length;p++)An(h[p]);delete o.g[c],o.h--}}this.G=null},me.prototype.J=function(o,c,h,p){return this.i.add(String(o),c,!1,h,p)},me.prototype.K=function(o,c,h,p){return this.i.add(String(o),c,!0,h,p)};function Pn(o,c,h,p){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();let A=!0;for(let R=0;R<c.length;++R){const N=c[R];if(N&&!N.da&&N.capture==h){const H=N.listener,Se=N.ha||N.src;N.fa&&le(o.i,N),A=H.call(Se,p)!==!1&&A}}return A&&!p.defaultPrevented}function Ws(o,c){if(typeof o!="function")if(o&&typeof o.handleEvent=="function")o=d(o.handleEvent,o);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(o,c||0)}function Ks(o){o.g=Ws(()=>{o.g=null,o.i&&(o.i=!1,Ks(o))},o.l);const c=o.h;o.h=null,o.m.apply(null,c)}class Mr extends v{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ks(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function st(o){v.call(this),this.h=o,this.g={}}g(st,v);var xt=[];function Ot(o){Zn(o.g,function(c,h){this.g.hasOwnProperty(h)&&pt(c)},o),o.g={}}st.prototype.N=function(){st.Z.N.call(this),Ot(this)},st.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var er=a.JSON.stringify,Qs=a.JSON.parse,Ys=class{stringify(o){return a.JSON.stringify(o,void 0)}parse(o){return a.JSON.parse(o,void 0)}};function tr(){}function Ur(){}var gt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Kt(){E.call(this,"d")}g(Kt,E);function Ye(){E.call(this,"c")}g(Ye,E);var Ge={},nr=null;function Qt(){return nr=nr||new me}Ge.Ia="serverreachability";function Xs(o){E.call(this,Ge.Ia,o)}g(Xs,E);function mt(o){const c=Qt();we(c,new Xs(c))}Ge.STAT_EVENT="statevent";function Dn(o,c){E.call(this,Ge.STAT_EVENT,o),this.stat=c}g(Dn,E);function Ne(o){const c=Qt();we(c,new Dn(c,o))}Ge.Ja="timingevent";function Yt(o,c){E.call(this,Ge.Ja,o),this.size=c}g(Yt,E);function Nn(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){o()},c)}function xn(){this.g=!0}xn.prototype.ua=function(){this.g=!1};function Ie(o,c,h,p,A,R){o.info(function(){if(o.g)if(R){var N="",H=R.split("&");for(let ae=0;ae<H.length;ae++){var Se=H[ae].split("=");if(Se.length>1){const Pe=Se[0];Se=Se[1];const yt=Pe.split("_");N=yt.length>=2&&yt[1]=="type"?N+(Pe+"="+Se+"&"):N+(Pe+"=redacted&")}}}else N=null;else N=R;return"XMLHTTP REQ ("+p+") [attempt "+A+"]: "+c+`
`+h+`
`+N})}function Xt(o,c,h,p,A,R,N){o.info(function(){return"XMLHTTP RESP ("+p+") [ attempt "+A+"]: "+c+`
`+h+`
`+R+" "+N})}function Jt(o,c,h,p){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+Fr(o,h)+(p?" "+p:"")})}function Js(o,c){o.info(function(){return"TIMEOUT: "+c})}xn.prototype.info=function(){};function Fr(o,c){if(!o.g)return c;if(!c)return null;try{const R=JSON.parse(c);if(R){for(o=0;o<R.length;o++)if(Array.isArray(R[o])){var h=R[o];if(!(h.length<2)){var p=h[1];if(Array.isArray(p)&&!(p.length<1)){var A=p[0];if(A!="noop"&&A!="stop"&&A!="close")for(let N=1;N<p.length;N++)p[N]=""}}}}return er(R)}catch{return c}}var On={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},$r={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Zs;function We(){}g(We,tr),We.prototype.g=function(){return new XMLHttpRequest},Zs=new We;function Xe(o){return encodeURIComponent(String(o))}function ei(o){var c=1;o=o.split(":");const h=[];for(;c>0&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function it(o,c,h,p){this.j=o,this.i=c,this.l=h,this.S=p||1,this.V=new st(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new rr}function rr(){this.i=null,this.g="",this.h=!1}var Br={},Je={};function sr(o,c,h){o.M=1,o.A=ni(_t(c)),o.u=h,o.R=!0,qr(o,null)}function qr(o,c){o.F=Date.now(),U(o),o.B=_t(o.A);var h=o.B,p=o.S;Array.isArray(p)||(p=[String(p)]),qc(h.i,"t",p),o.C=0,h=o.j.L,o.h=new rr,o.g=ol(o.j,h?c:null,!o.u),o.P>0&&(o.O=new Mr(d(o.Y,o,o.g),o.P)),c=o.V,h=o.g,p=o.ba;var A="readystatechange";Array.isArray(A)||(A&&(xt[0]=A.toString()),A=xt);for(let R=0;R<A.length;R++){const N=Or(h,A[R],p||c.handleEvent,!1,c.h||c);if(!N)break;c.g[N.key]=N}c=o.J?ge(o.J):{},o.u?(o.v||(o.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.B,o.v,o.u,c)):(o.v="GET",o.g.ea(o.B,o.v,null,c)),mt(),Ie(o.i,o.v,o.B,o.l,o.S,o.u)}it.prototype.ba=function(o){o=o.target;const c=this.O;c&&tn(o)==3?c.j():this.Y(o)},it.prototype.Y=function(o){try{if(o==this.g)e:{const H=tn(this.g),Se=this.g.ya(),ae=this.g.ca();if(!(H<3)&&(H!=3||this.g&&(this.h.h||this.g.la()||Qc(this.g)))){this.K||H!=4||Se==7||(Se==8||ae<=0?mt(3):mt(2)),D(this);var c=this.g.ca();this.X=c;var h=ti(this);if(this.o=c==200,Xt(this.i,this.v,this.B,this.l,this.S,H,c),this.o){if(this.U&&!this.L){t:{if(this.g){var p,A=this.g;if((p=A.g?A.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!_(p)){var R=p;break t}}R=null}if(o=R)Jt(this.i,this.l,o,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ve(this,o);else{this.o=!1,this.m=3,Ne(12),te(this),M(this);break e}}if(this.R){o=!0;let Pe;for(;!this.K&&this.C<h.length;)if(Pe=So(this,h),Pe==Je){H==4&&(this.m=4,Ne(14),o=!1),Jt(this.i,this.l,null,"[Incomplete Response]");break}else if(Pe==Br){this.m=4,Ne(15),Jt(this.i,this.l,h,"[Invalid Chunk]"),o=!1;break}else Jt(this.i,this.l,Pe,null),ve(this,Pe);if(zr(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),H!=4||h.length!=0||this.h.h||(this.m=1,Ne(16),o=!1),this.o=this.o&&o,!o)Jt(this.i,this.l,h,"[Invalid Chunked Response]"),te(this),M(this);else if(h.length>0&&!this.W){this.W=!0;var N=this.j;N.g==this&&N.aa&&!N.P&&(N.j.info("Great, no buffering proxy detected. Bytes received: "+h.length),xo(N),N.P=!0,Ne(11))}}else Jt(this.i,this.l,h,null),ve(this,h);H==4&&te(this),this.o&&!this.K&&(H==4?nl(this.j,this):(this.o=!1,U(this)))}else mp(this.g),c==400&&h.indexOf("Unknown SID")>0?(this.m=3,Ne(12)):(this.m=0,Ne(13)),te(this),M(this)}}}catch{}finally{}};function ti(o){if(!zr(o))return o.g.la();const c=Qc(o.g);if(c==="")return"";let h="";const p=c.length,A=tn(o.g)==4;if(!o.h.i){if(typeof TextDecoder>"u")return te(o),M(o),"";o.h.i=new a.TextDecoder}for(let R=0;R<p;R++)o.h.h=!0,h+=o.h.i.decode(c[R],{stream:!(A&&R==p-1)});return c.length=0,o.h.g+=h,o.C=0,o.h.g}function zr(o){return o.g?o.v=="GET"&&o.M!=2&&o.j.Aa:!1}function So(o,c){var h=o.C,p=c.indexOf(`
`,h);return p==-1?Je:(h=Number(c.substring(h,p)),isNaN(h)?Br:(p+=1,p+h>c.length?Je:(c=c.slice(p,p+h),o.C=p+h,c)))}it.prototype.cancel=function(){this.K=!0,te(this)};function U(o){o.T=Date.now()+o.H,w(o,o.H)}function w(o,c){if(o.D!=null)throw Error("WatchDog timer not null");o.D=Nn(d(o.aa,o),c)}function D(o){o.D&&(a.clearTimeout(o.D),o.D=null)}it.prototype.aa=function(){this.D=null;const o=Date.now();o-this.T>=0?(Js(this.i,this.B),this.M!=2&&(mt(),Ne(17)),te(this),this.m=2,M(this)):w(this,this.T-o)};function M(o){o.j.I==0||o.K||nl(o.j,o)}function te(o){D(o);var c=o.O;c&&typeof c.dispose=="function"&&c.dispose(),o.O=null,Ot(o.V),o.g&&(c=o.g,o.g=null,c.abort(),c.dispose())}function ve(o,c){try{var h=o.j;if(h.I!=0&&(h.g==o||Vn(h.h,o))){if(!o.L&&Vn(h.h,o)&&h.I==3){try{var p=h.Ba.g.parse(c)}catch{p=null}if(Array.isArray(p)&&p.length==3){var A=p;if(A[0]==0){e:if(!h.v){if(h.g)if(h.g.F+3e3<o.F)ai(h),ii(h);else break e;No(h),Ne(18)}}else h.xa=A[1],0<h.xa-h.K&&A[2]<37500&&h.F&&h.A==0&&!h.C&&(h.C=Nn(d(h.Va,h),6e3));Vt(h.h)<=1&&h.ta&&(h.ta=void 0)}else Mn(h,11)}else if((o.L||h.g==o)&&ai(h),!_(c))for(A=h.Ba.g.parse(c),c=0;c<A.length;c++){let ae=A[c];const Pe=ae[0];if(!(Pe<=h.K))if(h.K=Pe,ae=ae[1],h.I==2)if(ae[0]=="c"){h.M=ae[1],h.ba=ae[2];const yt=ae[3];yt!=null&&(h.ka=yt,h.j.info("VER="+h.ka));const Un=ae[4];Un!=null&&(h.za=Un,h.j.info("SVER="+h.za));const nn=ae[5];nn!=null&&typeof nn=="number"&&nn>0&&(p=1.5*nn,h.O=p,h.j.info("backChannelRequestTimeoutMs_="+p)),p=h;const rn=o.g;if(rn){const li=rn.g?rn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(li){var R=p.h;R.g||li.indexOf("spdy")==-1&&li.indexOf("quic")==-1&&li.indexOf("h2")==-1||(R.j=R.l,R.g=new Set,R.h&&(_e(R,R.h),R.h=null))}if(p.G){const Oo=rn.g?rn.g.getResponseHeader("X-HTTP-Session-Id"):null;Oo&&(p.wa=Oo,ue(p.J,p.G,Oo))}}h.I=3,h.l&&h.l.ra(),h.aa&&(h.T=Date.now()-o.F,h.j.info("Handshake RTT: "+h.T+"ms")),p=h;var N=o;if(p.na=il(p,p.L?p.ba:null,p.W),N.L){jr(p.h,N);var H=N,Se=p.O;Se&&(H.H=Se),H.D&&(D(H),U(H)),p.g=N}else el(p);h.i.length>0&&oi(h)}else ae[0]!="stop"&&ae[0]!="close"||Mn(h,7);else h.I==3&&(ae[0]=="stop"||ae[0]=="close"?ae[0]=="stop"?Mn(h,7):Do(h):ae[0]!="noop"&&h.l&&h.l.qa(ae),h.A=0)}}mt(4)}catch{}}var fe=class{constructor(o,c){this.g=o,this.map=c}};function xe(o){this.l=o||10,a.PerformanceNavigationTiming?(o=a.performance.getEntriesByType("navigation"),o=o.length>0&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function tt(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function Vt(o){return o.h?1:o.g?o.g.size:0}function Vn(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function _e(o,c){o.g?o.g.add(c):o.h=c}function jr(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}xe.prototype.cancel=function(){if(this.i=Hr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const o of this.g.values())o.cancel();this.g.clear()}};function Hr(o){if(o.h!=null)return o.i.concat(o.h.G);if(o.g!=null&&o.g.size!==0){let c=o.i;for(const h of o.g.values())c=c.concat(h.G);return c}return S(o.i)}var Mc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sp(o,c){if(o){o=o.split("&");for(let h=0;h<o.length;h++){const p=o[h].indexOf("=");let A,R=null;p>=0?(A=o[h].substring(0,p),R=o[h].substring(p+1)):A=o[h],c(A,R?decodeURIComponent(R.replace(/\+/g," ")):"")}}}function Zt(o){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;o instanceof Zt?(this.l=o.l,Gr(this,o.j),this.o=o.o,this.g=o.g,Wr(this,o.u),this.h=o.h,ko(this,zc(o.i)),this.m=o.m):o&&(c=String(o).match(Mc))?(this.l=!1,Gr(this,c[1]||"",!0),this.o=Kr(c[2]||""),this.g=Kr(c[3]||"",!0),Wr(this,c[4]),this.h=Kr(c[5]||"",!0),ko(this,c[6]||"",!0),this.m=Kr(c[7]||"")):(this.l=!1,this.i=new Yr(null,this.l))}Zt.prototype.toString=function(){const o=[];var c=this.j;c&&o.push(Qr(c,Uc,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Qr(c,Uc,!0),"@"),o.push(Xe(h).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.u,h!=null&&o.push(":",String(h))),(h=this.h)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Qr(h,h.charAt(0)=="/"?ap:op,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Qr(h,lp)),o.join("")},Zt.prototype.resolve=function(o){const c=_t(this);let h=!!o.j;h?Gr(c,o.j):h=!!o.o,h?c.o=o.o:h=!!o.g,h?c.g=o.g:h=o.u!=null;var p=o.h;if(h)Wr(c,o.u);else if(h=!!o.h){if(p.charAt(0)!="/")if(this.g&&!this.h)p="/"+p;else{var A=c.h.lastIndexOf("/");A!=-1&&(p=c.h.slice(0,A+1)+p)}if(A=p,A==".."||A==".")p="";else if(A.indexOf("./")!=-1||A.indexOf("/.")!=-1){p=A.lastIndexOf("/",0)==0,A=A.split("/");const R=[];for(let N=0;N<A.length;){const H=A[N++];H=="."?p&&N==A.length&&R.push(""):H==".."?((R.length>1||R.length==1&&R[0]!="")&&R.pop(),p&&N==A.length&&R.push("")):(R.push(H),p=!0)}p=R.join("/")}else p=A}return h?c.h=p:h=o.i.toString()!=="",h?ko(c,zc(o.i)):h=!!o.m,h&&(c.m=o.m),c};function _t(o){return new Zt(o)}function Gr(o,c,h){o.j=h?Kr(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Wr(o,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);o.u=c}else o.u=null}function ko(o,c,h){c instanceof Yr?(o.i=c,up(o.i,o.l)):(h||(c=Qr(c,cp)),o.i=new Yr(c,o.l))}function ue(o,c,h){o.i.set(c,h)}function ni(o){return ue(o,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),o}function Kr(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Qr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,ip),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function ip(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var Uc=/[#\/\?@]/g,op=/[#\?:]/g,ap=/[#\?]/g,cp=/[#\?@]/g,lp=/#/g;function Yr(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function Ln(o){o.g||(o.g=new Map,o.h=0,o.i&&sp(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}n=Yr.prototype,n.add=function(o,c){Ln(this),this.i=null,o=ir(this,o);let h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function Fc(o,c){Ln(o),c=ir(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function $c(o,c){return Ln(o),c=ir(o,c),o.g.has(c)}n.forEach=function(o,c){Ln(this),this.g.forEach(function(h,p){h.forEach(function(A){o.call(c,A,p,this)},this)},this)};function Bc(o,c){Ln(o);let h=[];if(typeof c=="string")$c(o,c)&&(h=h.concat(o.g.get(ir(o,c))));else for(o=Array.from(o.g.values()),c=0;c<o.length;c++)h=h.concat(o[c]);return h}n.set=function(o,c){return Ln(this),this.i=null,o=ir(this,o),$c(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},n.get=function(o,c){return o?(o=Bc(this,o),o.length>0?String(o[0]):c):c};function qc(o,c,h){Fc(o,c),h.length>0&&(o.i=null,o.g.set(ir(o,c),S(h)),o.h+=h.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const o=[],c=Array.from(this.g.keys());for(let p=0;p<c.length;p++){var h=c[p];const A=Xe(h);h=Bc(this,h);for(let R=0;R<h.length;R++){let N=A;h[R]!==""&&(N+="="+Xe(h[R])),o.push(N)}}return this.i=o.join("&")};function zc(o){const c=new Yr;return c.i=o.i,o.g&&(c.g=new Map(o.g),c.h=o.h),c}function ir(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function up(o,c){c&&!o.j&&(Ln(o),o.i=null,o.g.forEach(function(h,p){const A=p.toLowerCase();p!=A&&(Fc(this,p),qc(this,A,h))},o)),o.j=c}function hp(o,c){const h=new xn;if(a.Image){const p=new Image;p.onload=f(en,h,"TestLoadImage: loaded",!0,c,p),p.onerror=f(en,h,"TestLoadImage: error",!1,c,p),p.onabort=f(en,h,"TestLoadImage: abort",!1,c,p),p.ontimeout=f(en,h,"TestLoadImage: timeout",!1,c,p),a.setTimeout(function(){p.ontimeout&&p.ontimeout()},1e4),p.src=o}else c(!1)}function dp(o,c){const h=new xn,p=new AbortController,A=setTimeout(()=>{p.abort(),en(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:p.signal}).then(R=>{clearTimeout(A),R.ok?en(h,"TestPingServer: ok",!0,c):en(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(A),en(h,"TestPingServer: error",!1,c)})}function en(o,c,h,p,A){try{A&&(A.onload=null,A.onerror=null,A.onabort=null,A.ontimeout=null),p(h)}catch{}}function fp(){this.g=new Ys}function Co(o){this.i=o.Sb||null,this.h=o.ab||!1}g(Co,tr),Co.prototype.g=function(){return new ri(this.i,this.h)};function ri(o,c){me.call(this),this.H=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}g(ri,me),n=ri.prototype,n.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=o,this.D=c,this.readyState=1,Jr(this)},n.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};o&&(c.body=o),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,Xr(this)),this.readyState=0},n.Pa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Jr(this)),this.g&&(this.readyState=3,Jr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;jc(this)}else o.text().then(this.Oa.bind(this),this.ga.bind(this))};function jc(o){o.j.read().then(o.Ma.bind(o)).catch(o.ga.bind(o))}n.Ma=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Xr(this):Jr(this),this.readyState==3&&jc(this)}},n.Oa=function(o){this.g&&(this.response=this.responseText=o,Xr(this))},n.Na=function(o){this.g&&(this.response=o,Xr(this))},n.ga=function(){this.g&&Xr(this)};function Xr(o){o.readyState=4,o.l=null,o.j=null,o.B=null,Jr(o)}n.setRequestHeader=function(o,c){this.A.append(o,c)},n.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Jr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(ri.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function Hc(o){let c="";return Zn(o,function(h,p){c+=p,c+=":",c+=h,c+=`\r
`}),c}function Po(o,c,h){e:{for(p in h){var p=!1;break e}p=!0}p||(h=Hc(h),typeof o=="string"?h!=null&&Xe(h):ue(o,c,h))}function pe(o){me.call(this),this.headers=new Map,this.L=o||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}g(pe,me);var pp=/^https?$/i,gp=["POST","PUT"];n=pe.prototype,n.Fa=function(o){this.H=o},n.ea=function(o,c,h,p){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Zs.g(),this.g.onreadystatechange=T(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(R){Gc(this,R);return}if(o=h||"",h=new Map(this.headers),p)if(Object.getPrototypeOf(p)===Object.prototype)for(var A in p)h.set(A,p[A]);else if(typeof p.keys=="function"&&typeof p.get=="function")for(const R of p.keys())h.set(R,p.get(R));else throw Error("Unknown input type for opt_headers: "+String(p));p=Array.from(h.keys()).find(R=>R.toLowerCase()=="content-type"),A=a.FormData&&o instanceof a.FormData,!(Array.prototype.indexOf.call(gp,c,void 0)>=0)||p||A||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[R,N]of h)this.g.setRequestHeader(R,N);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(o),this.v=!1}catch(R){Gc(this,R)}};function Gc(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.o=5,Wc(o),si(o)}function Wc(o){o.A||(o.A=!0,we(o,"complete"),we(o,"error"))}n.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=o||7,we(this,"complete"),we(this,"abort"),si(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),si(this,!0)),pe.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Kc(this):this.Xa())},n.Xa=function(){Kc(this)};function Kc(o){if(o.h&&typeof i<"u"){if(o.v&&tn(o)==4)setTimeout(o.Ca.bind(o),0);else if(we(o,"readystatechange"),tn(o)==4){o.h=!1;try{const R=o.ca();e:switch(R){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break e;default:c=!1}var h;if(!(h=c)){var p;if(p=R===0){let N=String(o.D).match(Mc)[1]||null;!N&&a.self&&a.self.location&&(N=a.self.location.protocol.slice(0,-1)),p=!pp.test(N?N.toLowerCase():"")}h=p}if(h)we(o,"complete"),we(o,"success");else{o.o=6;try{var A=tn(o)>2?o.g.statusText:""}catch{A=""}o.l=A+" ["+o.ca()+"]",Wc(o)}}finally{si(o)}}}}function si(o,c){if(o.g){o.m&&(clearTimeout(o.m),o.m=null);const h=o.g;o.g=null,c||we(o,"ready");try{h.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function tn(o){return o.g?o.g.readyState:0}n.ca=function(){try{return tn(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Qs(c)}};function Qc(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.F){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function mp(o){const c={};o=(o.g&&tn(o)>=2&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let p=0;p<o.length;p++){if(_(o[p]))continue;var h=ei(o[p]);const A=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();const R=c[A]||[];c[A]=R,R.push(h)}Hs(c,function(p){return p.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Zr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function Yc(o){this.za=0,this.i=[],this.j=new xn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Zr("failFast",!1,o),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Zr("baseRetryDelayMs",5e3,o),this.Za=Zr("retryDelaySeedMs",1e4,o),this.Ta=Zr("forwardChannelMaxRetries",2,o),this.va=Zr("forwardChannelRequestTimeoutMs",2e4,o),this.ma=o&&o.xmlHttpFactory||void 0,this.Ua=o&&o.Rb||void 0,this.Aa=o&&o.useFetchStreams||!1,this.O=void 0,this.L=o&&o.supportsCrossDomainXhr||!1,this.M="",this.h=new xe(o&&o.concurrentRequestLimit),this.Ba=new fp,this.S=o&&o.fastHandshake||!1,this.R=o&&o.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=o&&o.Pb||!1,o&&o.ua&&this.j.ua(),o&&o.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&o&&o.detectBufferingProxy||!1,this.ia=void 0,o&&o.longPollingTimeout&&o.longPollingTimeout>0&&(this.ia=o.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Yc.prototype,n.ka=8,n.I=1,n.connect=function(o,c,h,p){Ne(0),this.W=o,this.H=c||{},h&&p!==void 0&&(this.H.OSID=h,this.H.OAID=p),this.F=this.X,this.J=il(this,null,this.W),oi(this)};function Do(o){if(Xc(o),o.I==3){var c=o.V++,h=_t(o.J);if(ue(h,"SID",o.M),ue(h,"RID",c),ue(h,"TYPE","terminate"),es(o,h),c=new it(o,o.j,c),c.M=2,c.A=ni(_t(h)),h=!1,a.navigator&&a.navigator.sendBeacon)try{h=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!h&&a.Image&&(new Image().src=c.A,h=!0),h||(c.g=ol(c.j,null),c.g.ea(c.A)),c.F=Date.now(),U(c)}sl(o)}function ii(o){o.g&&(xo(o),o.g.cancel(),o.g=null)}function Xc(o){ii(o),o.v&&(a.clearTimeout(o.v),o.v=null),ai(o),o.h.cancel(),o.m&&(typeof o.m=="number"&&a.clearTimeout(o.m),o.m=null)}function oi(o){if(!tt(o.h)&&!o.m){o.m=!0;var c=o.Ea;he||m(),ie||(he(),ie=!0),I.add(c,o),o.D=0}}function _p(o,c){return Vt(o.h)>=o.h.j-(o.m?1:0)?!1:o.m?(o.i=c.G.concat(o.i),!0):o.I==1||o.I==2||o.D>=(o.Sa?0:o.Ta)?!1:(o.m=Nn(d(o.Ea,o,c),rl(o,o.D)),o.D++,!0)}n.Ea=function(o){if(this.m)if(this.m=null,this.I==1){if(!o){this.V=Math.floor(Math.random()*1e5),o=this.V++;const A=new it(this,this.j,o);let R=this.o;if(this.U&&(R?(R=ge(R),Ee(R,this.U)):R=this.U),this.u!==null||this.R||(A.J=R,R=null),this.S)e:{for(var c=0,h=0;h<this.i.length;h++){t:{var p=this.i[h];if("__data__"in p.map&&(p=p.map.__data__,typeof p=="string")){p=p.length;break t}p=void 0}if(p===void 0)break;if(c+=p,c>4096){c=h;break e}if(c===4096||h===this.i.length-1){c=h+1;break e}}c=1e3}else c=1e3;c=Zc(this,A,c),h=_t(this.J),ue(h,"RID",o),ue(h,"CVER",22),this.G&&ue(h,"X-HTTP-Session-Id",this.G),es(this,h),R&&(this.R?c="headers="+Xe(Hc(R))+"&"+c:this.u&&Po(h,this.u,R)),_e(this.h,A),this.Ra&&ue(h,"TYPE","init"),this.S?(ue(h,"$req",c),ue(h,"SID","null"),A.U=!0,sr(A,h,null)):sr(A,h,c),this.I=2}}else this.I==3&&(o?Jc(this,o):this.i.length==0||tt(this.h)||Jc(this))};function Jc(o,c){var h;c?h=c.l:h=o.V++;const p=_t(o.J);ue(p,"SID",o.M),ue(p,"RID",h),ue(p,"AID",o.K),es(o,p),o.u&&o.o&&Po(p,o.u,o.o),h=new it(o,o.j,h,o.D+1),o.u===null&&(h.J=o.o),c&&(o.i=c.G.concat(o.i)),c=Zc(o,h,1e3),h.H=Math.round(o.va*.5)+Math.round(o.va*.5*Math.random()),_e(o.h,h),sr(h,p,c)}function es(o,c){o.H&&Zn(o.H,function(h,p){ue(c,p,h)}),o.l&&Zn({},function(h,p){ue(c,p,h)})}function Zc(o,c,h){h=Math.min(o.i.length,h);const p=o.l?d(o.l.Ka,o.l,o):null;e:{var A=o.i;let H=-1;for(;;){const Se=["count="+h];H==-1?h>0?(H=A[0].g,Se.push("ofs="+H)):H=0:Se.push("ofs="+H);let ae=!0;for(let Pe=0;Pe<h;Pe++){var R=A[Pe].g;const yt=A[Pe].map;if(R-=H,R<0)H=Math.max(0,A[Pe].g-100),ae=!1;else try{R="req"+R+"_"||"";try{var N=yt instanceof Map?yt:Object.entries(yt);for(const[Un,nn]of N){let rn=nn;l(nn)&&(rn=er(nn)),Se.push(R+Un+"="+encodeURIComponent(rn))}}catch(Un){throw Se.push(R+"type="+encodeURIComponent("_badmap")),Un}}catch{p&&p(yt)}}if(ae){N=Se.join("&");break e}}N=void 0}return o=o.i.splice(0,h),c.G=o,N}function el(o){if(!o.g&&!o.v){o.Y=1;var c=o.Da;he||m(),ie||(he(),ie=!0),I.add(c,o),o.A=0}}function No(o){return o.g||o.v||o.A>=3?!1:(o.Y++,o.v=Nn(d(o.Da,o),rl(o,o.A)),o.A++,!0)}n.Da=function(){if(this.v=null,tl(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var o=4*this.T;this.j.info("BP detection timer enabled: "+o),this.B=Nn(d(this.Wa,this),o)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ne(10),ii(this),tl(this))};function xo(o){o.B!=null&&(a.clearTimeout(o.B),o.B=null)}function tl(o){o.g=new it(o,o.j,"rpc",o.Y),o.u===null&&(o.g.J=o.o),o.g.P=0;var c=_t(o.na);ue(c,"RID","rpc"),ue(c,"SID",o.M),ue(c,"AID",o.K),ue(c,"CI",o.F?"0":"1"),!o.F&&o.ia&&ue(c,"TO",o.ia),ue(c,"TYPE","xmlhttp"),es(o,c),o.u&&o.o&&Po(c,o.u,o.o),o.O&&(o.g.H=o.O);var h=o.g;o=o.ba,h.M=1,h.A=ni(_t(c)),h.u=null,h.R=!0,qr(h,o)}n.Va=function(){this.C!=null&&(this.C=null,ii(this),No(this),Ne(19))};function ai(o){o.C!=null&&(a.clearTimeout(o.C),o.C=null)}function nl(o,c){var h=null;if(o.g==c){ai(o),xo(o),o.g=null;var p=2}else if(Vn(o.h,c))h=c.G,jr(o.h,c),p=1;else return;if(o.I!=0){if(c.o)if(p==1){h=c.u?c.u.length:0,c=Date.now()-c.F;var A=o.D;p=Qt(),we(p,new Yt(p,h)),oi(o)}else el(o);else if(A=c.m,A==3||A==0&&c.X>0||!(p==1&&_p(o,c)||p==2&&No(o)))switch(h&&h.length>0&&(c=o.h,c.i=c.i.concat(h)),A){case 1:Mn(o,5);break;case 4:Mn(o,10);break;case 3:Mn(o,6);break;default:Mn(o,2)}}}function rl(o,c){let h=o.Qa+Math.floor(Math.random()*o.Za);return o.isActive()||(h*=2),h*c}function Mn(o,c){if(o.j.info("Error code "+c),c==2){var h=d(o.bb,o),p=o.Ua;const A=!p;p=new Zt(p||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||Gr(p,"https"),ni(p),A?hp(p.toString(),h):dp(p.toString(),h)}else Ne(2);o.I=0,o.l&&o.l.pa(c),sl(o),Xc(o)}n.bb=function(o){o?(this.j.info("Successfully pinged google.com"),Ne(2)):(this.j.info("Failed to ping google.com"),Ne(1))};function sl(o){if(o.I=0,o.ja=[],o.l){const c=Hr(o.h);(c.length!=0||o.i.length!=0)&&(P(o.ja,c),P(o.ja,o.i),o.h.i.length=0,S(o.i),o.i.length=0),o.l.oa()}}function il(o,c,h){var p=h instanceof Zt?_t(h):new Zt(h);if(p.g!="")c&&(p.g=c+"."+p.g),Wr(p,p.u);else{var A=a.location;p=A.protocol,c=c?c+"."+A.hostname:A.hostname,A=+A.port;const R=new Zt(null);p&&Gr(R,p),c&&(R.g=c),A&&Wr(R,A),h&&(R.h=h),p=R}return h=o.G,c=o.wa,h&&c&&ue(p,h,c),ue(p,"VER",o.ka),es(o,p),p}function ol(o,c,h){if(c&&!o.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Aa&&!o.ma?new pe(new Co({ab:h})):new pe(o.ma),c.Fa(o.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function al(){}n=al.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function ci(){}ci.prototype.g=function(o,c){return new Ze(o,c)};function Ze(o,c){me.call(this),this.g=new Yc(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(o?o["X-WebChannel-Client-Profile"]=c.sa:o={"X-WebChannel-Client-Profile":c.sa}),this.g.U=o,(o=c&&c.Qb)&&!_(o)&&(this.g.u=o),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!_(c)&&(this.g.G=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new or(this)}g(Ze,me),Ze.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ze.prototype.close=function(){Do(this.g)},Ze.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.v&&(h={},h.__data__=er(o),o=h);c.i.push(new fe(c.Ya++,o)),c.I==3&&oi(c)},Ze.prototype.N=function(){this.g.l=null,delete this.j,Do(this.g),delete this.g,Ze.Z.N.call(this)};function cl(o){Kt.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){e:{for(const h in c){o=h;break e}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}g(cl,Kt);function ll(){Ye.call(this),this.status=1}g(ll,Ye);function or(o){this.g=o}g(or,al),or.prototype.ra=function(){we(this.g,"a")},or.prototype.qa=function(o){we(this.g,new cl(o))},or.prototype.pa=function(o){we(this.g,new ll)},or.prototype.oa=function(){we(this.g,"b")},ci.prototype.createWebChannel=ci.prototype.g,Ze.prototype.send=Ze.prototype.o,Ze.prototype.open=Ze.prototype.m,Ze.prototype.close=Ze.prototype.close,sd=function(){return new ci},rd=function(){return Qt()},nd=Ge,aa={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},On.NO_ERROR=0,On.TIMEOUT=8,On.HTTP_ERROR=6,vi=On,$r.COMPLETE="complete",td=$r,Ur.EventType=gt,gt.OPEN="a",gt.CLOSE="b",gt.ERROR="c",gt.MESSAGE="d",me.prototype.listen=me.prototype.J,cs=Ur,pe.prototype.listenOnce=pe.prototype.K,pe.prototype.getLastError=pe.prototype.Ha,pe.prototype.getLastErrorCode=pe.prototype.ya,pe.prototype.getStatus=pe.prototype.ca,pe.prototype.getResponseJson=pe.prototype.La,pe.prototype.getResponseText=pe.prototype.la,pe.prototype.send=pe.prototype.ea,pe.prototype.setWithCredentials=pe.prototype.Fa,ed=pe}).apply(typeof hi<"u"?hi:typeof self<"u"?self:typeof window<"u"?window:{});const Fl="@firebase/firestore",$l="4.9.2";class Fe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Fe.UNAUTHENTICATED=new Fe(null),Fe.GOOGLE_CREDENTIALS=new Fe("google-credentials-uid"),Fe.FIRST_PARTY=new Fe("first-party-uid"),Fe.MOCK_USER=new Fe("mock-user");let kr="12.3.0";const Wn=new Da("@firebase/firestore");function ar(){return Wn.logLevel}function L(n,...e){if(Wn.logLevel<=Y.DEBUG){const t=e.map(ja);Wn.debug(`Firestore (${kr}): ${n}`,...t)}}function jt(n,...e){if(Wn.logLevel<=Y.ERROR){const t=e.map(ja);Wn.error(`Firestore (${kr}): ${n}`,...t)}}function yr(n,...e){if(Wn.logLevel<=Y.WARN){const t=e.map(ja);Wn.warn(`Firestore (${kr}): ${n}`,...t)}}function ja(n){if(typeof n=="string")return n;try{return(function(t){return JSON.stringify(t)})(n)}catch{return n}}function $(n,e,t){let r="Unexpected state";typeof e=="string"?r=e:t=e,id(n,r,t)}function id(n,e,t){let r=`FIRESTORE (${kr}) INTERNAL ASSERTION FAILED: ${e} (ID: ${n.toString(16)})`;if(t!==void 0)try{r+=" CONTEXT: "+JSON.stringify(t)}catch{r+=" CONTEXT: "+t}throw jt(r),new Error(r)}function se(n,e,t,r){let s="Unexpected state";typeof t=="string"?s=t:r=t,n||id(e,s,r)}function z(n,e){return n}const k={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends Wt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Bt{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class od{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class sy{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(Fe.UNAUTHENTICATED)))}shutdown(){}}class iy{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class oy{constructor(e){this.t=e,this.currentUser=Fe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){se(this.o===void 0,42304);let r=this.i;const s=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve();let i=new Bt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Bt,e.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const u=i;e.enqueueRetryable((async()=>{await u.promise,await s(this.currentUser)}))},l=u=>{L("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((u=>l(u))),setTimeout((()=>{if(!this.auth){const u=this.t.getImmediate({optional:!0});u?l(u):(L("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Bt)}}),0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((r=>this.i!==e?(L("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(se(typeof r.accessToken=="string",31837,{l:r}),new od(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return se(e===null||typeof e=="string",2055,{h:e}),new Fe(e)}}class ay{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=Fe.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class cy{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new ay(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(Fe.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Bl{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ly{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,lt(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){se(this.o===void 0,3512);const r=i=>{i.error!=null&&L("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const a=i.token!==this.m;return this.m=i.token,L("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable((()=>r(i)))};const s=i=>{L("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((i=>s(i))),setTimeout((()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):L("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Bl(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((t=>t?(se(typeof t.token=="string",44558,{tokenResult:t}),this.m=t.token,new Bl(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function uy(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Ha{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=uy(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<t&&(r+=e.charAt(s[i]%62))}return r}}function X(n,e){return n<e?-1:n>e?1:0}function ca(n,e){const t=Math.min(n.length,e.length);for(let r=0;r<t;r++){const s=n.charAt(r),i=e.charAt(r);if(s!==i)return qo(s)===qo(i)?X(s,i):qo(s)?1:-1}return X(n.length,e.length)}const hy=55296,dy=57343;function qo(n){const e=n.charCodeAt(0);return e>=hy&&e<=dy}function Tr(n,e,t){return n.length===e.length&&n.every(((r,s)=>t(r,e[s])))}const ql="__name__";class Tt{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(637,{offset:t,range:e.length}),r===void 0?r=e.length-t:r>e.length-t&&$(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Tt.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Tt?e.forEach((r=>{t.push(r)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let s=0;s<r;s++){const i=Tt.compareSegments(e.get(s),t.get(s));if(i!==0)return i}return X(e.length,t.length)}static compareSegments(e,t){const r=Tt.isNumericId(e),s=Tt.isNumericId(t);return r&&!s?-1:!r&&s?1:r&&s?Tt.extractNumericId(e).compare(Tt.extractNumericId(t)):ca(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return fn.fromString(e.substring(4,e.length-2))}}class ce extends Tt{construct(e,t,r){return new ce(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new O(k.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter((s=>s.length>0)))}return new ce(t)}static emptyPath(){return new ce([])}}const fy=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ve extends Tt{construct(e,t,r){return new Ve(e,t,r)}static isValidIdentifier(e){return fy.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ve.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ql}static keyField(){return new Ve([ql])}static fromServerFormat(e){const t=[];let r="",s=0;const i=()=>{if(r.length===0)throw new O(k.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;s<e.length;){const l=e[s];if(l==="\\"){if(s+1===e.length)throw new O(k.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const u=e[s+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new O(k.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(i(),s++)}if(i(),a)throw new O(k.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ve(t)}static emptyPath(){return new Ve([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(ce.fromString(e))}static fromName(e){return new F(ce.fromString(e).popFirst(5))}static empty(){return new F(ce.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ce.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ce.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new ce(e.slice()))}}function ad(n,e,t){if(!t)throw new O(k.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function py(n,e,t,r){if(e===!0&&r===!0)throw new O(k.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function zl(n){if(!F.isDocumentKey(n))throw new O(k.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function jl(n){if(F.isDocumentKey(n))throw new O(k.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function cd(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function ro(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=(function(r){return r.constructor?r.constructor.name:null})(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function Ht(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new O(k.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ro(n);throw new O(k.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function gy(n,e){if(e<=0)throw new O(k.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function Re(n,e){const t={typeString:n};return e&&(t.value=e),t}function Vs(n,e){if(!cd(n))throw new O(k.INVALID_ARGUMENT,"JSON must be an object");let t;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in n)){t=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){t=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&a!==i.value){t=`Expected '${r}' field to equal '${i.value}'`;break}}if(t)throw new O(k.INVALID_ARGUMENT,t);return!0}const Hl=-62135596800,Gl=1e6;class oe{static now(){return oe.fromMillis(Date.now())}static fromDate(e){return oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Gl);return new oe(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new O(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new O(k.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Hl)throw new O(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new O(k.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Gl}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:oe._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Vs(e,oe._jsonSchema))return new oe(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-Hl;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}oe._jsonSchemaVersion="firestore/timestamp/1.0",oe._jsonSchema={type:Re("string",oe._jsonSchemaVersion),seconds:Re("number"),nanoseconds:Re("number")};class q{static fromTimestamp(e){return new q(e)}static min(){return new q(new oe(0,0))}static max(){return new q(new oe(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Is=-1;function my(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=q.fromTimestamp(r===1e9?new oe(t+1,0):new oe(t,r));return new gn(s,F.empty(),e)}function _y(n){return new gn(n.readTime,n.key,Is)}class gn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new gn(q.min(),F.empty(),Is)}static max(){return new gn(q.max(),F.empty(),Is)}}function yy(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:X(n.largestBatchId,e.largestBatchId))}const Ty="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ey{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Cr(n){if(n.code!==k.FAILED_PRECONDITION||n.message!==Ty)throw n;L("LocalStore","Unexpectedly lost primary lease")}class C{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new C(((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(t,i).next(r,s)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof C?t:C.resolve(t)}catch(t){return C.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):C.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):C.reject(t)}static resolve(e){return new C(((t,r)=>{t(e)}))}static reject(e){return new C(((t,r)=>{r(e)}))}static waitFor(e){return new C(((t,r)=>{let s=0,i=0,a=!1;e.forEach((l=>{++s,l.next((()=>{++i,a&&i===s&&t()}),(u=>r(u)))})),a=!0,i===s&&t()}))}static or(e){let t=C.resolve(!1);for(const r of e)t=t.next((s=>s?C.resolve(s):r()));return t}static forEach(e,t){const r=[];return e.forEach(((s,i)=>{r.push(t.call(this,s,i))})),this.waitFor(r)}static mapArray(e,t){return new C(((r,s)=>{const i=e.length,a=new Array(i);let l=0;for(let u=0;u<i;u++){const d=u;t(e[d]).next((f=>{a[d]=f,++l,l===i&&r(a)}),(f=>s(f)))}}))}static doWhile(e,t){return new C(((r,s)=>{const i=()=>{e()===!0?t().next((()=>{i()}),s):r()};i()}))}}function wy(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Pr(n){return n.name==="IndexedDbTransactionError"}class so{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>t.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}so.ce=-1;const Ga=-1;function io(n){return n==null}function Ui(n){return n===0&&1/n==-1/0}function Iy(n){return typeof n=="number"&&Number.isInteger(n)&&!Ui(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const ld="";function vy(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Wl(e)),e=Ay(n.get(t),e);return Wl(e)}function Ay(n,e){let t=e;const r=n.length;for(let s=0;s<r;s++){const i=n.charAt(s);switch(i){case"\0":t+="";break;case ld:t+="";break;default:t+=i}}return t}function Wl(n){return n+ld+""}function Kl(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function wn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ud(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class de{constructor(e,t){this.comparator=e,this.root=t||Oe.EMPTY}insert(e,t){return new de(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Oe.BLACK,null,null))}remove(e){return new de(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Oe.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return t+r.left.size;s<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,r)=>(e(t,r),!1)))}toString(){const e=[];return this.inorderTraversal(((t,r)=>(e.push(`${t}:${r}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new di(this.root,e,this.comparator,!1)}getReverseIterator(){return new di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new di(this.root,e,this.comparator,!0)}}class di{constructor(e,t,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Oe{constructor(e,t,r,s,i){this.key=e,this.value=t,this.color=r??Oe.RED,this.left=s??Oe.EMPTY,this.right=i??Oe.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,s,i){return new Oe(e??this.key,t??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,t,r),null):i===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Oe.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return Oe.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Oe.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Oe.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw $(27949);return e+(this.isRed()?0:1)}}Oe.EMPTY=null,Oe.RED=!0,Oe.BLACK=!1;Oe.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(e,t,r,s,i){return this}insert(e,t,r){return new Oe(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ke{constructor(e){this.comparator=e,this.data=new de(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,r)=>(e(t),!1)))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ql(this.data.getIterator())}getIteratorFrom(e){return new Ql(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((r=>{t=t.add(r)})),t}isEqual(e){if(!(e instanceof ke)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new ke(this.comparator);return t.data=e,t}}class Ql{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class et{constructor(e){this.fields=e,e.sort(Ve.comparator)}static empty(){return new et([])}unionWith(e){let t=new ke(Ve.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new et(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Tr(this.fields,e.fields,((t,r)=>t.isEqual(r)))}}class hd extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Me{constructor(e){this.binaryString=e}static fromBase64String(e){const t=(function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new hd("Invalid base64 string: "+i):i}})(e);return new Me(t)}static fromUint8Array(e){const t=(function(s){let i="";for(let a=0;a<s.length;++a)i+=String.fromCharCode(s[a]);return i})(e);return new Me(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(t){return btoa(t)})(this.binaryString)}toUint8Array(){return(function(t){const r=new Uint8Array(t.length);for(let s=0;s<t.length;s++)r[s]=t.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Me.EMPTY_BYTE_STRING=new Me("");const by=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mn(n){if(se(!!n,39018),typeof n=="string"){let e=0;const t=by.exec(n);if(se(!!t,46558,{timestamp:n}),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ye(n.seconds),nanos:ye(n.nanos)}}function ye(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Me.fromBase64String(n):Me.fromUint8Array(n)}const dd="server_timestamp",fd="__type__",pd="__previous_value__",gd="__local_write_time__";function Wa(n){return(n?.mapValue?.fields||{})[fd]?.stringValue===dd}function oo(n){const e=n.mapValue.fields[pd];return Wa(e)?oo(e):e}function vs(n){const e=mn(n.mapValue.fields[gd].timestampValue);return new oe(e.seconds,e.nanos)}class Ry{constructor(e,t,r,s,i,a,l,u,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=u,this.useFetchStreams=d,this.isUsingEmulator=f}}const Fi="(default)";class As{constructor(e,t){this.projectId=e,this.database=t||Fi}static empty(){return new As("","")}get isDefaultDatabase(){return this.database===Fi}isEqual(e){return e instanceof As&&e.projectId===this.projectId&&e.database===this.database}}const md="__type__",Sy="__max__",fi={mapValue:{}},_d="__vector__",$i="value";function yn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Wa(n)?4:Cy(n)?9007199254740991:ky(n)?10:11:$(28295,{value:n})}function St(n,e){if(n===e)return!0;const t=yn(n);if(t!==yn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return vs(n).isEqual(vs(e));case 3:return(function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const a=mn(s.timestampValue),l=mn(i.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,e);case 5:return n.stringValue===e.stringValue;case 6:return(function(s,i){return _n(s.bytesValue).isEqual(_n(i.bytesValue))})(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return(function(s,i){return ye(s.geoPointValue.latitude)===ye(i.geoPointValue.latitude)&&ye(s.geoPointValue.longitude)===ye(i.geoPointValue.longitude)})(n,e);case 2:return(function(s,i){if("integerValue"in s&&"integerValue"in i)return ye(s.integerValue)===ye(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const a=ye(s.doubleValue),l=ye(i.doubleValue);return a===l?Ui(a)===Ui(l):isNaN(a)&&isNaN(l)}return!1})(n,e);case 9:return Tr(n.arrayValue.values||[],e.arrayValue.values||[],St);case 10:case 11:return(function(s,i){const a=s.mapValue.fields||{},l=i.mapValue.fields||{};if(Kl(a)!==Kl(l))return!1;for(const u in a)if(a.hasOwnProperty(u)&&(l[u]===void 0||!St(a[u],l[u])))return!1;return!0})(n,e);default:return $(52216,{left:n})}}function bs(n,e){return(n.values||[]).find((t=>St(t,e)))!==void 0}function Er(n,e){if(n===e)return 0;const t=yn(n),r=yn(e);if(t!==r)return X(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return(function(i,a){const l=ye(i.integerValue||i.doubleValue),u=ye(a.integerValue||a.doubleValue);return l<u?-1:l>u?1:l===u?0:isNaN(l)?isNaN(u)?0:-1:1})(n,e);case 3:return Yl(n.timestampValue,e.timestampValue);case 4:return Yl(vs(n),vs(e));case 5:return ca(n.stringValue,e.stringValue);case 6:return(function(i,a){const l=_n(i),u=_n(a);return l.compareTo(u)})(n.bytesValue,e.bytesValue);case 7:return(function(i,a){const l=i.split("/"),u=a.split("/");for(let d=0;d<l.length&&d<u.length;d++){const f=X(l[d],u[d]);if(f!==0)return f}return X(l.length,u.length)})(n.referenceValue,e.referenceValue);case 8:return(function(i,a){const l=X(ye(i.latitude),ye(a.latitude));return l!==0?l:X(ye(i.longitude),ye(a.longitude))})(n.geoPointValue,e.geoPointValue);case 9:return Xl(n.arrayValue,e.arrayValue);case 10:return(function(i,a){const l=i.fields||{},u=a.fields||{},d=l[$i]?.arrayValue,f=u[$i]?.arrayValue,g=X(d?.values?.length||0,f?.values?.length||0);return g!==0?g:Xl(d,f)})(n.mapValue,e.mapValue);case 11:return(function(i,a){if(i===fi.mapValue&&a===fi.mapValue)return 0;if(i===fi.mapValue)return 1;if(a===fi.mapValue)return-1;const l=i.fields||{},u=Object.keys(l),d=a.fields||{},f=Object.keys(d);u.sort(),f.sort();for(let g=0;g<u.length&&g<f.length;++g){const T=ca(u[g],f[g]);if(T!==0)return T;const S=Er(l[u[g]],d[f[g]]);if(S!==0)return S}return X(u.length,f.length)})(n.mapValue,e.mapValue);default:throw $(23264,{he:t})}}function Yl(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);const t=mn(n),r=mn(e),s=X(t.seconds,r.seconds);return s!==0?s:X(t.nanos,r.nanos)}function Xl(n,e){const t=n.values||[],r=e.values||[];for(let s=0;s<t.length&&s<r.length;++s){const i=Er(t[s],r[s]);if(i)return i}return X(t.length,r.length)}function wr(n){return la(n)}function la(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(t){const r=mn(t);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(t){return _n(t).toBase64()})(n.bytesValue):"referenceValue"in n?(function(t){return F.fromName(t).toString()})(n.referenceValue):"geoPointValue"in n?(function(t){return`geo(${t.latitude},${t.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(t){let r="[",s=!0;for(const i of t.values||[])s?s=!1:r+=",",r+=la(i);return r+"]"})(n.arrayValue):"mapValue"in n?(function(t){const r=Object.keys(t.fields||{}).sort();let s="{",i=!0;for(const a of r)i?i=!1:s+=",",s+=`${a}:${la(t.fields[a])}`;return s+"}"})(n.mapValue):$(61005,{value:n})}function Ai(n){switch(yn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=oo(n);return e?16+Ai(e):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,i)=>s+Ai(i)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return wn(r.fields,((i,a)=>{s+=i.length+Ai(a)})),s})(n.mapValue);default:throw $(13486,{value:n})}}function Jl(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function ua(n){return!!n&&"integerValue"in n}function Ka(n){return!!n&&"arrayValue"in n}function Zl(n){return!!n&&"nullValue"in n}function eu(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function bi(n){return!!n&&"mapValue"in n}function ky(n){return(n?.mapValue?.fields||{})[md]?.stringValue===_d}function gs(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const e={mapValue:{fields:{}}};return wn(n.mapValue.fields,((t,r)=>e.mapValue.fields[t]=gs(r))),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=gs(n.arrayValue.values[t]);return e}return{...n}}function Cy(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Sy}class Qe{constructor(e){this.value=e}static empty(){return new Qe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!bi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=gs(t)}setAll(e){let t=Ve.emptyPath(),r={},s=[];e.forEach(((a,l)=>{if(!t.isImmediateParentOf(l)){const u=this.getFieldsMap(t);this.applyChanges(u,r,s),r={},s=[],t=l.popLast()}a?r[l.lastSegment()]=gs(a):s.push(l.lastSegment())}));const i=this.getFieldsMap(t);this.applyChanges(i,r,s)}delete(e){const t=this.field(e.popLast());bi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return St(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=t.mapValue.fields[e.get(r)];bi(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,r){wn(t,((s,i)=>e[s]=i));for(const s of r)delete e[s]}clone(){return new Qe(gs(this.value))}}function yd(n){const e=[];return wn(n.fields,((t,r)=>{const s=new Ve([t]);if(bi(r)){const i=yd(r.mapValue).fields;if(i.length===0)e.push(s);else for(const a of i)e.push(s.child(a))}else e.push(s)})),new et(e)}class $e{constructor(e,t,r,s,i,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=s,this.createTime=i,this.data=a,this.documentState=l}static newInvalidDocument(e){return new $e(e,0,q.min(),q.min(),q.min(),Qe.empty(),0)}static newFoundDocument(e,t,r,s){return new $e(e,1,t,q.min(),r,s,0)}static newNoDocument(e,t){return new $e(e,2,t,q.min(),q.min(),Qe.empty(),0)}static newUnknownDocument(e,t){return new $e(e,3,t,q.min(),q.min(),Qe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(q.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=q.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof $e&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new $e(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Bi{constructor(e,t){this.position=e,this.inclusive=t}}function tu(n,e,t){let r=0;for(let s=0;s<n.position.length;s++){const i=e[s],a=n.position[s];if(i.field.isKeyField()?r=F.comparator(F.fromName(a.referenceValue),t.key):r=Er(a,t.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function nu(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!St(n.position[t],e.position[t]))return!1;return!0}class Rs{constructor(e,t="asc"){this.field=e,this.dir=t}}function Py(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Td{}class be extends Td{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Ny(e,t,r):t==="array-contains"?new Vy(e,r):t==="in"?new Ly(e,r):t==="not-in"?new My(e,r):t==="array-contains-any"?new Uy(e,r):new be(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new xy(e,r):new Oy(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&t.nullValue===void 0&&this.matchesComparison(Er(t,this.value)):t!==null&&yn(this.value)===yn(t)&&this.matchesComparison(Er(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class dt extends Td{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new dt(e,t)}matches(e){return Ed(this)?this.filters.find((t=>!t.matches(e)))===void 0:this.filters.find((t=>t.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ed(n){return n.op==="and"}function wd(n){return Dy(n)&&Ed(n)}function Dy(n){for(const e of n.filters)if(e instanceof dt)return!1;return!0}function ha(n){if(n instanceof be)return n.field.canonicalString()+n.op.toString()+wr(n.value);if(wd(n))return n.filters.map((e=>ha(e))).join(",");{const e=n.filters.map((t=>ha(t))).join(",");return`${n.op}(${e})`}}function Id(n,e){return n instanceof be?(function(r,s){return s instanceof be&&r.op===s.op&&r.field.isEqual(s.field)&&St(r.value,s.value)})(n,e):n instanceof dt?(function(r,s){return s instanceof dt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((i,a,l)=>i&&Id(a,s.filters[l])),!0):!1})(n,e):void $(19439)}function vd(n){return n instanceof be?(function(t){return`${t.field.canonicalString()} ${t.op} ${wr(t.value)}`})(n):n instanceof dt?(function(t){return t.op.toString()+" {"+t.getFilters().map(vd).join(" ,")+"}"})(n):"Filter"}class Ny extends be{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class xy extends be{constructor(e,t){super(e,"in",t),this.keys=Ad("in",t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class Oy extends be{constructor(e,t){super(e,"not-in",t),this.keys=Ad("not-in",t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function Ad(n,e){return(e.arrayValue?.values||[]).map((t=>F.fromName(t.referenceValue)))}class Vy extends be{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ka(t)&&bs(t.arrayValue,this.value)}}class Ly extends be{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&bs(this.value.arrayValue,t)}}class My extends be{constructor(e,t){super(e,"not-in",t)}matches(e){if(bs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&t.nullValue===void 0&&!bs(this.value.arrayValue,t)}}class Uy extends be{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ka(t)||!t.arrayValue.values)&&t.arrayValue.values.some((r=>bs(this.value.arrayValue,r)))}}class Fy{constructor(e,t=null,r=[],s=[],i=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=a,this.endAt=l,this.Te=null}}function ru(n,e=null,t=[],r=[],s=null,i=null,a=null){return new Fy(n,e,t,r,s,i,a)}function Qa(n){const e=z(n);if(e.Te===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((r=>ha(r))).join(","),t+="|ob:",t+=e.orderBy.map((r=>(function(i){return i.field.canonicalString()+i.dir})(r))).join(","),io(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((r=>wr(r))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((r=>wr(r))).join(",")),e.Te=t}return e.Te}function Ya(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Py(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Id(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!nu(n.startAt,e.startAt)&&nu(n.endAt,e.endAt)}function da(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class Dr{constructor(e,t=null,r=[],s=[],i=null,a="F",l=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=a,this.startAt=l,this.endAt=u,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function $y(n,e,t,r,s,i,a,l){return new Dr(n,e,t,r,s,i,a,l)}function Xa(n){return new Dr(n)}function su(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function bd(n){return n.collectionGroup!==null}function ms(n){const e=z(n);if(e.Ie===null){e.Ie=[];const t=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),t.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new ke(Ve.comparator);return a.filters.forEach((u=>{u.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(e).forEach((i=>{t.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new Rs(i,r))})),t.has(Ve.keyField().canonicalString())||e.Ie.push(new Rs(Ve.keyField(),r))}return e.Ie}function wt(n){const e=z(n);return e.Ee||(e.Ee=By(e,ms(n))),e.Ee}function By(n,e){if(n.limitType==="F")return ru(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map((s=>{const i=s.dir==="desc"?"asc":"desc";return new Rs(s.field,i)}));const t=n.endAt?new Bi(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Bi(n.startAt.position,n.startAt.inclusive):null;return ru(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function fa(n,e){const t=n.filters.concat([e]);return new Dr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function qi(n,e,t){return new Dr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ao(n,e){return Ya(wt(n),wt(e))&&n.limitType===e.limitType}function Rd(n){return`${Qa(wt(n))}|lt:${n.limitType}`}function cr(n){return`Query(target=${(function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map((s=>vd(s))).join(", ")}]`),io(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map((s=>wr(s))).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map((s=>wr(s))).join(",")),`Target(${r})`})(wt(n))}; limitType=${n.limitType})`}function co(n,e){return e.isFoundDocument()&&(function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):F.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)})(n,e)&&(function(r,s){for(const i of ms(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0})(n,e)&&(function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0})(n,e)&&(function(r,s){return!(r.startAt&&!(function(a,l,u){const d=tu(a,l,u);return a.inclusive?d<=0:d<0})(r.startAt,ms(r),s)||r.endAt&&!(function(a,l,u){const d=tu(a,l,u);return a.inclusive?d>=0:d>0})(r.endAt,ms(r),s))})(n,e)}function qy(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Sd(n){return(e,t)=>{let r=!1;for(const s of ms(n)){const i=zy(s,e,t);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function zy(n,e,t){const r=n.field.isKeyField()?F.comparator(e.key,t.key):(function(i,a,l){const u=a.data.field(i),d=l.data.field(i);return u!==null&&d!==null?Er(u,d):$(42886)})(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $(19790,{direction:n.dir})}}class Yn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[t]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){wn(this.inner,((t,r)=>{for(const[s,i]of r)e(s,i)}))}isEmpty(){return ud(this.inner)}size(){return this.innerSize}}const jy=new de(F.comparator);function Gt(){return jy}const kd=new de(F.comparator);function ls(...n){let e=kd;for(const t of n)e=e.insert(t.key,t);return e}function Cd(n){let e=kd;return n.forEach(((t,r)=>e=e.insert(t,r.overlayedDocument))),e}function Bn(){return _s()}function Pd(){return _s()}function _s(){return new Yn((n=>n.toString()),((n,e)=>n.isEqual(e)))}const Hy=new de(F.comparator),Gy=new ke(F.comparator);function J(...n){let e=Gy;for(const t of n)e=e.add(t);return e}const Wy=new ke(X);function Ky(){return Wy}function Ja(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ui(e)?"-0":e}}function Dd(n){return{integerValue:""+n}}function Qy(n,e){return Iy(e)?Dd(e):Ja(n,e)}class lo{constructor(){this._=void 0}}function Yy(n,e,t){return n instanceof zi?(function(s,i){const a={fields:{[fd]:{stringValue:dd},[gd]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Wa(i)&&(i=oo(i)),i&&(a.fields[pd]=i),{mapValue:a}})(t,e):n instanceof Ss?xd(n,e):n instanceof ks?Od(n,e):(function(s,i){const a=Nd(s,i),l=iu(a)+iu(s.Ae);return ua(a)&&ua(s.Ae)?Dd(l):Ja(s.serializer,l)})(n,e)}function Xy(n,e,t){return n instanceof Ss?xd(n,e):n instanceof ks?Od(n,e):t}function Nd(n,e){return n instanceof ji?(function(r){return ua(r)||(function(i){return!!i&&"doubleValue"in i})(r)})(e)?e:{integerValue:0}:null}class zi extends lo{}class Ss extends lo{constructor(e){super(),this.elements=e}}function xd(n,e){const t=Vd(e);for(const r of n.elements)t.some((s=>St(s,r)))||t.push(r);return{arrayValue:{values:t}}}class ks extends lo{constructor(e){super(),this.elements=e}}function Od(n,e){let t=Vd(e);for(const r of n.elements)t=t.filter((s=>!St(s,r)));return{arrayValue:{values:t}}}class ji extends lo{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function iu(n){return ye(n.integerValue||n.doubleValue)}function Vd(n){return Ka(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function Jy(n,e){return n.field.isEqual(e.field)&&(function(r,s){return r instanceof Ss&&s instanceof Ss||r instanceof ks&&s instanceof ks?Tr(r.elements,s.elements,St):r instanceof ji&&s instanceof ji?St(r.Ae,s.Ae):r instanceof zi&&s instanceof zi})(n.transform,e.transform)}class Zy{constructor(e,t){this.version=e,this.transformResults=t}}class It{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new It}static exists(e){return new It(void 0,e)}static updateTime(e){return new It(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ri(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class uo{}function Ld(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ud(n.key,It.none()):new Ls(n.key,n.data,It.none());{const t=n.data,r=Qe.empty();let s=new ke(Ve.comparator);for(let i of e.fields)if(!s.has(i)){let a=t.field(i);a===null&&i.length>1&&(i=i.popLast(),a=t.field(i)),a===null?r.delete(i):r.set(i,a),s=s.add(i)}return new In(n.key,r,new et(s.toArray()),It.none())}}function eT(n,e,t){n instanceof Ls?(function(s,i,a){const l=s.value.clone(),u=au(s.fieldTransforms,i,a.transformResults);l.setAll(u),i.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,e,t):n instanceof In?(function(s,i,a){if(!Ri(s.precondition,i))return void i.convertToUnknownDocument(a.version);const l=au(s.fieldTransforms,i,a.transformResults),u=i.data;u.setAll(Md(s)),u.setAll(l),i.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,e,t):(function(s,i,a){i.convertToNoDocument(a.version).setHasCommittedMutations()})(0,e,t)}function ys(n,e,t,r){return n instanceof Ls?(function(i,a,l,u){if(!Ri(i.precondition,a))return l;const d=i.value.clone(),f=cu(i.fieldTransforms,u,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,e,t,r):n instanceof In?(function(i,a,l,u){if(!Ri(i.precondition,a))return l;const d=cu(i.fieldTransforms,u,a),f=a.data;return f.setAll(Md(i)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),l===null?null:l.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map((g=>g.field)))})(n,e,t,r):(function(i,a,l){return Ri(i.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,e,t)}function tT(n,e){let t=null;for(const r of n.fieldTransforms){const s=e.data.field(r.field),i=Nd(r.transform,s||null);i!=null&&(t===null&&(t=Qe.empty()),t.set(r.field,i))}return t||null}function ou(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Tr(r,s,((i,a)=>Jy(i,a)))})(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ls extends uo{constructor(e,t,r,s=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class In extends uo{constructor(e,t,r,s,i=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Md(n){const e=new Map;return n.fieldMask.fields.forEach((t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}})),e}function au(n,e,t){const r=new Map;se(n.length===t.length,32656,{Re:t.length,Ve:n.length});for(let s=0;s<t.length;s++){const i=n[s],a=i.transform,l=e.data.field(i.field);r.set(i.field,Xy(a,l,t[s]))}return r}function cu(n,e,t){const r=new Map;for(const s of n){const i=s.transform,a=t.data.field(s.field);r.set(s.field,Yy(i,a,e))}return r}class Ud extends uo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class nT extends uo{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class rT{constructor(e,t,r,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&eT(i,e,r[s])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ys(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ys(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Pd();return this.mutations.forEach((s=>{const i=e.get(s.key),a=i.overlayedDocument;let l=this.applyToLocalView(a,i.mutatedFields);l=t.has(s.key)?null:l;const u=Ld(a,l);u!==null&&r.set(s.key,u),a.isValidDocument()||a.convertToNoDocument(q.min())})),r}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),J())}isEqual(e){return this.batchId===e.batchId&&Tr(this.mutations,e.mutations,((t,r)=>ou(t,r)))&&Tr(this.baseMutations,e.baseMutations,((t,r)=>ou(t,r)))}}class Za{constructor(e,t,r,s){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=s}static from(e,t,r){se(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=(function(){return Hy})();const i=e.mutations;for(let a=0;a<i.length;a++)s=s.insert(i[a].key,r[a].version);return new Za(e,t,r,s)}}class sT{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class iT{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ae,Z;function oT(n){switch(n){case k.OK:return $(64938);case k.CANCELLED:case k.UNKNOWN:case k.DEADLINE_EXCEEDED:case k.RESOURCE_EXHAUSTED:case k.INTERNAL:case k.UNAVAILABLE:case k.UNAUTHENTICATED:return!1;case k.INVALID_ARGUMENT:case k.NOT_FOUND:case k.ALREADY_EXISTS:case k.PERMISSION_DENIED:case k.FAILED_PRECONDITION:case k.ABORTED:case k.OUT_OF_RANGE:case k.UNIMPLEMENTED:case k.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function Fd(n){if(n===void 0)return jt("GRPC error has no .code"),k.UNKNOWN;switch(n){case Ae.OK:return k.OK;case Ae.CANCELLED:return k.CANCELLED;case Ae.UNKNOWN:return k.UNKNOWN;case Ae.DEADLINE_EXCEEDED:return k.DEADLINE_EXCEEDED;case Ae.RESOURCE_EXHAUSTED:return k.RESOURCE_EXHAUSTED;case Ae.INTERNAL:return k.INTERNAL;case Ae.UNAVAILABLE:return k.UNAVAILABLE;case Ae.UNAUTHENTICATED:return k.UNAUTHENTICATED;case Ae.INVALID_ARGUMENT:return k.INVALID_ARGUMENT;case Ae.NOT_FOUND:return k.NOT_FOUND;case Ae.ALREADY_EXISTS:return k.ALREADY_EXISTS;case Ae.PERMISSION_DENIED:return k.PERMISSION_DENIED;case Ae.FAILED_PRECONDITION:return k.FAILED_PRECONDITION;case Ae.ABORTED:return k.ABORTED;case Ae.OUT_OF_RANGE:return k.OUT_OF_RANGE;case Ae.UNIMPLEMENTED:return k.UNIMPLEMENTED;case Ae.DATA_LOSS:return k.DATA_LOSS;default:return $(39323,{code:n})}}(Z=Ae||(Ae={}))[Z.OK=0]="OK",Z[Z.CANCELLED=1]="CANCELLED",Z[Z.UNKNOWN=2]="UNKNOWN",Z[Z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Z[Z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Z[Z.NOT_FOUND=5]="NOT_FOUND",Z[Z.ALREADY_EXISTS=6]="ALREADY_EXISTS",Z[Z.PERMISSION_DENIED=7]="PERMISSION_DENIED",Z[Z.UNAUTHENTICATED=16]="UNAUTHENTICATED",Z[Z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Z[Z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Z[Z.ABORTED=10]="ABORTED",Z[Z.OUT_OF_RANGE=11]="OUT_OF_RANGE",Z[Z.UNIMPLEMENTED=12]="UNIMPLEMENTED",Z[Z.INTERNAL=13]="INTERNAL",Z[Z.UNAVAILABLE=14]="UNAVAILABLE",Z[Z.DATA_LOSS=15]="DATA_LOSS";function aT(){return new TextEncoder}const cT=new fn([4294967295,4294967295],0);function lu(n){const e=aT().encode(n),t=new Zh;return t.update(e),new Uint8Array(t.digest())}function uu(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new fn([t,r],0),new fn([s,i],0)]}class ec{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new us(`Invalid padding: ${t}`);if(r<0)throw new us(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new us(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new us(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=fn.fromNumber(this.ge)}ye(e,t,r){let s=e.add(t.multiply(fn.fromNumber(r)));return s.compare(cT)===1&&(s=new fn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const t=lu(e),[r,s]=uu(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);if(!this.we(a))return!1}return!0}static create(e,t,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),a=new ec(i,s,t);return r.forEach((l=>a.insert(l))),a}insert(e){if(this.ge===0)return;const t=lu(e),[r,s]=uu(t);for(let i=0;i<this.hashCount;i++){const a=this.ye(r,s,i);this.Se(a)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class us extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ho{constructor(e,t,r,s,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const s=new Map;return s.set(e,Ms.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ho(q.min(),s,new de(X),Gt(),J())}}class Ms{constructor(e,t,r,s,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Ms(r,t,J(),J(),J())}}class Si{constructor(e,t,r,s){this.be=e,this.removedTargetIds=t,this.key=r,this.De=s}}class $d{constructor(e,t){this.targetId=e,this.Ce=t}}class Bd{constructor(e,t,r=Me.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=s}}class hu{constructor(){this.ve=0,this.Fe=du(),this.Me=Me.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=J(),t=J(),r=J();return this.Fe.forEach(((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:r=r.add(s);break;default:$(38017,{changeType:i})}})),new Ms(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=du()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,se(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class lT{constructor(e){this.Ge=e,this.ze=new Map,this.je=Gt(),this.Je=pi(),this.He=pi(),this.Ye=new de(X)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,(t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:$(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach(((r,s)=>{this.rt(s)&&t(s)}))}st(e){const t=e.targetId,r=e.Ce.count,s=this.ot(t);if(s){const i=s.target;if(da(i))if(r===0){const a=new F(i.path);this.et(t,a,$e.newNoDocument(a,q.min()))}else se(r===1,20013,{expectedCount:r});else{const a=this._t(t);if(a!==r){const l=this.ut(e),u=l?this.ct(l,e,a):1;if(u!==0){this.it(t);const d=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,d)}}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=t;let a,l;try{a=_n(r).toUint8Array()}catch(u){if(u instanceof hd)return yr("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{l=new ec(a,s,i)}catch(u){return yr(u instanceof us?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return l.ge===0?null:l}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let s=0;return r.forEach((i=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${i.path.canonicalString()}`;e.mightContain(l)||(this.et(t,i,null),s++)})),s}Tt(e){const t=new Map;this.ze.forEach(((i,a)=>{const l=this.ot(a);if(l){if(i.current&&da(l.target)){const u=new F(l.target.path);this.It(u).has(a)||this.Et(a,u)||this.et(a,u,$e.newNoDocument(u,e))}i.Be&&(t.set(a,i.ke()),i.qe())}}));let r=J();this.He.forEach(((i,a)=>{let l=!0;a.forEachWhile((u=>{const d=this.ot(u);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(i))})),this.je.forEach(((i,a)=>a.setReadTime(e)));const s=new ho(e,t,this.Ye,this.je,r);return this.je=Gt(),this.Je=pi(),this.He=pi(),this.Ye=new de(X),s}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,t)?s.Qe(t,1):s.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new hu,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new ke(X),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new ke(X),this.Je=this.Je.insert(e,t)),t}rt(e){const t=this.ot(e)!==null;return t||L("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new hu),this.Ge.getRemoteKeysForTarget(e).forEach((t=>{this.et(e,t,null)}))}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function pi(){return new de(F.comparator)}function du(){return new de(F.comparator)}const uT={asc:"ASCENDING",desc:"DESCENDING"},hT={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},dT={and:"AND",or:"OR"};class fT{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function pa(n,e){return n.useProto3Json||io(e)?e:{value:e}}function Hi(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qd(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function pT(n,e){return Hi(n,e.toTimestamp())}function vt(n){return se(!!n,49232),q.fromTimestamp((function(t){const r=mn(t);return new oe(r.seconds,r.nanos)})(n))}function tc(n,e){return ga(n,e).canonicalString()}function ga(n,e){const t=(function(s){return new ce(["projects",s.projectId,"databases",s.database])})(n).child("documents");return e===void 0?t:t.child(e)}function zd(n){const e=ce.fromString(n);return se(Kd(e),10190,{key:e.toString()}),e}function ma(n,e){return tc(n.databaseId,e.path)}function zo(n,e){const t=zd(e);if(t.get(1)!==n.databaseId.projectId)throw new O(k.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new O(k.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(Hd(t))}function jd(n,e){return tc(n.databaseId,e)}function gT(n){const e=zd(n);return e.length===4?ce.emptyPath():Hd(e)}function _a(n){return new ce(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Hd(n){return se(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function fu(n,e,t){return{name:ma(n,e),fields:t.value.mapValue.fields}}function mT(n,e){let t;if("targetChange"in e){e.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:$(39313,{state:d})})(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=(function(d,f){return d.useProto3Json?(se(f===void 0||typeof f=="string",58123),Me.fromBase64String(f||"")):(se(f===void 0||f instanceof Buffer||f instanceof Uint8Array,16193),Me.fromUint8Array(f||new Uint8Array))})(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&(function(d){const f=d.code===void 0?k.UNKNOWN:Fd(d.code);return new O(f,d.message||"")})(a);t=new Bd(r,s,i,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=zo(n,r.document.name),i=vt(r.document.updateTime),a=r.document.createTime?vt(r.document.createTime):q.min(),l=new Qe({mapValue:{fields:r.document.fields}}),u=$e.newFoundDocument(s,i,a,l),d=r.targetIds||[],f=r.removedTargetIds||[];t=new Si(d,f,u.key,u)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=zo(n,r.document),i=r.readTime?vt(r.readTime):q.min(),a=$e.newNoDocument(s,i),l=r.removedTargetIds||[];t=new Si([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=zo(n,r.document),i=r.removedTargetIds||[];t=new Si([],i,s,null)}else{if(!("filter"in e))return $(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,a=new iT(s,i),l=r.targetId;t=new $d(l,a)}}return t}function _T(n,e){let t;if(e instanceof Ls)t={update:fu(n,e.key,e.value)};else if(e instanceof Ud)t={delete:ma(n,e.key)};else if(e instanceof In)t={update:fu(n,e.key,e.data),updateMask:RT(e.fieldMask)};else{if(!(e instanceof nT))return $(16599,{Vt:e.type});t={verify:ma(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map((r=>(function(i,a){const l=a.transform;if(l instanceof zi)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Ss)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof ks)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof ji)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw $(20930,{transform:a.transform})})(0,r)))),e.precondition.isNone||(t.currentDocument=(function(s,i){return i.updateTime!==void 0?{updateTime:pT(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:$(27497)})(n,e.precondition)),t}function yT(n,e){return n&&n.length>0?(se(e!==void 0,14353),n.map((t=>(function(s,i){let a=s.updateTime?vt(s.updateTime):vt(i);return a.isEqual(q.min())&&(a=vt(i)),new Zy(a,s.transformResults||[])})(t,e)))):[]}function TT(n,e){return{documents:[jd(n,e.path)]}}function ET(n,e){const t={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=jd(n,s);const i=(function(d){if(d.length!==0)return Wd(dt.create(d,"and"))})(e.filters);i&&(t.structuredQuery.where=i);const a=(function(d){if(d.length!==0)return d.map((f=>(function(T){return{field:lr(T.field),direction:vT(T.dir)}})(f)))})(e.orderBy);a&&(t.structuredQuery.orderBy=a);const l=pa(n,e.limit);return l!==null&&(t.structuredQuery.limit=l),e.startAt&&(t.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(e.startAt)),e.endAt&&(t.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(e.endAt)),{ft:t,parent:s}}function wT(n){let e=gT(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let s=null;if(r>0){se(r===1,65062);const f=t.from[0];f.allDescendants?s=f.collectionId:e=e.child(f.collectionId)}let i=[];t.where&&(i=(function(g){const T=Gd(g);return T instanceof dt&&wd(T)?T.getFilters():[T]})(t.where));let a=[];t.orderBy&&(a=(function(g){return g.map((T=>(function(P){return new Rs(ur(P.field),(function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(P.direction))})(T)))})(t.orderBy));let l=null;t.limit&&(l=(function(g){let T;return T=typeof g=="object"?g.value:g,io(T)?null:T})(t.limit));let u=null;t.startAt&&(u=(function(g){const T=!!g.before,S=g.values||[];return new Bi(S,T)})(t.startAt));let d=null;return t.endAt&&(d=(function(g){const T=!g.before,S=g.values||[];return new Bi(S,T)})(t.endAt)),$y(e,s,a,i,l,"F",u,d)}function IT(n,e){const t=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}})(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Gd(n){return n.unaryFilter!==void 0?(function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=ur(t.unaryFilter.field);return be.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=ur(t.unaryFilter.field);return be.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=ur(t.unaryFilter.field);return be.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=ur(t.unaryFilter.field);return be.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(t){return be.create(ur(t.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(t.fieldFilter.op),t.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(t){return dt.create(t.compositeFilter.filters.map((r=>Gd(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(t.compositeFilter.op))})(n):$(30097,{filter:n})}function vT(n){return uT[n]}function AT(n){return hT[n]}function bT(n){return dT[n]}function lr(n){return{fieldPath:n.canonicalString()}}function ur(n){return Ve.fromServerFormat(n.fieldPath)}function Wd(n){return n instanceof be?(function(t){if(t.op==="=="){if(eu(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NAN"}};if(Zl(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(eu(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NOT_NAN"}};if(Zl(t.value))return{unaryFilter:{field:lr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:lr(t.field),op:AT(t.op),value:t.value}}})(n):n instanceof dt?(function(t){const r=t.getFilters().map((s=>Wd(s)));return r.length===1?r[0]:{compositeFilter:{op:bT(t.op),filters:r}}})(n):$(54877,{filter:n})}function RT(n){const e=[];return n.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function Kd(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ln{constructor(e,t,r,s,i=q.min(),a=q.min(),l=Me.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=u}withSequenceNumber(e){return new ln(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ln(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class ST{constructor(e){this.yt=e}}function kT(n){const e=wT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?qi(e,e.limit,"L"):e}class CT{constructor(){this.Cn=new PT}addToCollectionParentIndex(e,t){return this.Cn.add(t),C.resolve()}getCollectionParents(e,t){return C.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return C.resolve()}deleteFieldIndex(e,t){return C.resolve()}deleteAllFieldIndexes(e){return C.resolve()}createTargetIndexes(e,t){return C.resolve()}getDocumentsMatchingTarget(e,t){return C.resolve(null)}getIndexType(e,t){return C.resolve(0)}getFieldIndexes(e,t){return C.resolve([])}getNextCollectionGroupToUpdate(e){return C.resolve(null)}getMinOffset(e,t){return C.resolve(gn.min())}getMinOffsetFromCollectionGroup(e,t){return C.resolve(gn.min())}updateCollectionGroup(e,t,r){return C.resolve()}updateIndexEntries(e,t){return C.resolve()}}class PT{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t]||new ke(ce.comparator),i=!s.has(r);return this.index[t]=s.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),s=this.index[t];return s&&s.has(r)}getEntries(e){return(this.index[e]||new ke(ce.comparator)).toArray()}}const pu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Qd=41943040;class Ke{static withCacheSize(e){return new Ke(e,Ke.DEFAULT_COLLECTION_PERCENTILE,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Ke.DEFAULT_COLLECTION_PERCENTILE=10,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ke.DEFAULT=new Ke(Qd,Ke.DEFAULT_COLLECTION_PERCENTILE,Ke.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ke.DISABLED=new Ke(-1,0,0);class Ir{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ir(0)}static cr(){return new Ir(-1)}}const gu="LruGarbageCollector",DT=1048576;function mu([n,e],[t,r]){const s=X(n,t);return s===0?X(e,r):s}class NT{constructor(e){this.Ir=e,this.buffer=new ke(mu),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();mu(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class xT{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){L(gu,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Pr(t)?L(gu,"Ignoring IndexedDB error during garbage collection: ",t):await Cr(t)}await this.Vr(3e5)}))}}class OT{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next((r=>Math.floor(t/100*r)))}nthSequenceNumber(e,t){if(t===0)return C.resolve(so.ce);const r=new NT(t);return this.mr.forEachTarget(e,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(e,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(L("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(pu)):this.getCacheSize(e).next((r=>r<this.params.cacheSizeCollectionThreshold?(L("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),pu):this.yr(e,t)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,s,i,a,l,u,d;const f=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((g=>(g>this.params.maximumSequenceNumbersToCollect?(L("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),s=this.params.maximumSequenceNumbersToCollect):s=g,a=Date.now(),this.nthSequenceNumber(e,s)))).next((g=>(r=g,l=Date.now(),this.removeTargets(e,r,t)))).next((g=>(i=g,u=Date.now(),this.removeOrphanedDocuments(e,r)))).next((g=>(d=Date.now(),ar()<=Y.DEBUG&&L("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${i} targets in `+(u-l)+`ms
	Removed ${g} documents in `+(d-u)+`ms
Total Duration: ${d-f}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:g}))))}}function VT(n,e){return new OT(n,e)}class LT{constructor(){this.changes=new Yn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,$e.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?C.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class MT{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class UT{constructor(e,t,r,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next((s=>(r=s,this.remoteDocumentCache.getEntry(e,t)))).next((s=>(r!==null&&ys(r.mutation,s,et.empty(),oe.now()),s)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.getLocalViewOfDocuments(e,r,J()).next((()=>r))))}getLocalViewOfDocuments(e,t,r=J()){const s=Bn();return this.populateOverlays(e,s,t).next((()=>this.computeViews(e,t,s,r).next((i=>{let a=ls();return i.forEach(((l,u)=>{a=a.insert(l,u.overlayedDocument)})),a}))))}getOverlayedDocuments(e,t){const r=Bn();return this.populateOverlays(e,r,t).next((()=>this.computeViews(e,t,r,J())))}populateOverlays(e,t,r){const s=[];return r.forEach((i=>{t.has(i)||s.push(i)})),this.documentOverlayCache.getOverlays(e,s).next((i=>{i.forEach(((a,l)=>{t.set(a,l)}))}))}computeViews(e,t,r,s){let i=Gt();const a=_s(),l=(function(){return _s()})();return t.forEach(((u,d)=>{const f=r.get(d.key);s.has(d.key)&&(f===void 0||f.mutation instanceof In)?i=i.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),ys(f.mutation,d,f.mutation.getFieldMask(),oe.now())):a.set(d.key,et.empty())})),this.recalculateAndSaveOverlays(e,i).next((u=>(u.forEach(((d,f)=>a.set(d,f))),t.forEach(((d,f)=>l.set(d,new MT(f,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(e,t){const r=_s();let s=new de(((a,l)=>a-l)),i=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((a=>{for(const l of a)l.keys().forEach((u=>{const d=t.get(u);if(d===null)return;let f=r.get(u)||et.empty();f=l.applyToLocalView(d,f),r.set(u,f);const g=(s.get(l.batchId)||J()).add(u);s=s.insert(l.batchId,g)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const u=l.getNext(),d=u.key,f=u.value,g=Pd();f.forEach((T=>{if(!i.has(T)){const S=Ld(t.get(T),r.get(T));S!==null&&g.set(T,S),i=i.add(T)}})),a.push(this.documentOverlayCache.saveOverlays(e,d,g))}return C.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((r=>this.recalculateAndSaveOverlays(e,r)))}getDocumentsMatchingQuery(e,t,r,s){return(function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):bd(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,s):this.getDocumentsMatchingCollectionQuery(e,t,r,s)}getNextDocuments(e,t,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,s).next((i=>{const a=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,s-i.size):C.resolve(Bn());let l=Is,u=i;return a.next((d=>C.forEach(d,((f,g)=>(l<g.largestBatchId&&(l=g.largestBatchId),i.get(f)?C.resolve():this.remoteDocumentCache.getEntry(e,f).next((T=>{u=u.insert(f,T)}))))).next((()=>this.populateOverlays(e,d,i))).next((()=>this.computeViews(e,u,d,J()))).next((f=>({batchId:l,changes:Cd(f)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next((r=>{let s=ls();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(e,t,r,s){const i=t.collectionGroup;let a=ls();return this.indexManager.getCollectionParents(e,i).next((l=>C.forEach(l,(u=>{const d=(function(g,T){return new Dr(T,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)})(t,u.child(i));return this.getDocumentsMatchingCollectionQuery(e,d,r,s).next((f=>{f.forEach(((g,T)=>{a=a.insert(g,T)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(e,t,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next((a=>(i=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,s)))).next((a=>{i.forEach(((u,d)=>{const f=d.getKey();a.get(f)===null&&(a=a.insert(f,$e.newInvalidDocument(f)))}));let l=ls();return a.forEach(((u,d)=>{const f=i.get(u);f!==void 0&&ys(f.mutation,d,et.empty(),oe.now()),co(t,d)&&(l=l.insert(u,d))})),l}))}}class FT{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return C.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,(function(s){return{id:s.id,version:s.version,createTime:vt(s.createTime)}})(t)),C.resolve()}getNamedQuery(e,t){return C.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,(function(s){return{name:s.name,query:kT(s.bundledQuery),readTime:vt(s.readTime)}})(t)),C.resolve()}}class $T{constructor(){this.overlays=new de(F.comparator),this.qr=new Map}getOverlay(e,t){return C.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Bn();return C.forEach(t,(s=>this.getOverlay(e,s).next((i=>{i!==null&&r.set(s,i)})))).next((()=>r))}saveOverlays(e,t,r){return r.forEach(((s,i)=>{this.St(e,t,i)})),C.resolve()}removeOverlaysForBatchId(e,t,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((i=>this.overlays=this.overlays.remove(i))),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(e,t,r){const s=Bn(),i=t.length+1,a=new F(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const u=l.getNext().value,d=u.getKey();if(!t.isPrefixOf(d.path))break;d.path.length===i&&u.largestBatchId>r&&s.set(u.getKey(),u)}return C.resolve(s)}getOverlaysForCollectionGroup(e,t,r,s){let i=new de(((d,f)=>d-f));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===t&&d.largestBatchId>r){let f=i.get(d.largestBatchId);f===null&&(f=Bn(),i=i.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}const l=Bn(),u=i.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach(((d,f)=>l.set(d,f))),!(l.size()>=s)););return C.resolve(l)}St(e,t,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new sT(t,r));let i=this.qr.get(t);i===void 0&&(i=J(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class BT{constructor(){this.sessionToken=Me.EMPTY_BYTE_STRING}getSessionToken(e){return C.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,C.resolve()}}class nc{constructor(){this.Qr=new ke(De.$r),this.Ur=new ke(De.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new De(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach((r=>this.addReference(r,t)))}removeReference(e,t){this.Gr(new De(e,t))}zr(e,t){e.forEach((r=>this.removeReference(r,t)))}jr(e){const t=new F(new ce([])),r=new De(t,e),s=new De(t,e+1),i=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),i.push(a.key)})),i}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new F(new ce([])),r=new De(t,e),s=new De(t,e+1);let i=J();return this.Ur.forEachInRange([r,s],(a=>{i=i.add(a.key)})),i}containsKey(e){const t=new De(e,0),r=this.Qr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class De{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return F.comparator(e.key,t.key)||X(e.Yr,t.Yr)}static Kr(e,t){return X(e.Yr,t.Yr)||F.comparator(e.key,t.key)}}class qT{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new ke(De.$r)}checkEmpty(e){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new rT(i,t,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new De(l.key,i)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return C.resolve(a)}lookupMutationBatch(e,t){return C.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,s=this.ei(r),i=s<0?0:s;return C.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Ga:this.tr-1)}getAllMutationBatches(e){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new De(t,0),s=new De(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);i.push(l)})),C.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ke(X);return t.forEach((s=>{const i=new De(s,0),a=new De(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,a],(l=>{r=r.add(l.Yr)}))})),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,s=r.length+1;let i=r;F.isDocumentKey(i)||(i=i.child(""));const a=new De(new F(i),0);let l=new ke(X);return this.Zr.forEachWhile((u=>{const d=u.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(u.Yr)),!0)}),a),C.resolve(this.ti(l))}ti(e){const t=[];return e.forEach((r=>{const s=this.Xr(r);s!==null&&t.push(s)})),t}removeMutationBatch(e,t){se(this.ni(t.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(t.mutations,(s=>{const i=new De(s.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)})).next((()=>{this.Zr=r}))}ir(e){}containsKey(e,t){const r=new De(t,0),s=this.Zr.firstAfterOrEqual(r);return C.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,C.resolve()}ni(e,t){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class zT{constructor(e){this.ri=e,this.docs=(function(){return new de(F.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,s=this.docs.get(r),i=s?s.size:0,a=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return C.resolve(r?r.document.mutableCopy():$e.newInvalidDocument(t))}getEntries(e,t){let r=Gt();return t.forEach((s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():$e.newInvalidDocument(s))})),C.resolve(r)}getDocumentsMatchingQuery(e,t,r,s){let i=Gt();const a=t.path,l=new F(a.child("__id-9223372036854775808__")),u=this.docs.getIteratorFrom(l);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||yy(_y(f),r)<=0||(s.has(f.key)||co(t,f))&&(i=i.insert(f.key,f.mutableCopy()))}return C.resolve(i)}getAllFromCollectionGroup(e,t,r,s){$(9500)}ii(e,t){return C.forEach(this.docs,(r=>t(r)))}newChangeBuffer(e){return new jT(this)}getSize(e){return C.resolve(this.size)}}class jT extends LT{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?t.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)})),C.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class HT{constructor(e){this.persistence=e,this.si=new Yn((t=>Qa(t)),Ya),this.lastRemoteSnapshotVersion=q.min(),this.highestTargetId=0,this.oi=0,this._i=new nc,this.targetCount=0,this.ai=Ir.ur()}forEachTarget(e,t){return this.si.forEach(((r,s)=>t(s))),C.resolve()}getLastRemoteSnapshotVersion(e){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return C.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),C.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Ir(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,C.resolve()}updateTargetData(e,t){return this.Pr(t),C.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,C.resolve()}removeTargets(e,t,r){let s=0;const i=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.si.delete(a),i.push(this.removeMatchingKeysForTargetId(e,l.targetId)),s++)})),C.waitFor(i).next((()=>s))}getTargetCount(e){return C.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return C.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),C.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const s=this.persistence.referenceDelegate,i=[];return s&&t.forEach((a=>{i.push(s.markPotentiallyOrphaned(e,a))})),C.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),C.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return C.resolve(r)}containsKey(e,t){return C.resolve(this._i.containsKey(t))}}class Yd{constructor(e,t){this.ui={},this.overlays={},this.ci=new so(0),this.li=!1,this.li=!0,this.hi=new BT,this.referenceDelegate=e(this),this.Pi=new HT(this),this.indexManager=new CT,this.remoteDocumentCache=(function(s){return new zT(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new ST(t),this.Ii=new FT(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new $T,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new qT(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){L("MemoryPersistence","Starting transaction:",e);const s=new GT(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((i=>this.referenceDelegate.di(s).next((()=>i)))).toPromise().then((i=>(s.raiseOnCommittedEvent(),i)))}Ai(e,t){return C.or(Object.values(this.ui).map((r=>()=>r.containsKey(e,t))))}}class GT extends Ey{constructor(e){super(),this.currentSequenceNumber=e}}class rc{constructor(e){this.persistence=e,this.Ri=new nc,this.Vi=null}static mi(e){return new rc(e)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),C.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),C.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((s=>{s.forEach((i=>this.fi.add(i.toString())))})).next((()=>r.removeTargetData(e,t)))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,(r=>{const s=F.fromPath(r);return this.gi(e,s).next((i=>{i||t.removeEntry(s,q.min())}))})).next((()=>(this.Vi=null,t.apply(e))))}updateLimboDocument(e,t){return this.gi(e,t).next((r=>{r?this.fi.delete(t.toString()):this.fi.add(t.toString())}))}Ti(e){return 0}gi(e,t){return C.or([()=>C.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class Gi{constructor(e,t){this.persistence=e,this.pi=new Yn((r=>vy(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=VT(this,t)}static mi(e,t){return new Gi(e,t)}Ei(){}di(e){return C.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((r=>t.next((s=>r+s))))}wr(e){let t=0;return this.pr(e,(r=>{t++})).next((()=>t))}pr(e,t){return C.forEach(this.pi,((r,s)=>this.br(e,r,s).next((i=>i?C.resolve():t(s)))))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,(a=>this.br(e,a,t).next((l=>{l||(r++,i.removeEntry(a,q.min()))})))).next((()=>i.apply(e))).next((()=>r))}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),C.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),C.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Ai(e.data.value)),t}br(e,t,r){return C.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const s=this.pi.get(t);return C.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class sc{constructor(e,t,r,s){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=s}static As(e,t){let r=J(),s=J();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new sc(e,t.fromCache,r,s)}}class WT{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class KT{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Mp()?8:wy(Be())>0?6:4})()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,s){const i={result:null};return this.ys(e,t).next((a=>{i.result=a})).next((()=>{if(!i.result)return this.ws(e,t,s,r).next((a=>{i.result=a}))})).next((()=>{if(i.result)return;const a=new WT;return this.Ss(e,t,a).next((l=>{if(i.result=l,this.Vs)return this.bs(e,t,a,l.size)}))})).next((()=>i.result))}bs(e,t,r,s){return r.documentReadCount<this.fs?(ar()<=Y.DEBUG&&L("QueryEngine","SDK will not create cache indexes for query:",cr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(ar()<=Y.DEBUG&&L("QueryEngine","Query:",cr(t),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(ar()<=Y.DEBUG&&L("QueryEngine","The SDK decides to create cache indexes for query:",cr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,wt(t))):C.resolve())}ys(e,t){if(su(t))return C.resolve(null);let r=wt(t);return this.indexManager.getIndexType(e,r).next((s=>s===0?null:(t.limit!==null&&s===1&&(t=qi(t,null,"F"),r=wt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next((i=>{const a=J(...i);return this.ps.getDocuments(e,a).next((l=>this.indexManager.getMinOffset(e,r).next((u=>{const d=this.Ds(t,l);return this.Cs(t,d,a,u.readTime)?this.ys(e,qi(t,null,"F")):this.vs(e,d,t,u)}))))})))))}ws(e,t,r,s){return su(t)||s.isEqual(q.min())?C.resolve(null):this.ps.getDocuments(e,r).next((i=>{const a=this.Ds(t,i);return this.Cs(t,a,r,s)?C.resolve(null):(ar()<=Y.DEBUG&&L("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),cr(t)),this.vs(e,a,t,my(s,Is)).next((l=>l)))}))}Ds(e,t){let r=new ke(Sd(e));return t.forEach(((s,i)=>{co(e,i)&&(r=r.add(i))})),r}Cs(e,t,r,s){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const i=e.limitType==="F"?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,t,r){return ar()<=Y.DEBUG&&L("QueryEngine","Using full collection scan to execute query:",cr(t)),this.ps.getDocumentsMatchingQuery(e,t,gn.min(),r)}vs(e,t,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next((i=>(t.forEach((a=>{i=i.insert(a.key,a)})),i)))}}const ic="LocalStore",QT=3e8;class YT{constructor(e,t,r,s){this.persistence=e,this.Fs=t,this.serializer=s,this.Ms=new de(X),this.xs=new Yn((i=>Qa(i)),Ya),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new UT(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Ms)))}}function XT(n,e,t,r){return new YT(n,e,t,r)}async function Xd(n,e){const t=z(n);return await t.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return t.mutationQueue.getAllMutationBatches(r).next((i=>(s=i,t.Bs(e),t.mutationQueue.getAllMutationBatches(r)))).next((i=>{const a=[],l=[];let u=J();for(const d of s){a.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}for(const d of i){l.push(d.batchId);for(const f of d.mutations)u=u.add(f.key)}return t.localDocuments.getDocuments(r,u).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function JT(n,e){const t=z(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=e.batch.keys(),i=t.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,u,d,f){const g=d.batch,T=g.keys();let S=C.resolve();return T.forEach((P=>{S=S.next((()=>f.getEntry(u,P))).next((V=>{const x=d.docVersions.get(P);se(x!==null,48541),V.version.compareTo(x)<0&&(g.applyToRemoteDocument(V,d),V.isValidDocument()&&(V.setReadTime(d.commitVersion),f.addEntry(V)))}))})),S.next((()=>l.mutationQueue.removeMutationBatch(u,g)))})(t,r,e,i).next((()=>i.apply(r))).next((()=>t.mutationQueue.performConsistencyCheck(r))).next((()=>t.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId))).next((()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let u=J();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(u=u.add(l.batch.mutations[d].key));return u})(e)))).next((()=>t.localDocuments.getDocuments(r,s)))}))}function Jd(n){const e=z(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Pi.getLastRemoteSnapshotVersion(t)))}function ZT(n,e){const t=z(n),r=e.snapshotVersion;let s=t.Ms;return t.persistence.runTransaction("Apply remote event","readwrite-primary",(i=>{const a=t.Ns.newChangeBuffer({trackRemovals:!0});s=t.Ms;const l=[];e.targetChanges.forEach(((f,g)=>{const T=s.get(g);if(!T)return;l.push(t.Pi.removeMatchingKeys(i,f.removedDocuments,g).next((()=>t.Pi.addMatchingKeys(i,f.addedDocuments,g))));let S=T.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(g)!==null?S=S.withResumeToken(Me.EMPTY_BYTE_STRING,q.min()).withLastLimboFreeSnapshotVersion(q.min()):f.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(f.resumeToken,r)),s=s.insert(g,S),(function(V,x,j){return V.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-V.snapshotVersion.toMicroseconds()>=QT?!0:j.addedDocuments.size+j.modifiedDocuments.size+j.removedDocuments.size>0})(T,S,f)&&l.push(t.Pi.updateTargetData(i,S))}));let u=Gt(),d=J();if(e.documentUpdates.forEach((f=>{e.resolvedLimboDocuments.has(f)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(i,f))})),l.push(eE(i,a,e.documentUpdates).next((f=>{u=f.ks,d=f.qs}))),!r.isEqual(q.min())){const f=t.Pi.getLastRemoteSnapshotVersion(i).next((g=>t.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r)));l.push(f)}return C.waitFor(l).next((()=>a.apply(i))).next((()=>t.localDocuments.getLocalViewOfDocuments(i,u,d))).next((()=>u))})).then((i=>(t.Ms=s,i)))}function eE(n,e,t){let r=J(),s=J();return t.forEach((i=>r=r.add(i))),e.getEntries(n,r).next((i=>{let a=Gt();return t.forEach(((l,u)=>{const d=i.get(l);u.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),u.isNoDocument()&&u.version.isEqual(q.min())?(e.removeEntry(l,u.readTime),a=a.insert(l,u)):!d.isValidDocument()||u.version.compareTo(d.version)>0||u.version.compareTo(d.version)===0&&d.hasPendingWrites?(e.addEntry(u),a=a.insert(l,u)):L(ic,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",u.version)})),{ks:a,qs:s}}))}function tE(n,e){const t=z(n);return t.persistence.runTransaction("Get next mutation batch","readonly",(r=>(e===void 0&&(e=Ga),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e))))}function nE(n,e){const t=z(n);return t.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return t.Pi.getTargetData(r,e).next((i=>i?(s=i,C.resolve(s)):t.Pi.allocateTargetId(r).next((a=>(s=new ln(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=t.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.Ms=t.Ms.insert(r.targetId,r),t.xs.set(e,r.targetId)),r}))}async function ya(n,e,t){const r=z(n),s=r.Ms.get(e),i=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",i,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!Pr(a))throw a;L(ic,`Failed to update sequence numbers for target ${e}: ${a}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function _u(n,e,t){const r=z(n);let s=q.min(),i=J();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(u,d,f){const g=z(u),T=g.xs.get(f);return T!==void 0?C.resolve(g.Ms.get(T)):g.Pi.getTargetData(d,f)})(r,a,wt(e)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((u=>{i=u}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,e,t?s:q.min(),t?i:J()))).next((l=>(rE(r,qy(e),l),{documents:l,Qs:i})))))}function rE(n,e,t){let r=n.Os.get(e)||q.min();t.forEach(((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)})),n.Os.set(e,r)}class yu{constructor(){this.activeTargetIds=Ky()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sE{constructor(){this.Mo=new yu,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new yu,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class iE{Oo(e){}shutdown(){}}const Tu="ConnectivityMonitor";class Eu{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){L(Tu,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){L(Tu,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let gi=null;function Ta(){return gi===null?gi=(function(){return 268435456+Math.round(2147483648*Math.random())})():gi++,"0x"+gi.toString(16)}const jo="RestConnection",oE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class aE{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Fi?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,t,r,s,i){const a=Ta(),l=this.zo(e,t.toUriEncodedString());L(jo,`Sending RPC '${e}' ${a}:`,l,r);const u={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(u,s,i);const{host:d}=new URL(l),f=br(d);return this.Jo(e,l,u,r,f).then((g=>(L(jo,`Received RPC '${e}' ${a}: `,g),g)),(g=>{throw yr(jo,`RPC '${e}' ${a} failed with error: `,g,"url: ",l,"request:",r),g}))}Ho(e,t,r,s,i,a){return this.Go(e,t,r,s,i)}jo(e,t,r){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+kr})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((s,i)=>e[i]=s)),r&&r.headers.forEach(((s,i)=>e[i]=s))}zo(e,t){const r=oE[e];return`${this.Uo}/v1/${t}:${r}`}terminate(){}}class cE{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Ue="WebChannelConnection";class lE extends aE{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,s,i){const a=Ta();return new Promise(((l,u)=>{const d=new ed;d.setWithCredentials(!0),d.listenOnce(td.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case vi.NO_ERROR:const g=d.getResponseJson();L(Ue,`XHR for RPC '${e}' ${a} received:`,JSON.stringify(g)),l(g);break;case vi.TIMEOUT:L(Ue,`RPC '${e}' ${a} timed out`),u(new O(k.DEADLINE_EXCEEDED,"Request time out"));break;case vi.HTTP_ERROR:const T=d.getStatus();if(L(Ue,`RPC '${e}' ${a} failed with status:`,T,"response text:",d.getResponseText()),T>0){let S=d.getResponseJson();Array.isArray(S)&&(S=S[0]);const P=S?.error;if(P&&P.status&&P.message){const V=(function(j){const G=j.toLowerCase().replace(/_/g,"-");return Object.values(k).indexOf(G)>=0?G:k.UNKNOWN})(P.status);u(new O(V,P.message))}else u(new O(k.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new O(k.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:e,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{L(Ue,`RPC '${e}' ${a} completed.`)}}));const f=JSON.stringify(s);L(Ue,`RPC '${e}' ${a} sending request:`,s),d.send(t,"POST",f,r,15)}))}T_(e,t,r){const s=Ta(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=sd(),l=rd(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(u.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(u.useFetchStreams=!0),this.jo(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;const f=i.join("");L(Ue,`Creating RPC '${e}' stream ${s}: ${f}`,u);const g=a.createWebChannel(f,u);this.I_(g);let T=!1,S=!1;const P=new cE({Yo:x=>{S?L(Ue,`Not sending because RPC '${e}' stream ${s} is closed:`,x):(T||(L(Ue,`Opening RPC '${e}' stream ${s} transport.`),g.open(),T=!0),L(Ue,`RPC '${e}' stream ${s} sending:`,x),g.send(x))},Zo:()=>g.close()}),V=(x,j,G)=>{x.listen(j,(W=>{try{G(W)}catch(ee){setTimeout((()=>{throw ee}),0)}}))};return V(g,cs.EventType.OPEN,(()=>{S||(L(Ue,`RPC '${e}' stream ${s} transport opened.`),P.o_())})),V(g,cs.EventType.CLOSE,(()=>{S||(S=!0,L(Ue,`RPC '${e}' stream ${s} transport closed`),P.a_(),this.E_(g))})),V(g,cs.EventType.ERROR,(x=>{S||(S=!0,yr(Ue,`RPC '${e}' stream ${s} transport errored. Name:`,x.name,"Message:",x.message),P.a_(new O(k.UNAVAILABLE,"The operation could not be completed")))})),V(g,cs.EventType.MESSAGE,(x=>{if(!S){const j=x.data[0];se(!!j,16349);const G=j,W=G?.error||G[0]?.error;if(W){L(Ue,`RPC '${e}' stream ${s} received error:`,W);const ee=W.status;let he=(function(m){const y=Ae[m];if(y!==void 0)return Fd(y)})(ee),ie=W.message;he===void 0&&(he=k.INTERNAL,ie="Unknown error status: "+ee+" with message "+W.message),S=!0,P.a_(new O(he,ie)),g.close()}else L(Ue,`RPC '${e}' stream ${s} received:`,j),P.u_(j)}})),V(l,nd.STAT_EVENT,(x=>{x.stat===aa.PROXY?L(Ue,`RPC '${e}' stream ${s} detected buffering proxy`):x.stat===aa.NOPROXY&&L(Ue,`RPC '${e}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{P.__()}),0),P}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((t=>t===e))}}function Ho(){return typeof document<"u"?document:null}function fo(n){return new fT(n,!0)}class Zd{constructor(e,t,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,t-r);s>0&&L("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const wu="PersistentStream";class ef{constructor(e,t,r,s,i,a,l,u){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=u,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Zd(e,t)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():t&&t.code===k.RESOURCE_EXHAUSTED?(jt(t.toString()),jt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===k.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===t&&this.G_(r,s)}),(r=>{e((()=>{const s=new O(k.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return L(wu,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget((()=>this.D_===e?t():(L(wu,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class uE extends ef{constructor(e,t,r,s,i,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=mT(this.serializer,e),r=(function(i){if(!("targetChange"in i))return q.min();const a=i.targetChange;return a.targetIds&&a.targetIds.length?q.min():a.readTime?vt(a.readTime):q.min()})(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=_a(this.serializer),t.addTarget=(function(i,a){let l;const u=a.target;if(l=da(u)?{documents:TT(i,u)}:{query:ET(i,u).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=qd(i,a.resumeToken);const d=pa(i,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(q.min())>0){l.readTime=Hi(i,a.snapshotVersion.toTimestamp());const d=pa(i,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,e);const r=IT(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=_a(this.serializer),t.removeTarget=e,this.q_(t)}}class hE extends ef{constructor(e,t,r,s,i,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,s,a),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return se(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,se(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){se(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=yT(e.writeResults,e.commitTime),r=vt(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=_a(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map((r=>_T(this.serializer,r)))};this.q_(t)}}class dE{}class fE extends dE{constructor(e,t,r,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new O(k.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,a])=>this.connection.Go(e,ga(t,r),s,i,a))).catch((i=>{throw i.name==="FirebaseError"?(i.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new O(k.UNKNOWN,i.toString())}))}Ho(e,t,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(e,ga(t,r),s,a,l,i))).catch((a=>{throw a.name==="FirebaseError"?(a.code===k.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(k.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class pE{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(jt(t),this.aa=!1):L("OnlineStateTracker",t)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Kn="RemoteStore";class gE{constructor(e,t,r,s,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{Xn(this)&&(L(Kn,"Restarting streams for network reachability change."),await(async function(u){const d=z(u);d.Ea.add(4),await Us(d),d.Ra.set("Unknown"),d.Ea.delete(4),await po(d)})(this))}))})),this.Ra=new pE(r,s)}}async function po(n){if(Xn(n))for(const e of n.da)await e(!0)}async function Us(n){for(const e of n.da)await e(!1)}function tf(n,e){const t=z(n);t.Ia.has(e.targetId)||(t.Ia.set(e.targetId,e),lc(t)?cc(t):Nr(t).O_()&&ac(t,e))}function oc(n,e){const t=z(n),r=Nr(t);t.Ia.delete(e),r.O_()&&nf(t,e),t.Ia.size===0&&(r.O_()?r.L_():Xn(t)&&t.Ra.set("Unknown"))}function ac(n,e){if(n.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(q.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Nr(n).Y_(e)}function nf(n,e){n.Va.Ue(e),Nr(n).Z_(e)}function cc(n){n.Va=new lT({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),At:e=>n.Ia.get(e)||null,ht:()=>n.datastore.serializer.databaseId}),Nr(n).start(),n.Ra.ua()}function lc(n){return Xn(n)&&!Nr(n).x_()&&n.Ia.size>0}function Xn(n){return z(n).Ea.size===0}function rf(n){n.Va=void 0}async function mE(n){n.Ra.set("Online")}async function _E(n){n.Ia.forEach(((e,t)=>{ac(n,e)}))}async function yE(n,e){rf(n),lc(n)?(n.Ra.ha(e),cc(n)):n.Ra.set("Unknown")}async function TE(n,e,t){if(n.Ra.set("Online"),e instanceof Bd&&e.state===2&&e.cause)try{await(async function(s,i){const a=i.cause;for(const l of i.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,e)}catch(r){L(Kn,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Wi(n,r)}else if(e instanceof Si?n.Va.Ze(e):e instanceof $d?n.Va.st(e):n.Va.tt(e),!t.isEqual(q.min()))try{const r=await Jd(n.localStore);t.compareTo(r)>=0&&await(function(i,a){const l=i.Va.Tt(a);return l.targetChanges.forEach(((u,d)=>{if(u.resumeToken.approximateByteSize()>0){const f=i.Ia.get(d);f&&i.Ia.set(d,f.withResumeToken(u.resumeToken,a))}})),l.targetMismatches.forEach(((u,d)=>{const f=i.Ia.get(u);if(!f)return;i.Ia.set(u,f.withResumeToken(Me.EMPTY_BYTE_STRING,f.snapshotVersion)),nf(i,u);const g=new ln(f.target,u,d,f.sequenceNumber);ac(i,g)})),i.remoteSyncer.applyRemoteEvent(l)})(n,t)}catch(r){L(Kn,"Failed to raise snapshot:",r),await Wi(n,r)}}async function Wi(n,e,t){if(!Pr(e))throw e;n.Ea.add(1),await Us(n),n.Ra.set("Offline"),t||(t=()=>Jd(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{L(Kn,"Retrying IndexedDB access"),await t(),n.Ea.delete(1),await po(n)}))}function sf(n,e){return e().catch((t=>Wi(n,t,e)))}async function go(n){const e=z(n),t=Tn(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ga;for(;EE(e);)try{const s=await tE(e.localStore,r);if(s===null){e.Ta.length===0&&t.L_();break}r=s.batchId,wE(e,s)}catch(s){await Wi(e,s)}of(e)&&af(e)}function EE(n){return Xn(n)&&n.Ta.length<10}function wE(n,e){n.Ta.push(e);const t=Tn(n);t.O_()&&t.X_&&t.ea(e.mutations)}function of(n){return Xn(n)&&!Tn(n).x_()&&n.Ta.length>0}function af(n){Tn(n).start()}async function IE(n){Tn(n).ra()}async function vE(n){const e=Tn(n);for(const t of n.Ta)e.ea(t.mutations)}async function AE(n,e,t){const r=n.Ta.shift(),s=Za.from(r,e,t);await sf(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await go(n)}async function bE(n,e){e&&Tn(n).X_&&await(async function(r,s){if((function(a){return oT(a)&&a!==k.ABORTED})(s.code)){const i=r.Ta.shift();Tn(r).B_(),await sf(r,(()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s))),await go(r)}})(n,e),of(n)&&af(n)}async function Iu(n,e){const t=z(n);t.asyncQueue.verifyOperationInProgress(),L(Kn,"RemoteStore received new credentials");const r=Xn(t);t.Ea.add(3),await Us(t),r&&t.Ra.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.Ea.delete(3),await po(t)}async function RE(n,e){const t=z(n);e?(t.Ea.delete(2),await po(t)):e||(t.Ea.add(2),await Us(t),t.Ra.set("Unknown"))}function Nr(n){return n.ma||(n.ma=(function(t,r,s){const i=z(t);return i.sa(),new uE(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:mE.bind(null,n),t_:_E.bind(null,n),r_:yE.bind(null,n),H_:TE.bind(null,n)}),n.da.push((async e=>{e?(n.ma.B_(),lc(n)?cc(n):n.Ra.set("Unknown")):(await n.ma.stop(),rf(n))}))),n.ma}function Tn(n){return n.fa||(n.fa=(function(t,r,s){const i=z(t);return i.sa(),new hE(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:IE.bind(null,n),r_:bE.bind(null,n),ta:vE.bind(null,n),na:AE.bind(null,n)}),n.da.push((async e=>{e?(n.fa.B_(),await go(n)):(await n.fa.stop(),n.Ta.length>0&&(L(Kn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class uc{constructor(e,t,r,s,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Bt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,s,i){const a=Date.now()+r,l=new uc(e,t,a,s,i);return l.start(r),l}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(k.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hc(n,e){if(jt("AsyncQueue",`${e}: ${n}`),Pr(n))return new O(k.UNAVAILABLE,`${e}: ${n}`);throw n}class pr{static emptySet(e){return new pr(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||F.comparator(t.key,r.key):(t,r)=>F.comparator(t.key,r.key),this.keyedMap=ls(),this.sortedSet=new de(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,r)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof pr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new pr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class vu{constructor(){this.ga=new de(F.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(t,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(t):e.type===1&&r.type===2?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):$(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal(((t,r)=>{e.push(r)})),e}}class vr{constructor(e,t,r,s,i,a,l,u,d){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=u,this.hasCachedResults=d}static fromInitialDocuments(e,t,r,s,i){const a=[];return t.forEach((l=>{a.push({type:0,doc:l})})),new vr(e,t,pr.emptySet(t),a,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ao(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==r[s].type||!t[s].doc.isEqual(r[s].doc))return!1;return!0}}class SE{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class kE{constructor(){this.queries=Au(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(t,r){const s=z(t),i=s.queries;s.queries=Au(),i.forEach(((a,l)=>{for(const u of l.Sa)u.onError(r)}))})(this,new O(k.ABORTED,"Firestore shutting down"))}}function Au(){return new Yn((n=>Rd(n)),ao)}async function cf(n,e){const t=z(n);let r=3;const s=e.query;let i=t.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new SE,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await t.onListen(s,!0);break;case 1:i.wa=await t.onListen(s,!1);break;case 2:await t.onFirstRemoteStoreListen(s)}}catch(a){const l=hc(a,`Initialization of query '${cr(e.query)}' failed`);return void e.onError(l)}t.queries.set(s,i),i.Sa.push(e),e.va(t.onlineState),i.wa&&e.Fa(i.wa)&&dc(t)}async function lf(n,e){const t=z(n),r=e.query;let s=3;const i=t.queries.get(r);if(i){const a=i.Sa.indexOf(e);a>=0&&(i.Sa.splice(a,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function CE(n,e){const t=z(n);let r=!1;for(const s of e){const i=s.query,a=t.queries.get(i);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&dc(t)}function PE(n,e,t){const r=z(n),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(t);r.queries.delete(e)}function dc(n){n.Ca.forEach((e=>{e.next()}))}var Ea,bu;(bu=Ea||(Ea={})).Ma="default",bu.Cache="cache";class uf{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new vr(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache||!this.Da())return!0;const r=t!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ka(e){e=vr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Ea.Cache}}class hf{constructor(e){this.key=e}}class df{constructor(e){this.key=e}}class DE{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=J(),this.mutatedKeys=J(),this.eu=Sd(e),this.tu=new pr(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new vu,s=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,a=s,l=!1;const u=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal(((f,g)=>{const T=s.get(f),S=co(this.query,g)?g:null,P=!!T&&this.mutatedKeys.has(T.key),V=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let x=!1;T&&S?T.data.isEqual(S.data)?P!==V&&(r.track({type:3,doc:S}),x=!0):this.su(T,S)||(r.track({type:2,doc:S}),x=!0,(u&&this.eu(S,u)>0||d&&this.eu(S,d)<0)&&(l=!0)):!T&&S?(r.track({type:0,doc:S}),x=!0):T&&!S&&(r.track({type:1,doc:T}),x=!0,(u||d)&&(l=!0)),x&&(S?(a=a.add(S),i=V?i.add(f):i.delete(f)):(a=a.delete(f),i=i.delete(f)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),i=i.delete(f.key),r.track({type:1,doc:f})}return{tu:a,iu:r,Cs:l,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const a=e.iu.ya();a.sort(((f,g)=>(function(S,P){const V=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:x})}};return V(S)-V(P)})(f.type,g.type)||this.eu(f.doc,g.doc))),this.ou(r),s=s??!1;const l=t&&!s?this._u():[],u=this.Xa.size===0&&this.current&&!s?1:0,d=u!==this.Za;return this.Za=u,a.length!==0||d?{snapshot:new vr(this.query,e.tu,i,a,e.mutatedKeys,u===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new vu,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((t=>this.Ya=this.Ya.add(t))),e.modifiedDocuments.forEach((t=>{})),e.removedDocuments.forEach((t=>this.Ya=this.Ya.delete(t))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=J(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const t=[];return e.forEach((r=>{this.Xa.has(r)||t.push(new df(r))})),this.Xa.forEach((r=>{e.has(r)||t.push(new hf(r))})),t}cu(e){this.Ya=e.Qs,this.Xa=J();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return vr.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const fc="SyncEngine";class NE{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class xE{constructor(e){this.key=e,this.hu=!1}}class OE{constructor(e,t,r,s,i,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Yn((l=>Rd(l)),ao),this.Iu=new Map,this.Eu=new Set,this.du=new de(F.comparator),this.Au=new Map,this.Ru=new nc,this.Vu={},this.mu=new Map,this.fu=Ir.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function VE(n,e,t=!0){const r=yf(n);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await ff(r,e,t,!0),s}async function LE(n,e){const t=yf(n);await ff(t,e,!0,!1)}async function ff(n,e,t,r){const s=await nE(n.localStore,wt(e)),i=s.targetId,a=n.sharedClientState.addLocalQueryTarget(i,t);let l;return r&&(l=await ME(n,e,i,a==="current",s.resumeToken)),n.isPrimaryClient&&t&&tf(n.remoteStore,s),l}async function ME(n,e,t,r,s){n.pu=(g,T,S)=>(async function(V,x,j,G){let W=x.view.ru(j);W.Cs&&(W=await _u(V.localStore,x.query,!1).then((({documents:I})=>x.view.ru(I,W))));const ee=G&&G.targetChanges.get(x.targetId),he=G&&G.targetMismatches.get(x.targetId)!=null,ie=x.view.applyChanges(W,V.isPrimaryClient,ee,he);return Su(V,x.targetId,ie.au),ie.snapshot})(n,g,T,S);const i=await _u(n.localStore,e,!0),a=new DE(e,i.Qs),l=a.ru(i.documents),u=Ms.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,u);Su(n,t,d.au);const f=new NE(e,t,a);return n.Tu.set(e,f),n.Iu.has(t)?n.Iu.get(t).push(e):n.Iu.set(t,[e]),d.snapshot}async function UE(n,e,t){const r=z(n),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter((a=>!ao(a,e)))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ya(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),t&&oc(r.remoteStore,s.targetId),wa(r,s.targetId)})).catch(Cr)):(wa(r,s.targetId),await ya(r.localStore,s.targetId,!0))}async function FE(n,e){const t=z(n),r=t.Tu.get(e),s=t.Iu.get(r.targetId);t.isPrimaryClient&&s.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),oc(t.remoteStore,r.targetId))}async function $E(n,e,t){const r=WE(n);try{const s=await(function(a,l){const u=z(a),d=oe.now(),f=l.reduce(((S,P)=>S.add(P.key)),J());let g,T;return u.persistence.runTransaction("Locally write mutations","readwrite",(S=>{let P=Gt(),V=J();return u.Ns.getEntries(S,f).next((x=>{P=x,P.forEach(((j,G)=>{G.isValidDocument()||(V=V.add(j))}))})).next((()=>u.localDocuments.getOverlayedDocuments(S,P))).next((x=>{g=x;const j=[];for(const G of l){const W=tT(G,g.get(G.key).overlayedDocument);W!=null&&j.push(new In(G.key,W,yd(W.value.mapValue),It.exists(!0)))}return u.mutationQueue.addMutationBatch(S,d,j,l)})).next((x=>{T=x;const j=x.applyToLocalDocumentSet(g,V);return u.documentOverlayCache.saveOverlays(S,x.batchId,j)}))})).then((()=>({batchId:T.batchId,changes:Cd(g)})))})(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,u){let d=a.Vu[a.currentUser.toKey()];d||(d=new de(X)),d=d.insert(l,u),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,t),await Fs(r,s.changes),await go(r.remoteStore)}catch(s){const i=hc(s,"Failed to persist write");t.reject(i)}}async function pf(n,e){const t=z(n);try{const r=await ZT(t.localStore,e);e.targetChanges.forEach(((s,i)=>{const a=t.Au.get(i);a&&(se(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?se(a.hu,14607):s.removedDocuments.size>0&&(se(a.hu,42227),a.hu=!1))})),await Fs(t,r,e)}catch(r){await Cr(r)}}function Ru(n,e,t){const r=z(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const s=[];r.Tu.forEach(((i,a)=>{const l=a.view.va(e);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const u=z(a);u.onlineState=l;let d=!1;u.queries.forEach(((f,g)=>{for(const T of g.Sa)T.va(l)&&(d=!0)})),d&&dc(u)})(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function BE(n,e,t){const r=z(n);r.sharedClientState.updateQueryState(e,"rejected",t);const s=r.Au.get(e),i=s&&s.key;if(i){let a=new de(F.comparator);a=a.insert(i,$e.newNoDocument(i,q.min()));const l=J().add(i),u=new ho(q.min(),new Map,new de(X),a,l);await pf(r,u),r.du=r.du.remove(i),r.Au.delete(e),pc(r)}else await ya(r.localStore,e,!1).then((()=>wa(r,e,t))).catch(Cr)}async function qE(n,e){const t=z(n),r=e.batch.batchId;try{const s=await JT(t.localStore,e);mf(t,r,null),gf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Fs(t,s)}catch(s){await Cr(s)}}async function zE(n,e,t){const r=z(n);try{const s=await(function(a,l){const u=z(a);return u.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let f;return u.mutationQueue.lookupMutationBatch(d,l).next((g=>(se(g!==null,37113),f=g.keys(),u.mutationQueue.removeMutationBatch(d,g)))).next((()=>u.mutationQueue.performConsistencyCheck(d))).next((()=>u.documentOverlayCache.removeOverlaysForBatchId(d,f,l))).next((()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f))).next((()=>u.localDocuments.getDocuments(d,f)))}))})(r.localStore,e);mf(r,e,t),gf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Fs(r,s)}catch(s){await Cr(s)}}function gf(n,e){(n.mu.get(e)||[]).forEach((t=>{t.resolve()})),n.mu.delete(e)}function mf(n,e,t){const r=z(n);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(t?i.reject(t):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function wa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.Iu.get(e))n.Tu.delete(r),t&&n.Pu.yu(r,t);n.Iu.delete(e),n.isPrimaryClient&&n.Ru.jr(e).forEach((r=>{n.Ru.containsKey(r)||_f(n,r)}))}function _f(n,e){n.Eu.delete(e.path.canonicalString());const t=n.du.get(e);t!==null&&(oc(n.remoteStore,t),n.du=n.du.remove(e),n.Au.delete(t),pc(n))}function Su(n,e,t){for(const r of t)r instanceof hf?(n.Ru.addReference(r.key,e),jE(n,r)):r instanceof df?(L(fc,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,e),n.Ru.containsKey(r.key)||_f(n,r.key)):$(19791,{wu:r})}function jE(n,e){const t=e.key,r=t.path.canonicalString();n.du.get(t)||n.Eu.has(r)||(L(fc,"New document in limbo: "+t),n.Eu.add(r),pc(n))}function pc(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const e=n.Eu.values().next().value;n.Eu.delete(e);const t=new F(ce.fromString(e)),r=n.fu.next();n.Au.set(r,new xE(t)),n.du=n.du.insert(t,r),tf(n.remoteStore,new ln(wt(Xa(t.path)),r,"TargetPurposeLimboResolution",so.ce))}}async function Fs(n,e,t){const r=z(n),s=[],i=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,u)=>{a.push(r.pu(u,e,t).then((d=>{if((d||t)&&r.isPrimaryClient){const f=d?!d.fromCache:t?.targetChanges.get(u.targetId)?.current;r.sharedClientState.updateQueryState(u.targetId,f?"current":"not-current")}if(d){s.push(d);const f=sc.As(u.targetId,d);i.push(f)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(u,d){const f=z(u);try{await f.persistence.runTransaction("notifyLocalViewChanges","readwrite",(g=>C.forEach(d,(T=>C.forEach(T.Es,(S=>f.persistence.referenceDelegate.addReference(g,T.targetId,S))).next((()=>C.forEach(T.ds,(S=>f.persistence.referenceDelegate.removeReference(g,T.targetId,S)))))))))}catch(g){if(!Pr(g))throw g;L(ic,"Failed to update sequence numbers: "+g)}for(const g of d){const T=g.targetId;if(!g.fromCache){const S=f.Ms.get(T),P=S.snapshotVersion,V=S.withLastLimboFreeSnapshotVersion(P);f.Ms=f.Ms.insert(T,V)}}})(r.localStore,i))}async function HE(n,e){const t=z(n);if(!t.currentUser.isEqual(e)){L(fc,"User change. New user:",e.toKey());const r=await Xd(t.localStore,e);t.currentUser=e,(function(i,a){i.mu.forEach((l=>{l.forEach((u=>{u.reject(new O(k.CANCELLED,a))}))})),i.mu.clear()})(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Fs(t,r.Ls)}}function GE(n,e){const t=z(n),r=t.Au.get(e);if(r&&r.hu)return J().add(r.key);{let s=J();const i=t.Iu.get(e);if(!i)return s;for(const a of i){const l=t.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function yf(n){const e=z(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=pf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=GE.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=BE.bind(null,e),e.Pu.H_=CE.bind(null,e.eventManager),e.Pu.yu=PE.bind(null,e.eventManager),e}function WE(n){const e=z(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qE.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=zE.bind(null,e),e}class Ki{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=fo(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return XT(this.persistence,new KT,e.initialUser,this.serializer)}Cu(e){return new Yd(rc.mi,this.serializer)}Du(e){return new sE}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ki.provider={build:()=>new Ki};class KE extends Ki{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){se(this.persistence.referenceDelegate instanceof Gi,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new xT(r,e.asyncQueue,t)}Cu(e){const t=this.cacheSizeBytes!==void 0?Ke.withCacheSize(this.cacheSizeBytes):Ke.DEFAULT;return new Yd((r=>Gi.mi(r,t)),this.serializer)}}class Ia{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ru(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=HE.bind(null,this.syncEngine),await RE(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new kE})()}createDatastore(e){const t=fo(e.databaseInfo.databaseId),r=(function(i){return new lE(i)})(e.databaseInfo);return(function(i,a,l,u){return new fE(i,a,l,u)})(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return(function(r,s,i,a,l){return new gE(r,s,i,a,l)})(this.localStore,this.datastore,e.asyncQueue,(t=>Ru(this.syncEngine,t,0)),(function(){return Eu.v()?new Eu:new iE})())}createSyncEngine(e,t){return(function(s,i,a,l,u,d,f){const g=new OE(s,i,a,l,u,d);return f&&(g.gu=!0),g})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){await(async function(t){const r=z(t);L(Kn,"RemoteStore shutting down."),r.Ea.add(5),await Us(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ia.provider={build:()=>new Ia};class Tf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):jt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}const En="FirestoreClient";class QE{constructor(e,t,r,s,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=s,this.user=Fe.UNAUTHENTICATED,this.clientId=Ha.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,(async a=>{L(En,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(L(En,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Bt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=hc(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}}async function Go(n,e){n.asyncQueue.verifyOperationInProgress(),L(En,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Xd(e.localStore,s),r=s)})),e.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=e}async function ku(n,e){n.asyncQueue.verifyOperationInProgress();const t=await YE(n);L(En,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener((r=>Iu(e.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Iu(e.remoteStore,s))),n._onlineComponents=e}async function YE(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){L(En,"Using user provided OfflineComponentProvider");try{await Go(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!(function(s){return s.name==="FirebaseError"?s.code===k.FAILED_PRECONDITION||s.code===k.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(t))throw t;yr("Error using user provided cache. Falling back to memory cache: "+t),await Go(n,new Ki)}}else L(En,"Using default OfflineComponentProvider"),await Go(n,new KE(void 0));return n._offlineComponents}async function Ef(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(L(En,"Using user provided OnlineComponentProvider"),await ku(n,n._uninitializedComponentsProvider._online)):(L(En,"Using default OnlineComponentProvider"),await ku(n,new Ia))),n._onlineComponents}function XE(n){return Ef(n).then((e=>e.syncEngine))}async function wf(n){const e=await Ef(n),t=e.eventManager;return t.onListen=VE.bind(null,e.syncEngine),t.onUnlisten=UE.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=LE.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=FE.bind(null,e.syncEngine),t}function JE(n,e,t={}){const r=new Bt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new Tf({next:T=>{f.Nu(),a.enqueueAndForget((()=>lf(i,g)));const S=T.docs.has(l);!S&&T.fromCache?d.reject(new O(k.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&T.fromCache&&u&&u.source==="server"?d.reject(new O(k.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(T)},error:T=>d.reject(T)}),g=new uf(Xa(l.path),f,{includeMetadataChanges:!0,qa:!0});return cf(i,g)})(await wf(n),n.asyncQueue,e,t,r))),r.promise}function ZE(n,e,t={}){const r=new Bt;return n.asyncQueue.enqueueAndForget((async()=>(function(i,a,l,u,d){const f=new Tf({next:T=>{f.Nu(),a.enqueueAndForget((()=>lf(i,g))),T.fromCache&&u.source==="server"?d.reject(new O(k.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(T)},error:T=>d.reject(T)}),g=new uf(l,f,{includeMetadataChanges:!0,qa:!0});return cf(i,g)})(await wf(n),n.asyncQueue,e,t,r))),r.promise}function If(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Cu=new Map;const vf="firestore.googleapis.com",Pu=!0;class Du{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new O(k.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=vf,this.ssl=Pu}else this.host=e.host,this.ssl=e.ssl??Pu;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Qd;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<DT)throw new O(k.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}py("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=If(e.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(k.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mo{constructor(e,t,r,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Du({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(k.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new O(k.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Du(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new sy;switch(r.type){case"firstParty":return new cy(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(k.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(t){const r=Cu.get(t);r&&(L("ComponentProvider","Removing Datastore"),Cu.delete(t),r.terminate())})(this),Promise.resolve()}}function ew(n,e,t,r={}){n=Ht(n,mo);const s=br(e),i=n._getSettings(),a={...i,emulatorOptions:n._getEmulatorOptions()},l=`${e}:${t}`;s&&(gh(`https://${l}`),mh("Firestore",!0)),i.host!==vf&&i.host!==l&&yr("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u={...i,host:l,ssl:s,emulatorOptions:r};if(!jn(u,a)&&(n._setSettings(u),r.mockUserToken)){let d,f;if(typeof r.mockUserToken=="string")d=r.mockUserToken,f=Fe.MOCK_USER;else{d=kp(r.mockUserToken,n._app?.options.projectId);const g=r.mockUserToken.sub||r.mockUserToken.user_id;if(!g)throw new O(k.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");f=new Fe(g)}n._authCredentials=new iy(new od(d,f))}}class vn{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new vn(this.firestore,e,this._query)}}class Te{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Te(this.firestore,e,this._key)}toJSON(){return{type:Te._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(Vs(t,Te._jsonSchema))return new Te(e,r||null,new F(ce.fromString(t.referencePath)))}}Te._jsonSchemaVersion="firestore/documentReference/1.0",Te._jsonSchema={type:Re("string",Te._jsonSchemaVersion),referencePath:Re("string")};class pn extends vn{constructor(e,t,r){super(e,t,Xa(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Te(this.firestore,null,new F(e))}withConverter(e){return new pn(this.firestore,e,this._path)}}function tw(n,e,...t){if(n=Le(n),ad("collection","path",e),n instanceof mo){const r=ce.fromString(e,...t);return jl(r),new pn(n,null,r)}{if(!(n instanceof Te||n instanceof pn))throw new O(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ce.fromString(e,...t));return jl(r),new pn(n.firestore,null,r)}}function _o(n,e,...t){if(n=Le(n),arguments.length===1&&(e=Ha.newId()),ad("doc","path",e),n instanceof mo){const r=ce.fromString(e,...t);return zl(r),new Te(n,null,new F(r))}{if(!(n instanceof Te||n instanceof pn))throw new O(k.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ce.fromString(e,...t));return zl(r),new Te(n.firestore,n instanceof pn?n.converter:null,new F(r))}}const Nu="AsyncQueue";class xu{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Zd(this,"async_queue_retry"),this._c=()=>{const r=Ho();r&&L(Nu,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const t=Ho();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ho();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const t=new Bt;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Pr(e))throw e;L(Nu,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const t=this.ac.then((()=>(this.rc=!0,e().catch((r=>{throw this.nc=r,this.rc=!1,jt("INTERNAL UNHANDLED ERROR: ",Ou(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const s=uc.createAndSchedule(this,e,t,r,(i=>this.hc(i)));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:Ou(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((t,r)=>t.targetTimeMs-r.targetTimeMs));for(const t of this.tc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Ou(n){let e=n.message||"";return n.stack&&(e=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),e}class $s extends mo{constructor(e,t,r,s){super(e,t,r,s),this.type="firestore",this._queue=new xu,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new xu(e),this._firestoreClient=void 0,await e}}}function nw(n,e){const t=typeof n=="object"?n:Eh(),r=typeof n=="string"?n:Fi,s=xa(t,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=Rp("firestore");i&&ew(s,...i)}return s}function gc(n){if(n._terminated)throw new O(k.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||rw(n),n._firestoreClient}function rw(n){const e=n._freezeSettings(),t=(function(s,i,a,l){return new Ry(s,i,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,If(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,e);n._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),n._firestoreClient=new QE(n._authCredentials,n._appCheckCredentials,n._queue,t,n._componentsProvider&&(function(s){const i=s?._online.build();return{_offline:s?._offline.build(i),_online:i}})(n._componentsProvider))}class nt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new nt(Me.fromBase64String(e))}catch(t){throw new O(k.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new nt(Me.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:nt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Vs(e,nt._jsonSchema))return nt.fromBase64String(e.bytes)}}nt._jsonSchemaVersion="firestore/bytes/1.0",nt._jsonSchema={type:Re("string",nt._jsonSchemaVersion),bytes:Re("string")};class yo{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new O(k.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ve(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class mc{constructor(e){this._methodName=e}}class At{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new O(k.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new O(k.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:At._jsonSchemaVersion}}static fromJSON(e){if(Vs(e,At._jsonSchema))return new At(e.latitude,e.longitude)}}At._jsonSchemaVersion="firestore/geoPoint/1.0",At._jsonSchema={type:Re("string",At._jsonSchemaVersion),latitude:Re("number"),longitude:Re("number")};class bt{constructor(e){this._values=(e||[]).map((t=>t))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0})(this._values,e._values)}toJSON(){return{type:bt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Vs(e,bt._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((t=>typeof t=="number")))return new bt(e.vectorValues);throw new O(k.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}bt._jsonSchemaVersion="firestore/vectorValue/1.0",bt._jsonSchema={type:Re("string",bt._jsonSchemaVersion),vectorValues:Re("object")};const sw=/^__.*__$/;class iw{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new In(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ls(e,this.data,t,this.fieldTransforms)}}class Af{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new In(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function bf(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}class _c{constructor(e,t,r,s,i,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new _c({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.gc(e),r}yc(e){const t=this.path?.child(e),r=this.Vc({path:t,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Qi(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((t=>e.isPrefixOf(t)))!==void 0||this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(bf(this.Ac)&&sw.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class ow{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||fo(e)}Cc(e,t,r,s=!1){return new _c({Ac:e,methodName:t,Dc:r,path:Ve.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function yc(n){const e=n._freezeSettings(),t=fo(n._databaseId);return new ow(n._databaseId,!!e.ignoreUndefinedProperties,t)}function aw(n,e,t,r,s,i={}){const a=n.Cc(i.merge||i.mergeFields?2:0,e,t,s);Tc("Data must be an object, but it was:",a,r);const l=Rf(r,a);let u,d;if(i.merge)u=new et(a.fieldMask),d=a.fieldTransforms;else if(i.mergeFields){const f=[];for(const g of i.mergeFields){const T=va(e,g,t);if(!a.contains(T))throw new O(k.INVALID_ARGUMENT,`Field '${T}' is specified in your field mask but missing from your input data.`);kf(f,T)||f.push(T)}u=new et(f),d=a.fieldTransforms.filter((g=>u.covers(g.field)))}else u=null,d=a.fieldTransforms;return new iw(new Qe(l),u,d)}class To extends mc{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof To}}function cw(n,e,t,r){const s=n.Cc(1,e,t);Tc("Data must be an object, but it was:",s,r);const i=[],a=Qe.empty();wn(r,((u,d)=>{const f=Ec(e,u,t);d=Le(d);const g=s.yc(f);if(d instanceof To)i.push(f);else{const T=Bs(d,g);T!=null&&(i.push(f),a.set(f,T))}}));const l=new et(i);return new Af(a,l,s.fieldTransforms)}function lw(n,e,t,r,s,i){const a=n.Cc(1,e,t),l=[va(e,r,t)],u=[s];if(i.length%2!=0)throw new O(k.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let T=0;T<i.length;T+=2)l.push(va(e,i[T])),u.push(i[T+1]);const d=[],f=Qe.empty();for(let T=l.length-1;T>=0;--T)if(!kf(d,l[T])){const S=l[T];let P=u[T];P=Le(P);const V=a.yc(S);if(P instanceof To)d.push(S);else{const x=Bs(P,V);x!=null&&(d.push(S),f.set(S,x))}}const g=new et(d);return new Af(f,g,a.fieldTransforms)}function uw(n,e,t,r=!1){return Bs(t,n.Cc(r?4:3,e))}function Bs(n,e){if(Sf(n=Le(n)))return Tc("Unsupported field value:",e,n),Rf(n,e);if(n instanceof mc)return(function(r,s){if(!bf(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)})(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(r,s){const i=[];let a=0;for(const l of r){let u=Bs(l,s.wc(a));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),a++}return{arrayValue:{values:i}}})(n,e)}return(function(r,s){if((r=Le(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Qy(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=oe.fromDate(r);return{timestampValue:Hi(s.serializer,i)}}if(r instanceof oe){const i=new oe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Hi(s.serializer,i)}}if(r instanceof At)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof nt)return{bytesValue:qd(s.serializer,r._byteString)};if(r instanceof Te){const i=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(i))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:tc(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof bt)return(function(a,l){return{mapValue:{fields:{[md]:{stringValue:_d},[$i]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return Ja(l.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${ro(r)}`)})(n,e)}function Rf(n,e){const t={};return ud(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):wn(n,((r,s)=>{const i=Bs(s,e.mc(r));i!=null&&(t[r]=i)})),{mapValue:{fields:t}}}function Sf(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof oe||n instanceof At||n instanceof nt||n instanceof Te||n instanceof mc||n instanceof bt)}function Tc(n,e,t){if(!Sf(t)||!cd(t)){const r=ro(t);throw r==="an object"?e.Sc(n+" a custom object"):e.Sc(n+" "+r)}}function va(n,e,t){if((e=Le(e))instanceof yo)return e._internalPath;if(typeof e=="string")return Ec(n,e);throw Qi("Field path arguments must be of type string or ",n,!1,void 0,t)}const hw=new RegExp("[~\\*/\\[\\]]");function Ec(n,e,t){if(e.search(hw)>=0)throw Qi(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new yo(...e.split("."))._internalPath}catch{throw Qi(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Qi(n,e,t,r,s){const i=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let u="";return(i||a)&&(u+=" (found",i&&(u+=` in field ${r}`),a&&(u+=` in document ${s}`),u+=")"),new O(k.INVALID_ARGUMENT,l+n+u)}function kf(n,e){return n.some((t=>t.isEqual(e)))}class Cf{constructor(e,t,r,s,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Te(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new dw(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Eo("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class dw extends Cf{data(){return super.data()}}function Eo(n,e){return typeof e=="string"?Ec(n,e):e instanceof yo?e._internalPath:e._delegate._internalPath}function fw(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(k.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class wc{}class Ic extends wc{}function pw(n,e,...t){let r=[];e instanceof wc&&r.push(e),r=r.concat(t),(function(i){const a=i.filter((u=>u instanceof vc)).length,l=i.filter((u=>u instanceof wo)).length;if(a>1||a>0&&l>0)throw new O(k.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(r);for(const s of r)n=s._apply(n);return n}class wo extends Ic{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new wo(e,t,r)}_apply(e){const t=this._parse(e);return Pf(e._query,t),new vn(e.firestore,e.converter,fa(e._query,t))}_parse(e){const t=yc(e.firestore);return(function(i,a,l,u,d,f,g){let T;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new O(k.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){Lu(g,f);const P=[];for(const V of g)P.push(Vu(u,i,V));T={arrayValue:{values:P}}}else T=Vu(u,i,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||Lu(g,f),T=uw(l,a,g,f==="in"||f==="not-in");return be.create(d,f,T)})(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function gw(n,e,t){const r=e,s=Eo("where",n);return wo._create(s,r,t)}class vc extends wc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new vc(e,t)}_parse(e){const t=this._queryConstraints.map((r=>r._parse(e))).filter((r=>r.getFilters().length>0));return t.length===1?t[0]:dt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:((function(s,i){let a=s;const l=i.getFlattenedFilters();for(const u of l)Pf(a,u),a=fa(a,u)})(e._query,t),new vn(e.firestore,e.converter,fa(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ac extends Ic{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ac(e,t)}_apply(e){const t=(function(s,i,a){if(s.startAt!==null)throw new O(k.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new O(k.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Rs(i,a)})(e._query,this._field,this._direction);return new vn(e.firestore,e.converter,(function(s,i){const a=s.explicitOrderBy.concat([i]);return new Dr(s.path,s.collectionGroup,a,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)})(e._query,t))}}function mw(n,e="asc"){const t=e,r=Eo("orderBy",n);return Ac._create(r,t)}class bc extends Ic{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new bc(e,t,r)}_apply(e){return new vn(e.firestore,e.converter,qi(e._query,this._limit,this._limitType))}}function _w(n){return gy("limit",n),bc._create("limit",n,"F")}function Vu(n,e,t){if(typeof(t=Le(t))=="string"){if(t==="")throw new O(k.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!bd(e)&&t.indexOf("/")!==-1)throw new O(k.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ce.fromString(t));if(!F.isDocumentKey(r))throw new O(k.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Jl(n,new F(r))}if(t instanceof Te)return Jl(n,t._key);throw new O(k.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ro(t)}.`)}function Lu(n,e){if(!Array.isArray(n)||n.length===0)throw new O(k.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function Pf(n,e){const t=(function(s,i){for(const a of s)for(const l of a.getFlattenedFilters())if(i.indexOf(l.op)>=0)return l.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(t!==null)throw t===e.op?new O(k.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new O(k.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class yw{convertValue(e,t="none"){switch(yn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ye(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_n(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw $(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return wn(e,((s,i)=>{r[s]=this.convertValue(i,t)})),r}convertVectorValue(e){const t=e.fields?.[$i].arrayValue?.values?.map((r=>ye(r.doubleValue)));return new bt(t)}convertGeoPoint(e){return new At(ye(e.latitude),ye(e.longitude))}convertArray(e,t){return(e.values||[]).map((r=>this.convertValue(r,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const r=oo(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(vs(e));default:return null}}convertTimestamp(e){const t=mn(e);return new oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ce.fromString(e);se(Kd(r),9688,{name:e});const s=new As(r.get(1),r.get(3)),i=new F(r.popFirst(5));return s.isEqual(t)||jt(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function Tw(n,e,t){let r;return r=n?n.toFirestore(e):e,r}class hs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class zn extends Cf{constructor(e,t,r,s,i,a){super(e,t,r,s,a),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new ki(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Eo("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(k.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=zn._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?t:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t)}}zn._jsonSchemaVersion="firestore/documentSnapshot/1.0",zn._jsonSchema={type:Re("string",zn._jsonSchemaVersion),bundleSource:Re("string","DocumentSnapshot"),bundleName:Re("string"),bundle:Re("string")};class ki extends zn{data(e={}){return super.data(e)}}class gr{constructor(e,t,r,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new hs(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach((r=>{e.call(t,new ki(this._firestore,this._userDataWriter,r.key,r,new hs(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new O(k.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=(function(s,i){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const u=new ki(s._firestore,s._userDataWriter,l.doc.key,l.doc,new hs(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:u,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>i||l.type!==3)).map((l=>{const u=new ki(s._firestore,s._userDataWriter,l.doc.key,l.doc,new hs(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,f=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),f=a.indexOf(l.doc.key)),{type:Ew(l.type),doc:u,oldIndex:d,newIndex:f}}))}})(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(k.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=gr._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Ha.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],s=[];return this.docs.forEach((i=>{i._document!==null&&(t.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Ew(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}function Df(n){n=Ht(n,Te);const e=Ht(n.firestore,$s);return JE(gc(e),n._key).then((t=>Aw(e,n,t)))}gr._jsonSchemaVersion="firestore/querySnapshot/1.0",gr._jsonSchema={type:Re("string",gr._jsonSchemaVersion),bundleSource:Re("string","QuerySnapshot"),bundleName:Re("string"),bundle:Re("string")};class Nf extends yw{constructor(e){super(),this.firestore=e}convertBytes(e){return new nt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Te(this.firestore,null,t)}}function ww(n){n=Ht(n,vn);const e=Ht(n.firestore,$s),t=gc(e),r=new Nf(e);return fw(n._query),ZE(t,n._query).then((s=>new gr(e,r,n,s)))}function Iw(n,e,t){n=Ht(n,Te);const r=Ht(n.firestore,$s),s=Tw(n.converter,e);return xf(r,[aw(yc(r),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,It.none())])}function vw(n,e,t,...r){n=Ht(n,Te);const s=Ht(n.firestore,$s),i=yc(s);let a;return a=typeof(e=Le(e))=="string"||e instanceof yo?lw(i,"updateDoc",n._key,e,t,r):cw(i,"updateDoc",n._key,e),xf(s,[a.toMutation(n._key,It.exists(!0))])}function xf(n,e){return(function(r,s){const i=new Bt;return r.asyncQueue.enqueueAndForget((async()=>$E(await XE(r),s,i))),i.promise})(gc(n),e)}function Aw(n,e,t){const r=t.docs.get(e._key),s=new Nf(n);return new zn(n,s,e._key,r,new hs(t.hasPendingWrites,t.fromCache),e.converter)}(function(e,t=!0){(function(s){kr=s})(Rr),mr(new Hn("firestore",((r,{instanceIdentifier:s,options:i})=>{const a=r.getProvider("app").getImmediate(),l=new $s(new oy(r.getProvider("auth-internal")),new ly(a,r.getProvider("app-check-internal")),(function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(k.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new As(d.options.projectId,f)})(a,s),a);return i={useFetchStreams:t,...i},l._setSettings(i),l}),"PUBLIC").setMultipleInstances(!0)),dn(Fl,$l,e),dn(Fl,$l,"esm2020")})();const bw={apiKey:"YOUR_API_KEY",authDomain:"YOUR_PROJECT.firebaseapp.com",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_PROJECT.firebasestorage.app",messagingSenderId:"YOUR_MESSAGING_SENDER_ID",appId:"YOUR_APP_ID"},Of=Th(bw),Rc=ey(Of),qs=nw(Of);async function Rw(){const n=new Ut,e=await l_(Rc,n);return Vf(e.user)}async function Sw(){await zm(Rc)}function kw(n){return qm(Rc,e=>{n(e?Vf(e):null)})}function Vf(n){return{uid:n.uid,email:n.email,displayName:n.displayName,photoURL:n.photoURL}}const Cw="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let Lf=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=Cw[t[n]&63];return e};function Mf(n){return{...n,createdAt:n.createdAt.toDate(),updatedAt:n.updatedAt.toDate(),highlights:n.highlights.map(e=>({...e,createdAt:e.createdAt.toDate()}))}}function Uf(n){return{...n,createdAt:oe.fromDate(n.createdAt),updatedAt:oe.fromDate(n.updatedAt),highlights:n.highlights.map(e=>({...e,createdAt:oe.fromDate(e.createdAt)}))}}const zs="gists";function Mu(){return Lf(8)}async function Pw(n){const e=_o(qs,zs,n);return(await Df(e)).exists()}async function Dw(){let n=Mu(),e=0;const t=10;for(;await Pw(n);){if(e++>t)throw new Error("Failed to generate unique ID after multiple attempts");n=Mu()}return n}async function Nw(n,e,t){const r=await Dw(),s=new Date,i={id:r,markdown:n,createdBy:e,createdAt:s,updatedAt:s,highlights:[],title:t},a=_o(qs,zs,r);return await Iw(a,Uf(i)),i}async function Io(n){const e=_o(qs,zs,n),t=await Df(e);return t.exists()?Mf(t.data()):null}async function Sc(n){const e=_o(qs,zs,n.id),t={...n,updatedAt:new Date};await vw(e,Uf(t))}async function xw(n,e=50){const t=pw(tw(qs,zs),gw("createdBy","==",n),mw("updatedAt","desc"),_w(e));return(await ww(t)).docs.map(s=>Mf(s.data()))}async function Uu(n,e){const t=await Io(n);if(!t)throw new Error(`Gist ${n} not found`);const r=t.highlights.filter(s=>s.id!==e.id);r.push(e),t.highlights=r,await Sc(t)}async function Ow(n,e){const t=await Io(n);if(!t)throw new Error(`Gist ${n} not found`);t.highlights=t.highlights.filter(r=>r.id!==e),await Sc(t)}function Ff(){const n=window.location.hash.slice(1);return!n||n==="/"||n===""?{type:"home"}:n==="/create"?{type:"create"}:n.startsWith("/edit/")?{type:"edit",gistId:n.slice(6)}:n.startsWith("/")?{type:"view",gistId:n.slice(1)}:{type:"home"}}function Ar(n){switch(n.type){case"home":window.location.hash="#/";break;case"create":window.location.hash="#/create";break;case"edit":window.location.hash=`#/edit/${n.gistId}`;break;case"view":window.location.hash=`#/${n.gistId}`;break}}function Vw(n){const e=()=>{n(Ff())};return window.addEventListener("hashchange",e),()=>{window.removeEventListener("hashchange",e)}}function Lw(n){return`${window.location.origin+window.location.pathname}#/${n}`}function kc(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var Jn=kc();function $f(n){Jn=n}var Ts={exec:()=>null};function ne(n,e=""){let t=typeof n=="string"?n:n.source,r={replace:(s,i)=>{let a=typeof i=="string"?i:i.source;return a=a.replace(ze.caret,"$1"),t=t.replace(s,a),r},getRegex:()=>new RegExp(t,e)};return r}var Mw=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch{return!1}})(),ze={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:n=>new RegExp(`^( {0,3}${n})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}#`),htmlBeginRegex:n=>new RegExp(`^ {0,${Math.min(3,n-1)}}<(?:[a-z].*>|!--)`,"i")},Uw=/^(?:[ \t]*(?:\n|$))+/,Fw=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,$w=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,js=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,Bw=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,Cc=/(?:[*+-]|\d{1,9}[.)])/,Bf=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,qf=ne(Bf).replace(/bull/g,Cc).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),qw=ne(Bf).replace(/bull/g,Cc).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Pc=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,zw=/^[^\n]+/,Dc=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,jw=ne(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Dc).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),Hw=ne(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,Cc).getRegex(),vo="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",Nc=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,Gw=ne("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",Nc).replace("tag",vo).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),zf=ne(Pc).replace("hr",js).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vo).getRegex(),Ww=ne(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",zf).getRegex(),xc={blockquote:Ww,code:Fw,def:jw,fences:$w,heading:Bw,hr:js,html:Gw,lheading:qf,list:Hw,newline:Uw,paragraph:zf,table:Ts,text:zw},Fu=ne("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",js).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vo).getRegex(),Kw={...xc,lheading:qw,table:Fu,paragraph:ne(Pc).replace("hr",js).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",Fu).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",vo).getRegex()},Qw={...xc,html:ne(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",Nc).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Ts,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:ne(Pc).replace("hr",js).replace("heading",` *#{1,6} *[^
]`).replace("lheading",qf).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},Yw=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,Xw=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,jf=/^( {2,}|\\)\n(?!\s*$)/,Jw=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ao=/[\p{P}\p{S}]/u,Oc=/[\s\p{P}\p{S}]/u,Hf=/[^\s\p{P}\p{S}]/u,Zw=ne(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Oc).getRegex(),Gf=/(?!~)[\p{P}\p{S}]/u,eI=/(?!~)[\s\p{P}\p{S}]/u,tI=/(?:[^\s\p{P}\p{S}]|~)/u,nI=ne(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",Mw?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),Wf=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,rI=ne(Wf,"u").replace(/punct/g,Ao).getRegex(),sI=ne(Wf,"u").replace(/punct/g,Gf).getRegex(),Kf="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",iI=ne(Kf,"gu").replace(/notPunctSpace/g,Hf).replace(/punctSpace/g,Oc).replace(/punct/g,Ao).getRegex(),oI=ne(Kf,"gu").replace(/notPunctSpace/g,tI).replace(/punctSpace/g,eI).replace(/punct/g,Gf).getRegex(),aI=ne("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Hf).replace(/punctSpace/g,Oc).replace(/punct/g,Ao).getRegex(),cI=ne(/\\(punct)/,"gu").replace(/punct/g,Ao).getRegex(),lI=ne(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),uI=ne(Nc).replace("(?:-->|$)","-->").getRegex(),hI=ne("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",uI).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),Yi=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,dI=ne(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",Yi).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Qf=ne(/^!?\[(label)\]\[(ref)\]/).replace("label",Yi).replace("ref",Dc).getRegex(),Yf=ne(/^!?\[(ref)\](?:\[\])?/).replace("ref",Dc).getRegex(),fI=ne("reflink|nolink(?!\\()","g").replace("reflink",Qf).replace("nolink",Yf).getRegex(),$u=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Vc={_backpedal:Ts,anyPunctuation:cI,autolink:lI,blockSkip:nI,br:jf,code:Xw,del:Ts,emStrongLDelim:rI,emStrongRDelimAst:iI,emStrongRDelimUnd:aI,escape:Yw,link:dI,nolink:Yf,punctuation:Zw,reflink:Qf,reflinkSearch:fI,tag:hI,text:Jw,url:Ts},pI={...Vc,link:ne(/^!?\[(label)\]\((.*?)\)/).replace("label",Yi).getRegex(),reflink:ne(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",Yi).getRegex()},Aa={...Vc,emStrongRDelimAst:oI,emStrongLDelim:sI,url:ne(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",$u).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:ne(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",$u).getRegex()},gI={...Aa,br:ne(jf).replace("{2,}","*").getRegex(),text:ne(Aa.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},mi={normal:xc,gfm:Kw,pedantic:Qw},ts={normal:Vc,gfm:Aa,breaks:gI,pedantic:pI},mI={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Bu=n=>mI[n];function Lt(n,e){if(e){if(ze.escapeTest.test(n))return n.replace(ze.escapeReplace,Bu)}else if(ze.escapeTestNoEncode.test(n))return n.replace(ze.escapeReplaceNoEncode,Bu);return n}function qu(n){try{n=encodeURI(n).replace(ze.percentDecode,"%")}catch{return null}return n}function zu(n,e){let t=n.replace(ze.findPipe,(i,a,l)=>{let u=!1,d=a;for(;--d>=0&&l[d]==="\\";)u=!u;return u?"|":" |"}),r=t.split(ze.splitPipe),s=0;if(r[0].trim()||r.shift(),r.length>0&&!r.at(-1)?.trim()&&r.pop(),e)if(r.length>e)r.splice(e);else for(;r.length<e;)r.push("");for(;s<r.length;s++)r[s]=r[s].trim().replace(ze.slashPipe,"|");return r}function ns(n,e,t){let r=n.length;if(r===0)return"";let s=0;for(;s<r&&n.charAt(r-s-1)===e;)s++;return n.slice(0,r-s)}function _I(n,e){if(n.indexOf(e[1])===-1)return-1;let t=0;for(let r=0;r<n.length;r++)if(n[r]==="\\")r++;else if(n[r]===e[0])t++;else if(n[r]===e[1]&&(t--,t<0))return r;return t>0?-2:-1}function ju(n,e,t,r,s){let i=e.href,a=e.title||null,l=n[1].replace(s.other.outputLinkReplace,"$1");r.state.inLink=!0;let u={type:n[0].charAt(0)==="!"?"image":"link",raw:t,href:i,title:a,text:l,tokens:r.inlineTokens(l)};return r.state.inLink=!1,u}function yI(n,e,t){let r=n.match(t.other.indentCodeCompensation);if(r===null)return e;let s=r[1];return e.split(`
`).map(i=>{let a=i.match(t.other.beginningSpace);if(a===null)return i;let[l]=a;return l.length>=s.length?i.slice(s.length):i}).join(`
`)}var Xi=class{options;rules;lexer;constructor(n){this.options=n||Jn}space(n){let e=this.rules.block.newline.exec(n);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(n){let e=this.rules.block.code.exec(n);if(e){let t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:ns(t,`
`)}}}fences(n){let e=this.rules.block.fences.exec(n);if(e){let t=e[0],r=yI(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:r}}}heading(n){let e=this.rules.block.heading.exec(n);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){let r=ns(t,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(t=r.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(n){let e=this.rules.block.hr.exec(n);if(e)return{type:"hr",raw:ns(e[0],`
`)}}blockquote(n){let e=this.rules.block.blockquote.exec(n);if(e){let t=ns(e[0],`
`).split(`
`),r="",s="",i=[];for(;t.length>0;){let a=!1,l=[],u;for(u=0;u<t.length;u++)if(this.rules.other.blockquoteStart.test(t[u]))l.push(t[u]),a=!0;else if(!a)l.push(t[u]);else break;t=t.slice(u);let d=l.join(`
`),f=d.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${d}`:d,s=s?`${s}
${f}`:f;let g=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(f,i,!0),this.lexer.state.top=g,t.length===0)break;let T=i.at(-1);if(T?.type==="code")break;if(T?.type==="blockquote"){let S=T,P=S.raw+`
`+t.join(`
`),V=this.blockquote(P);i[i.length-1]=V,r=r.substring(0,r.length-S.raw.length)+V.raw,s=s.substring(0,s.length-S.text.length)+V.text;break}else if(T?.type==="list"){let S=T,P=S.raw+`
`+t.join(`
`),V=this.list(P);i[i.length-1]=V,r=r.substring(0,r.length-T.raw.length)+V.raw,s=s.substring(0,s.length-S.raw.length)+V.raw,t=P.substring(i.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:i,text:s}}}list(n){let e=this.rules.block.list.exec(n);if(e){let t=e[1].trim(),r=t.length>1,s={type:"list",raw:"",ordered:r,start:r?+t.slice(0,-1):"",loose:!1,items:[]};t=r?`\\d{1,9}\\${t.slice(-1)}`:`\\${t}`,this.options.pedantic&&(t=r?t:"[*+-]");let i=this.rules.other.listItemRegex(t),a=!1;for(;n;){let u=!1,d="",f="";if(!(e=i.exec(n))||this.rules.block.hr.test(n))break;d=e[0],n=n.substring(d.length);let g=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,x=>" ".repeat(3*x.length)),T=n.split(`
`,1)[0],S=!g.trim(),P=0;if(this.options.pedantic?(P=2,f=g.trimStart()):S?P=e[1].length+1:(P=e[2].search(this.rules.other.nonSpaceChar),P=P>4?1:P,f=g.slice(P),P+=e[1].length),S&&this.rules.other.blankLine.test(T)&&(d+=T+`
`,n=n.substring(T.length+1),u=!0),!u){let x=this.rules.other.nextBulletRegex(P),j=this.rules.other.hrRegex(P),G=this.rules.other.fencesBeginRegex(P),W=this.rules.other.headingBeginRegex(P),ee=this.rules.other.htmlBeginRegex(P);for(;n;){let he=n.split(`
`,1)[0],ie;if(T=he,this.options.pedantic?(T=T.replace(this.rules.other.listReplaceNesting,"  "),ie=T):ie=T.replace(this.rules.other.tabCharGlobal,"    "),G.test(T)||W.test(T)||ee.test(T)||x.test(T)||j.test(T))break;if(ie.search(this.rules.other.nonSpaceChar)>=P||!T.trim())f+=`
`+ie.slice(P);else{if(S||g.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||G.test(g)||W.test(g)||j.test(g))break;f+=`
`+T}!S&&!T.trim()&&(S=!0),d+=he+`
`,n=n.substring(he.length+1),g=ie.slice(P)}}s.loose||(a?s.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(a=!0));let V=null;this.options.gfm&&(V=this.rules.other.listIsTask.exec(f),V&&(f=f.replace(this.rules.other.listReplaceTask,""))),s.items.push({type:"list_item",raw:d,task:!!V,loose:!1,text:f,tokens:[]}),s.raw+=d}let l=s.items.at(-1);if(l)l.raw=l.raw.trimEnd(),l.text=l.text.trimEnd();else return;s.raw=s.raw.trimEnd();for(let u of s.items){if(this.lexer.state.top=!1,u.tokens=this.lexer.blockTokens(u.text,[]),u.task){let d=this.rules.other.listTaskCheckbox.exec(u.raw);if(d){let f={type:"checkbox",raw:d[0]+" ",checked:d[0]!=="[ ]"};u.checked=f.checked,s.loose?u.tokens[0]&&["paragraph","text"].includes(u.tokens[0].type)&&"tokens"in u.tokens[0]&&u.tokens[0].tokens?(u.tokens[0].raw=f.raw+u.tokens[0].raw,u.tokens[0].text=f.raw+u.tokens[0].text,u.tokens[0].tokens.unshift(f)):u.tokens.unshift({type:"paragraph",raw:f.raw,text:f.raw,tokens:[f]}):u.tokens.unshift(f)}}if(!s.loose){let d=u.tokens.filter(g=>g.type==="space"),f=d.length>0&&d.some(g=>this.rules.other.anyLine.test(g.raw));s.loose=f}}if(s.loose)for(let u of s.items){u.loose=!0;for(let d of u.tokens)d.type==="text"&&(d.type="paragraph")}return s}}html(n){let e=this.rules.block.html.exec(n);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(n){let e=this.rules.block.def.exec(n);if(e){let t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",s=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:r,title:s}}}table(n){let e=this.rules.block.table.exec(n);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let t=zu(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),s=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],i={type:"table",raw:e[0],header:[],align:[],rows:[]};if(t.length===r.length){for(let a of r)this.rules.other.tableAlignRight.test(a)?i.align.push("right"):this.rules.other.tableAlignCenter.test(a)?i.align.push("center"):this.rules.other.tableAlignLeft.test(a)?i.align.push("left"):i.align.push(null);for(let a=0;a<t.length;a++)i.header.push({text:t[a],tokens:this.lexer.inline(t[a]),header:!0,align:i.align[a]});for(let a of s)i.rows.push(zu(a,i.header.length).map((l,u)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:i.align[u]})));return i}}lheading(n){let e=this.rules.block.lheading.exec(n);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(n){let e=this.rules.block.paragraph.exec(n);if(e){let t=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(n){let e=this.rules.block.text.exec(n);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(n){let e=this.rules.inline.escape.exec(n);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(n){let e=this.rules.inline.tag.exec(n);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(n){let e=this.rules.inline.link.exec(n);if(e){let t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;let i=ns(t.slice(0,-1),"\\");if((t.length-i.length)%2===0)return}else{let i=_I(e[2],"()");if(i===-2)return;if(i>-1){let a=(e[0].indexOf("!")===0?5:4)+e[1].length+i;e[2]=e[2].substring(0,i),e[0]=e[0].substring(0,a).trim(),e[3]=""}}let r=e[2],s="";if(this.options.pedantic){let i=this.rules.other.pedanticHrefTitle.exec(r);i&&(r=i[1],s=i[3])}else s=e[3]?e[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?r=r.slice(1):r=r.slice(1,-1)),ju(e,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:s&&s.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(n,e){let t;if((t=this.rules.inline.reflink.exec(n))||(t=this.rules.inline.nolink.exec(n))){let r=(t[2]||t[1]).replace(this.rules.other.multipleSpaceGlobal," "),s=e[r.toLowerCase()];if(!s){let i=t[0].charAt(0);return{type:"text",raw:i,text:i}}return ju(t,s,t[0],this.lexer,this.rules)}}emStrong(n,e,t=""){let r=this.rules.inline.emStrongLDelim.exec(n);if(!(!r||r[3]&&t.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!t||this.rules.inline.punctuation.exec(t))){let s=[...r[0]].length-1,i,a,l=s,u=0,d=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(d.lastIndex=0,e=e.slice(-1*n.length+s);(r=d.exec(e))!=null;){if(i=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!i)continue;if(a=[...i].length,r[3]||r[4]){l+=a;continue}else if((r[5]||r[6])&&s%3&&!((s+a)%3)){u+=a;continue}if(l-=a,l>0)continue;a=Math.min(a,a+l+u);let f=[...r[0]][0].length,g=n.slice(0,s+r.index+f+a);if(Math.min(s,a)%2){let S=g.slice(1,-1);return{type:"em",raw:g,text:S,tokens:this.lexer.inlineTokens(S)}}let T=g.slice(2,-2);return{type:"strong",raw:g,text:T,tokens:this.lexer.inlineTokens(T)}}}}codespan(n){let e=this.rules.inline.code.exec(n);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(t),s=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return r&&s&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(n){let e=this.rules.inline.br.exec(n);if(e)return{type:"br",raw:e[0]}}del(n){let e=this.rules.inline.del.exec(n);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(n){let e=this.rules.inline.autolink.exec(n);if(e){let t,r;return e[2]==="@"?(t=e[1],r="mailto:"+t):(t=e[1],r=t),{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}url(n){let e;if(e=this.rules.inline.url.exec(n)){let t,r;if(e[2]==="@")t=e[0],r="mailto:"+t;else{let s;do s=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??"";while(s!==e[0]);t=e[0],e[1]==="www."?r="http://"+e[0]:r=e[0]}return{type:"link",raw:e[0],text:t,href:r,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(n){let e=this.rules.inline.text.exec(n);if(e){let t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},at=class ba{tokens;options;state;tokenizer;inlineQueue;constructor(e){this.tokens=[],this.tokens.links=Object.create(null),this.options=e||Jn,this.options.tokenizer=this.options.tokenizer||new Xi,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let t={other:ze,block:mi.normal,inline:ts.normal};this.options.pedantic?(t.block=mi.pedantic,t.inline=ts.pedantic):this.options.gfm&&(t.block=mi.gfm,this.options.breaks?t.inline=ts.breaks:t.inline=ts.gfm),this.tokenizer.rules=t}static get rules(){return{block:mi,inline:ts}}static lex(e,t){return new ba(t).lex(e)}static lexInline(e,t){return new ba(t).inlineTokens(e)}lex(e){e=e.replace(ze.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){let r=this.inlineQueue[t];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,t=[],r=!1){for(this.options.pedantic&&(e=e.replace(ze.tabCharGlobal,"    ").replace(ze.spaceLine,""));e;){let s;if(this.options.extensions?.block?.some(a=>(s=a.call({lexer:this},e,t))?(e=e.substring(s.raw.length),t.push(s),!0):!1))continue;if(s=this.tokenizer.space(e)){e=e.substring(s.raw.length);let a=t.at(-1);s.raw.length===1&&a!==void 0?a.raw+=`
`:t.push(s);continue}if(s=this.tokenizer.code(e)){e=e.substring(s.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+s.raw,a.text+=`
`+s.text,this.inlineQueue.at(-1).src=a.text):t.push(s);continue}if(s=this.tokenizer.fences(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.heading(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.hr(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.blockquote(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.list(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.html(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.def(e)){e=e.substring(s.raw.length);let a=t.at(-1);a?.type==="paragraph"||a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+s.raw,a.text+=`
`+s.raw,this.inlineQueue.at(-1).src=a.text):this.tokens.links[s.tag]||(this.tokens.links[s.tag]={href:s.href,title:s.title},t.push(s));continue}if(s=this.tokenizer.table(e)){e=e.substring(s.raw.length),t.push(s);continue}if(s=this.tokenizer.lheading(e)){e=e.substring(s.raw.length),t.push(s);continue}let i=e;if(this.options.extensions?.startBlock){let a=1/0,l=e.slice(1),u;this.options.extensions.startBlock.forEach(d=>{u=d.call({lexer:this},l),typeof u=="number"&&u>=0&&(a=Math.min(a,u))}),a<1/0&&a>=0&&(i=e.substring(0,a+1))}if(this.state.top&&(s=this.tokenizer.paragraph(i))){let a=t.at(-1);r&&a?.type==="paragraph"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(s),r=i.length!==e.length,e=e.substring(s.raw.length);continue}if(s=this.tokenizer.text(e)){e=e.substring(s.raw.length);let a=t.at(-1);a?.type==="text"?(a.raw+=(a.raw.endsWith(`
`)?"":`
`)+s.raw,a.text+=`
`+s.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=a.text):t.push(s);continue}if(e){let a="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(a);break}else throw new Error(a)}}return this.state.top=!0,t}inline(e,t=[]){return this.inlineQueue.push({src:e,tokens:t}),t}inlineTokens(e,t=[]){let r=e,s=null;if(this.tokens.links){let u=Object.keys(this.tokens.links);if(u.length>0)for(;(s=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)u.includes(s[0].slice(s[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,s.index)+"["+"a".repeat(s[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(s=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,s.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let i;for(;(s=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)i=s[2]?s[2].length:0,r=r.slice(0,s.index+i)+"["+"a".repeat(s[0].length-i-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);r=this.options.hooks?.emStrongMask?.call({lexer:this},r)??r;let a=!1,l="";for(;e;){a||(l=""),a=!1;let u;if(this.options.extensions?.inline?.some(f=>(u=f.call({lexer:this},e,t))?(e=e.substring(u.raw.length),t.push(u),!0):!1))continue;if(u=this.tokenizer.escape(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.tag(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.link(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(u.raw.length);let f=t.at(-1);u.type==="text"&&f?.type==="text"?(f.raw+=u.raw,f.text+=u.text):t.push(u);continue}if(u=this.tokenizer.emStrong(e,r,l)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.codespan(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.br(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.del(e)){e=e.substring(u.raw.length),t.push(u);continue}if(u=this.tokenizer.autolink(e)){e=e.substring(u.raw.length),t.push(u);continue}if(!this.state.inLink&&(u=this.tokenizer.url(e))){e=e.substring(u.raw.length),t.push(u);continue}let d=e;if(this.options.extensions?.startInline){let f=1/0,g=e.slice(1),T;this.options.extensions.startInline.forEach(S=>{T=S.call({lexer:this},g),typeof T=="number"&&T>=0&&(f=Math.min(f,T))}),f<1/0&&f>=0&&(d=e.substring(0,f+1))}if(u=this.tokenizer.inlineText(d)){e=e.substring(u.raw.length),u.raw.slice(-1)!=="_"&&(l=u.raw.slice(-1)),a=!0;let f=t.at(-1);f?.type==="text"?(f.raw+=u.raw,f.text+=u.text):t.push(u);continue}if(e){let f="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return t}},Ji=class{options;parser;constructor(n){this.options=n||Jn}space(n){return""}code({text:n,lang:e,escaped:t}){let r=(e||"").match(ze.notSpaceStart)?.[0],s=n.replace(ze.endingNewline,"")+`
`;return r?'<pre><code class="language-'+Lt(r)+'">'+(t?s:Lt(s,!0))+`</code></pre>
`:"<pre><code>"+(t?s:Lt(s,!0))+`</code></pre>
`}blockquote({tokens:n}){return`<blockquote>
${this.parser.parse(n)}</blockquote>
`}html({text:n}){return n}def(n){return""}heading({tokens:n,depth:e}){return`<h${e}>${this.parser.parseInline(n)}</h${e}>
`}hr(n){return`<hr>
`}list(n){let e=n.ordered,t=n.start,r="";for(let a=0;a<n.items.length;a++){let l=n.items[a];r+=this.listitem(l)}let s=e?"ol":"ul",i=e&&t!==1?' start="'+t+'"':"";return"<"+s+i+`>
`+r+"</"+s+`>
`}listitem(n){return`<li>${this.parser.parse(n.tokens)}</li>
`}checkbox({checked:n}){return"<input "+(n?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:n}){return`<p>${this.parser.parseInline(n)}</p>
`}table(n){let e="",t="";for(let s=0;s<n.header.length;s++)t+=this.tablecell(n.header[s]);e+=this.tablerow({text:t});let r="";for(let s=0;s<n.rows.length;s++){let i=n.rows[s];t="";for(let a=0;a<i.length;a++)t+=this.tablecell(i[a]);r+=this.tablerow({text:t})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+r+`</table>
`}tablerow({text:n}){return`<tr>
${n}</tr>
`}tablecell(n){let e=this.parser.parseInline(n.tokens),t=n.header?"th":"td";return(n.align?`<${t} align="${n.align}">`:`<${t}>`)+e+`</${t}>
`}strong({tokens:n}){return`<strong>${this.parser.parseInline(n)}</strong>`}em({tokens:n}){return`<em>${this.parser.parseInline(n)}</em>`}codespan({text:n}){return`<code>${Lt(n,!0)}</code>`}br(n){return"<br>"}del({tokens:n}){return`<del>${this.parser.parseInline(n)}</del>`}link({href:n,title:e,tokens:t}){let r=this.parser.parseInline(t),s=qu(n);if(s===null)return r;n=s;let i='<a href="'+n+'"';return e&&(i+=' title="'+Lt(e)+'"'),i+=">"+r+"</a>",i}image({href:n,title:e,text:t,tokens:r}){r&&(t=this.parser.parseInline(r,this.parser.textRenderer));let s=qu(n);if(s===null)return Lt(t);n=s;let i=`<img src="${n}" alt="${t}"`;return e&&(i+=` title="${Lt(e)}"`),i+=">",i}text(n){return"tokens"in n&&n.tokens?this.parser.parseInline(n.tokens):"escaped"in n&&n.escaped?n.text:Lt(n.text)}},Lc=class{strong({text:n}){return n}em({text:n}){return n}codespan({text:n}){return n}del({text:n}){return n}html({text:n}){return n}text({text:n}){return n}link({text:n}){return""+n}image({text:n}){return""+n}br(){return""}checkbox({raw:n}){return n}},ct=class Ra{options;renderer;textRenderer;constructor(e){this.options=e||Jn,this.options.renderer=this.options.renderer||new Ji,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Lc}static parse(e,t){return new Ra(t).parse(e)}static parseInline(e,t){return new Ra(t).parseInline(e)}parse(e){let t="";for(let r=0;r<e.length;r++){let s=e[r];if(this.options.extensions?.renderers?.[s.type]){let a=s,l=this.options.extensions.renderers[a.type].call({parser:this},a);if(l!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(a.type)){t+=l||"";continue}}let i=s;switch(i.type){case"space":{t+=this.renderer.space(i);break}case"hr":{t+=this.renderer.hr(i);break}case"heading":{t+=this.renderer.heading(i);break}case"code":{t+=this.renderer.code(i);break}case"table":{t+=this.renderer.table(i);break}case"blockquote":{t+=this.renderer.blockquote(i);break}case"list":{t+=this.renderer.list(i);break}case"checkbox":{t+=this.renderer.checkbox(i);break}case"html":{t+=this.renderer.html(i);break}case"def":{t+=this.renderer.def(i);break}case"paragraph":{t+=this.renderer.paragraph(i);break}case"text":{t+=this.renderer.text(i);break}default:{let a='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(a),"";throw new Error(a)}}}return t}parseInline(e,t=this.renderer){let r="";for(let s=0;s<e.length;s++){let i=e[s];if(this.options.extensions?.renderers?.[i.type]){let l=this.options.extensions.renderers[i.type].call({parser:this},i);if(l!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(i.type)){r+=l||"";continue}}let a=i;switch(a.type){case"escape":{r+=t.text(a);break}case"html":{r+=t.html(a);break}case"link":{r+=t.link(a);break}case"image":{r+=t.image(a);break}case"checkbox":{r+=t.checkbox(a);break}case"strong":{r+=t.strong(a);break}case"em":{r+=t.em(a);break}case"codespan":{r+=t.codespan(a);break}case"br":{r+=t.br(a);break}case"del":{r+=t.del(a);break}case"text":{r+=t.text(a);break}default:{let l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return r}},ds=class{options;block;constructor(n){this.options=n||Jn}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens","emStrongMask"]);static passThroughHooksRespectAsync=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(n){return n}postprocess(n){return n}processAllTokens(n){return n}emStrongMask(n){return n}provideLexer(){return this.block?at.lex:at.lexInline}provideParser(){return this.block?ct.parse:ct.parseInline}},TI=class{defaults=kc();options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=ct;Renderer=Ji;TextRenderer=Lc;Lexer=at;Tokenizer=Xi;Hooks=ds;constructor(...n){this.use(...n)}walkTokens(n,e){let t=[];for(let r of n)switch(t=t.concat(e.call(this,r)),r.type){case"table":{let s=r;for(let i of s.header)t=t.concat(this.walkTokens(i.tokens,e));for(let i of s.rows)for(let a of i)t=t.concat(this.walkTokens(a.tokens,e));break}case"list":{let s=r;t=t.concat(this.walkTokens(s.items,e));break}default:{let s=r;this.defaults.extensions?.childTokens?.[s.type]?this.defaults.extensions.childTokens[s.type].forEach(i=>{let a=s[i].flat(1/0);t=t.concat(this.walkTokens(a,e))}):s.tokens&&(t=t.concat(this.walkTokens(s.tokens,e)))}}return t}use(...n){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return n.forEach(t=>{let r={...t};if(r.async=this.defaults.async||r.async||!1,t.extensions&&(t.extensions.forEach(s=>{if(!s.name)throw new Error("extension name required");if("renderer"in s){let i=e.renderers[s.name];i?e.renderers[s.name]=function(...a){let l=s.renderer.apply(this,a);return l===!1&&(l=i.apply(this,a)),l}:e.renderers[s.name]=s.renderer}if("tokenizer"in s){if(!s.level||s.level!=="block"&&s.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let i=e[s.level];i?i.unshift(s.tokenizer):e[s.level]=[s.tokenizer],s.start&&(s.level==="block"?e.startBlock?e.startBlock.push(s.start):e.startBlock=[s.start]:s.level==="inline"&&(e.startInline?e.startInline.push(s.start):e.startInline=[s.start]))}"childTokens"in s&&s.childTokens&&(e.childTokens[s.name]=s.childTokens)}),r.extensions=e),t.renderer){let s=this.defaults.renderer||new Ji(this.defaults);for(let i in t.renderer){if(!(i in s))throw new Error(`renderer '${i}' does not exist`);if(["options","parser"].includes(i))continue;let a=i,l=t.renderer[a],u=s[a];s[a]=(...d)=>{let f=l.apply(s,d);return f===!1&&(f=u.apply(s,d)),f||""}}r.renderer=s}if(t.tokenizer){let s=this.defaults.tokenizer||new Xi(this.defaults);for(let i in t.tokenizer){if(!(i in s))throw new Error(`tokenizer '${i}' does not exist`);if(["options","rules","lexer"].includes(i))continue;let a=i,l=t.tokenizer[a],u=s[a];s[a]=(...d)=>{let f=l.apply(s,d);return f===!1&&(f=u.apply(s,d)),f}}r.tokenizer=s}if(t.hooks){let s=this.defaults.hooks||new ds;for(let i in t.hooks){if(!(i in s))throw new Error(`hook '${i}' does not exist`);if(["options","block"].includes(i))continue;let a=i,l=t.hooks[a],u=s[a];ds.passThroughHooks.has(i)?s[a]=d=>{if(this.defaults.async&&ds.passThroughHooksRespectAsync.has(i))return(async()=>{let g=await l.call(s,d);return u.call(s,g)})();let f=l.call(s,d);return u.call(s,f)}:s[a]=(...d)=>{if(this.defaults.async)return(async()=>{let g=await l.apply(s,d);return g===!1&&(g=await u.apply(s,d)),g})();let f=l.apply(s,d);return f===!1&&(f=u.apply(s,d)),f}}r.hooks=s}if(t.walkTokens){let s=this.defaults.walkTokens,i=t.walkTokens;r.walkTokens=function(a){let l=[];return l.push(i.call(this,a)),s&&(l=l.concat(s.call(this,a))),l}}this.defaults={...this.defaults,...r}}),this}setOptions(n){return this.defaults={...this.defaults,...n},this}lexer(n,e){return at.lex(n,e??this.defaults)}parser(n,e){return ct.parse(n,e??this.defaults)}parseMarkdown(n){return(e,t)=>{let r={...t},s={...this.defaults,...r},i=this.onError(!!s.silent,!!s.async);if(this.defaults.async===!0&&r.async===!1)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return i(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(s.hooks&&(s.hooks.options=s,s.hooks.block=n),s.async)return(async()=>{let a=s.hooks?await s.hooks.preprocess(e):e,l=await(s.hooks?await s.hooks.provideLexer():n?at.lex:at.lexInline)(a,s),u=s.hooks?await s.hooks.processAllTokens(l):l;s.walkTokens&&await Promise.all(this.walkTokens(u,s.walkTokens));let d=await(s.hooks?await s.hooks.provideParser():n?ct.parse:ct.parseInline)(u,s);return s.hooks?await s.hooks.postprocess(d):d})().catch(i);try{s.hooks&&(e=s.hooks.preprocess(e));let a=(s.hooks?s.hooks.provideLexer():n?at.lex:at.lexInline)(e,s);s.hooks&&(a=s.hooks.processAllTokens(a)),s.walkTokens&&this.walkTokens(a,s.walkTokens);let l=(s.hooks?s.hooks.provideParser():n?ct.parse:ct.parseInline)(a,s);return s.hooks&&(l=s.hooks.postprocess(l)),l}catch(a){return i(a)}}}onError(n,e){return t=>{if(t.message+=`
Please report this to https://github.com/markedjs/marked.`,n){let r="<p>An error occurred:</p><pre>"+Lt(t.message+"",!0)+"</pre>";return e?Promise.resolve(r):r}if(e)return Promise.reject(t);throw t}}},Qn=new TI;function re(n,e){return Qn.parse(n,e)}re.options=re.setOptions=function(n){return Qn.setOptions(n),re.defaults=Qn.defaults,$f(re.defaults),re};re.getDefaults=kc;re.defaults=Jn;re.use=function(...n){return Qn.use(...n),re.defaults=Qn.defaults,$f(re.defaults),re};re.walkTokens=function(n,e){return Qn.walkTokens(n,e)};re.parseInline=Qn.parseInline;re.Parser=ct;re.parser=ct.parse;re.Renderer=Ji;re.TextRenderer=Lc;re.Lexer=at;re.lexer=at.lex;re.Tokenizer=Xi;re.Hooks=ds;re.parse=re;re.options;re.setOptions;re.use;re.walkTokens;re.parseInline;ct.parse;at.lex;const{entries:Xf,setPrototypeOf:Hu,isFrozen:EI,getPrototypeOf:wI,getOwnPropertyDescriptor:II}=Object;let{freeze:je,seal:rt,create:Sa}=Object,{apply:ka,construct:Ca}=typeof Reflect<"u"&&Reflect;je||(je=function(e){return e});rt||(rt=function(e){return e});ka||(ka=function(e,t){for(var r=arguments.length,s=new Array(r>2?r-2:0),i=2;i<r;i++)s[i-2]=arguments[i];return e.apply(t,s)});Ca||(Ca=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return new e(...r)});const _i=He(Array.prototype.forEach),vI=He(Array.prototype.lastIndexOf),Gu=He(Array.prototype.pop),rs=He(Array.prototype.push),AI=He(Array.prototype.splice),Ci=He(String.prototype.toLowerCase),Wo=He(String.prototype.toString),Ko=He(String.prototype.match),ss=He(String.prototype.replace),bI=He(String.prototype.indexOf),RI=He(String.prototype.trim),ot=He(Object.prototype.hasOwnProperty),qe=He(RegExp.prototype.test),is=SI(TypeError);function He(n){return function(e){e instanceof RegExp&&(e.lastIndex=0);for(var t=arguments.length,r=new Array(t>1?t-1:0),s=1;s<t;s++)r[s-1]=arguments[s];return ka(n,e,r)}}function SI(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return Ca(n,t)}}function K(n,e){let t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Ci;Hu&&Hu(n,null);let r=e.length;for(;r--;){let s=e[r];if(typeof s=="string"){const i=t(s);i!==s&&(EI(e)||(e[r]=i),s=i)}n[s]=!0}return n}function kI(n){for(let e=0;e<n.length;e++)ot(n,e)||(n[e]=null);return n}function Mt(n){const e=Sa(null);for(const[t,r]of Xf(n))ot(n,t)&&(Array.isArray(r)?e[t]=kI(r):r&&typeof r=="object"&&r.constructor===Object?e[t]=Mt(r):e[t]=r);return e}function os(n,e){for(;n!==null;){const r=II(n,e);if(r){if(r.get)return He(r.get);if(typeof r.value=="function")return He(r.value)}n=wI(n)}function t(){return null}return t}const Wu=je(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","search","section","select","shadow","slot","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),Qo=je(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","enterkeyhint","exportparts","filter","font","g","glyph","glyphref","hkern","image","inputmode","line","lineargradient","marker","mask","metadata","mpath","part","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),Yo=je(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),CI=je(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),Xo=je(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),PI=je(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),Ku=je(["#text"]),Qu=je(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","exportparts","face","for","headers","height","hidden","high","href","hreflang","id","inert","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","part","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","slot","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),Jo=je(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","mask-type","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Yu=je(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),yi=je(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),DI=rt(/\{\{[\w\W]*|[\w\W]*\}\}/gm),NI=rt(/<%[\w\W]*|[\w\W]*%>/gm),xI=rt(/\$\{[\w\W]*/gm),OI=rt(/^data-[\-\w.\u00B7-\uFFFF]+$/),VI=rt(/^aria-[\-\w]+$/),Jf=rt(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp|matrix):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),LI=rt(/^(?:\w+script|data):/i),MI=rt(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),Zf=rt(/^html$/i),UI=rt(/^[a-z][.\w]*(-[.\w]+)+$/i);var Xu=Object.freeze({__proto__:null,ARIA_ATTR:VI,ATTR_WHITESPACE:MI,CUSTOM_ELEMENT:UI,DATA_ATTR:OI,DOCTYPE_NAME:Zf,ERB_EXPR:NI,IS_ALLOWED_URI:Jf,IS_SCRIPT_OR_DATA:LI,MUSTACHE_EXPR:DI,TMPLIT_EXPR:xI});const as={element:1,text:3,progressingInstruction:7,comment:8,document:9},FI=function(){return typeof window>"u"?null:window},$I=function(e,t){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const s="data-tt-policy-suffix";t&&t.hasAttribute(s)&&(r=t.getAttribute(s));const i="dompurify"+(r?"#"+r:"");try{return e.createPolicy(i,{createHTML(a){return a},createScriptURL(a){return a}})}catch{return console.warn("TrustedTypes policy "+i+" could not be created."),null}},Ju=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function ep(){let n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:FI();const e=U=>ep(U);if(e.version="3.3.0",e.removed=[],!n||!n.document||n.document.nodeType!==as.document||!n.Element)return e.isSupported=!1,e;let{document:t}=n;const r=t,s=r.currentScript,{DocumentFragment:i,HTMLTemplateElement:a,Node:l,Element:u,NodeFilter:d,NamedNodeMap:f=n.NamedNodeMap||n.MozNamedAttrMap,HTMLFormElement:g,DOMParser:T,trustedTypes:S}=n,P=u.prototype,V=os(P,"cloneNode"),x=os(P,"remove"),j=os(P,"nextSibling"),G=os(P,"childNodes"),W=os(P,"parentNode");if(typeof a=="function"){const U=t.createElement("template");U.content&&U.content.ownerDocument&&(t=U.content.ownerDocument)}let ee,he="";const{implementation:ie,createNodeIterator:I,createDocumentFragment:m,getElementsByTagName:y}=t,{importNode:v}=r;let E=Ju();e.isSupported=typeof Xf=="function"&&typeof W=="function"&&ie&&ie.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:b,ERB_EXPR:_,TMPLIT_EXPR:Ce,DATA_ATTR:Ct,ARIA_ATTR:bo,IS_SCRIPT_OR_DATA:Ro,ATTR_WHITESPACE:An,CUSTOM_ELEMENT:Zn}=Xu;let{IS_ALLOWED_URI:Hs}=Xu,ge=null;const xr=K({},[...Wu,...Qo,...Yo,...Xo,...Ku]);let Ee=null;const bn=K({},[...Qu,...Jo,...Yu,...yi]);let le=Object.seal(Sa(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Pt=null,Rn=null;const ft=Object.seal(Sa(null,{tagCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeCheck:{writable:!0,configurable:!1,enumerable:!0,value:null}}));let Or=!0,Vr=!0,Gs=!1,Lr=!0,pt=!1,Sn=!0,Dt=!1,kn=!1,Cn=!1,Nt=!1,me=!1,we=!1,Pn=!0,Ws=!1;const Ks="user-content-";let Mr=!0,st=!1,xt={},Ot=null;const er=K({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Qs=null;const Ys=K({},["audio","video","img","source","image","track"]);let tr=null;const Ur=K({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),gt="http://www.w3.org/1998/Math/MathML",Kt="http://www.w3.org/2000/svg",Ye="http://www.w3.org/1999/xhtml";let Ge=Ye,nr=!1,Qt=null;const Xs=K({},[gt,Kt,Ye],Wo);let mt=K({},["mi","mo","mn","ms","mtext"]),Dn=K({},["annotation-xml"]);const Ne=K({},["title","style","font","a","script"]);let Yt=null;const Nn=["application/xhtml+xml","text/html"],xn="text/html";let Ie=null,Xt=null;const Jt=t.createElement("form"),Js=function(w){return w instanceof RegExp||w instanceof Function},Fr=function(){let w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(Xt&&Xt===w)){if((!w||typeof w!="object")&&(w={}),w=Mt(w),Yt=Nn.indexOf(w.PARSER_MEDIA_TYPE)===-1?xn:w.PARSER_MEDIA_TYPE,Ie=Yt==="application/xhtml+xml"?Wo:Ci,ge=ot(w,"ALLOWED_TAGS")?K({},w.ALLOWED_TAGS,Ie):xr,Ee=ot(w,"ALLOWED_ATTR")?K({},w.ALLOWED_ATTR,Ie):bn,Qt=ot(w,"ALLOWED_NAMESPACES")?K({},w.ALLOWED_NAMESPACES,Wo):Xs,tr=ot(w,"ADD_URI_SAFE_ATTR")?K(Mt(Ur),w.ADD_URI_SAFE_ATTR,Ie):Ur,Qs=ot(w,"ADD_DATA_URI_TAGS")?K(Mt(Ys),w.ADD_DATA_URI_TAGS,Ie):Ys,Ot=ot(w,"FORBID_CONTENTS")?K({},w.FORBID_CONTENTS,Ie):er,Pt=ot(w,"FORBID_TAGS")?K({},w.FORBID_TAGS,Ie):Mt({}),Rn=ot(w,"FORBID_ATTR")?K({},w.FORBID_ATTR,Ie):Mt({}),xt=ot(w,"USE_PROFILES")?w.USE_PROFILES:!1,Or=w.ALLOW_ARIA_ATTR!==!1,Vr=w.ALLOW_DATA_ATTR!==!1,Gs=w.ALLOW_UNKNOWN_PROTOCOLS||!1,Lr=w.ALLOW_SELF_CLOSE_IN_ATTR!==!1,pt=w.SAFE_FOR_TEMPLATES||!1,Sn=w.SAFE_FOR_XML!==!1,Dt=w.WHOLE_DOCUMENT||!1,Nt=w.RETURN_DOM||!1,me=w.RETURN_DOM_FRAGMENT||!1,we=w.RETURN_TRUSTED_TYPE||!1,Cn=w.FORCE_BODY||!1,Pn=w.SANITIZE_DOM!==!1,Ws=w.SANITIZE_NAMED_PROPS||!1,Mr=w.KEEP_CONTENT!==!1,st=w.IN_PLACE||!1,Hs=w.ALLOWED_URI_REGEXP||Jf,Ge=w.NAMESPACE||Ye,mt=w.MATHML_TEXT_INTEGRATION_POINTS||mt,Dn=w.HTML_INTEGRATION_POINTS||Dn,le=w.CUSTOM_ELEMENT_HANDLING||{},w.CUSTOM_ELEMENT_HANDLING&&Js(w.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(le.tagNameCheck=w.CUSTOM_ELEMENT_HANDLING.tagNameCheck),w.CUSTOM_ELEMENT_HANDLING&&Js(w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(le.attributeNameCheck=w.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),w.CUSTOM_ELEMENT_HANDLING&&typeof w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(le.allowCustomizedBuiltInElements=w.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),pt&&(Vr=!1),me&&(Nt=!0),xt&&(ge=K({},Ku),Ee=[],xt.html===!0&&(K(ge,Wu),K(Ee,Qu)),xt.svg===!0&&(K(ge,Qo),K(Ee,Jo),K(Ee,yi)),xt.svgFilters===!0&&(K(ge,Yo),K(Ee,Jo),K(Ee,yi)),xt.mathMl===!0&&(K(ge,Xo),K(Ee,Yu),K(Ee,yi))),w.ADD_TAGS&&(typeof w.ADD_TAGS=="function"?ft.tagCheck=w.ADD_TAGS:(ge===xr&&(ge=Mt(ge)),K(ge,w.ADD_TAGS,Ie))),w.ADD_ATTR&&(typeof w.ADD_ATTR=="function"?ft.attributeCheck=w.ADD_ATTR:(Ee===bn&&(Ee=Mt(Ee)),K(Ee,w.ADD_ATTR,Ie))),w.ADD_URI_SAFE_ATTR&&K(tr,w.ADD_URI_SAFE_ATTR,Ie),w.FORBID_CONTENTS&&(Ot===er&&(Ot=Mt(Ot)),K(Ot,w.FORBID_CONTENTS,Ie)),Mr&&(ge["#text"]=!0),Dt&&K(ge,["html","head","body"]),ge.table&&(K(ge,["tbody"]),delete Pt.tbody),w.TRUSTED_TYPES_POLICY){if(typeof w.TRUSTED_TYPES_POLICY.createHTML!="function")throw is('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof w.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw is('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');ee=w.TRUSTED_TYPES_POLICY,he=ee.createHTML("")}else ee===void 0&&(ee=$I(S,s)),ee!==null&&typeof he=="string"&&(he=ee.createHTML(""));je&&je(w),Xt=w}},On=K({},[...Qo,...Yo,...CI]),$r=K({},[...Xo,...PI]),Zs=function(w){let D=W(w);(!D||!D.tagName)&&(D={namespaceURI:Ge,tagName:"template"});const M=Ci(w.tagName),te=Ci(D.tagName);return Qt[w.namespaceURI]?w.namespaceURI===Kt?D.namespaceURI===Ye?M==="svg":D.namespaceURI===gt?M==="svg"&&(te==="annotation-xml"||mt[te]):!!On[M]:w.namespaceURI===gt?D.namespaceURI===Ye?M==="math":D.namespaceURI===Kt?M==="math"&&Dn[te]:!!$r[M]:w.namespaceURI===Ye?D.namespaceURI===Kt&&!Dn[te]||D.namespaceURI===gt&&!mt[te]?!1:!$r[M]&&(Ne[M]||!On[M]):!!(Yt==="application/xhtml+xml"&&Qt[w.namespaceURI]):!1},We=function(w){rs(e.removed,{element:w});try{W(w).removeChild(w)}catch{x(w)}},Xe=function(w,D){try{rs(e.removed,{attribute:D.getAttributeNode(w),from:D})}catch{rs(e.removed,{attribute:null,from:D})}if(D.removeAttribute(w),w==="is")if(Nt||me)try{We(D)}catch{}else try{D.setAttribute(w,"")}catch{}},ei=function(w){let D=null,M=null;if(Cn)w="<remove></remove>"+w;else{const fe=Ko(w,/^[\r\n\t ]+/);M=fe&&fe[0]}Yt==="application/xhtml+xml"&&Ge===Ye&&(w='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+w+"</body></html>");const te=ee?ee.createHTML(w):w;if(Ge===Ye)try{D=new T().parseFromString(te,Yt)}catch{}if(!D||!D.documentElement){D=ie.createDocument(Ge,"template",null);try{D.documentElement.innerHTML=nr?he:te}catch{}}const ve=D.body||D.documentElement;return w&&M&&ve.insertBefore(t.createTextNode(M),ve.childNodes[0]||null),Ge===Ye?y.call(D,Dt?"html":"body")[0]:Dt?D.documentElement:ve},it=function(w){return I.call(w.ownerDocument||w,w,d.SHOW_ELEMENT|d.SHOW_COMMENT|d.SHOW_TEXT|d.SHOW_PROCESSING_INSTRUCTION|d.SHOW_CDATA_SECTION,null)},rr=function(w){return w instanceof g&&(typeof w.nodeName!="string"||typeof w.textContent!="string"||typeof w.removeChild!="function"||!(w.attributes instanceof f)||typeof w.removeAttribute!="function"||typeof w.setAttribute!="function"||typeof w.namespaceURI!="string"||typeof w.insertBefore!="function"||typeof w.hasChildNodes!="function")},Br=function(w){return typeof l=="function"&&w instanceof l};function Je(U,w,D){_i(U,M=>{M.call(e,w,D,Xt)})}const sr=function(w){let D=null;if(Je(E.beforeSanitizeElements,w,null),rr(w))return We(w),!0;const M=Ie(w.nodeName);if(Je(E.uponSanitizeElement,w,{tagName:M,allowedTags:ge}),Sn&&w.hasChildNodes()&&!Br(w.firstElementChild)&&qe(/<[/\w!]/g,w.innerHTML)&&qe(/<[/\w!]/g,w.textContent)||w.nodeType===as.progressingInstruction||Sn&&w.nodeType===as.comment&&qe(/<[/\w]/g,w.data))return We(w),!0;if(!(ft.tagCheck instanceof Function&&ft.tagCheck(M))&&(!ge[M]||Pt[M])){if(!Pt[M]&&ti(M)&&(le.tagNameCheck instanceof RegExp&&qe(le.tagNameCheck,M)||le.tagNameCheck instanceof Function&&le.tagNameCheck(M)))return!1;if(Mr&&!Ot[M]){const te=W(w)||w.parentNode,ve=G(w)||w.childNodes;if(ve&&te){const fe=ve.length;for(let xe=fe-1;xe>=0;--xe){const tt=V(ve[xe],!0);tt.__removalCount=(w.__removalCount||0)+1,te.insertBefore(tt,j(w))}}}return We(w),!0}return w instanceof u&&!Zs(w)||(M==="noscript"||M==="noembed"||M==="noframes")&&qe(/<\/no(script|embed|frames)/i,w.innerHTML)?(We(w),!0):(pt&&w.nodeType===as.text&&(D=w.textContent,_i([b,_,Ce],te=>{D=ss(D,te," ")}),w.textContent!==D&&(rs(e.removed,{element:w.cloneNode()}),w.textContent=D)),Je(E.afterSanitizeElements,w,null),!1)},qr=function(w,D,M){if(Pn&&(D==="id"||D==="name")&&(M in t||M in Jt))return!1;if(!(Vr&&!Rn[D]&&qe(Ct,D))){if(!(Or&&qe(bo,D))){if(!(ft.attributeCheck instanceof Function&&ft.attributeCheck(D,w))){if(!Ee[D]||Rn[D]){if(!(ti(w)&&(le.tagNameCheck instanceof RegExp&&qe(le.tagNameCheck,w)||le.tagNameCheck instanceof Function&&le.tagNameCheck(w))&&(le.attributeNameCheck instanceof RegExp&&qe(le.attributeNameCheck,D)||le.attributeNameCheck instanceof Function&&le.attributeNameCheck(D,w))||D==="is"&&le.allowCustomizedBuiltInElements&&(le.tagNameCheck instanceof RegExp&&qe(le.tagNameCheck,M)||le.tagNameCheck instanceof Function&&le.tagNameCheck(M))))return!1}else if(!tr[D]){if(!qe(Hs,ss(M,An,""))){if(!((D==="src"||D==="xlink:href"||D==="href")&&w!=="script"&&bI(M,"data:")===0&&Qs[w])){if(!(Gs&&!qe(Ro,ss(M,An,"")))){if(M)return!1}}}}}}}return!0},ti=function(w){return w!=="annotation-xml"&&Ko(w,Zn)},zr=function(w){Je(E.beforeSanitizeAttributes,w,null);const{attributes:D}=w;if(!D||rr(w))return;const M={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:Ee,forceKeepAttr:void 0};let te=D.length;for(;te--;){const ve=D[te],{name:fe,namespaceURI:xe,value:tt}=ve,Vt=Ie(fe),Vn=tt;let _e=fe==="value"?Vn:RI(Vn);if(M.attrName=Vt,M.attrValue=_e,M.keepAttr=!0,M.forceKeepAttr=void 0,Je(E.uponSanitizeAttribute,w,M),_e=M.attrValue,Ws&&(Vt==="id"||Vt==="name")&&(Xe(fe,w),_e=Ks+_e),Sn&&qe(/((--!?|])>)|<\/(style|title|textarea)/i,_e)){Xe(fe,w);continue}if(Vt==="attributename"&&Ko(_e,"href")){Xe(fe,w);continue}if(M.forceKeepAttr)continue;if(!M.keepAttr){Xe(fe,w);continue}if(!Lr&&qe(/\/>/i,_e)){Xe(fe,w);continue}pt&&_i([b,_,Ce],Hr=>{_e=ss(_e,Hr," ")});const jr=Ie(w.nodeName);if(!qr(jr,Vt,_e)){Xe(fe,w);continue}if(ee&&typeof S=="object"&&typeof S.getAttributeType=="function"&&!xe)switch(S.getAttributeType(jr,Vt)){case"TrustedHTML":{_e=ee.createHTML(_e);break}case"TrustedScriptURL":{_e=ee.createScriptURL(_e);break}}if(_e!==Vn)try{xe?w.setAttributeNS(xe,fe,_e):w.setAttribute(fe,_e),rr(w)?We(w):Gu(e.removed)}catch{Xe(fe,w)}}Je(E.afterSanitizeAttributes,w,null)},So=function U(w){let D=null;const M=it(w);for(Je(E.beforeSanitizeShadowDOM,w,null);D=M.nextNode();)Je(E.uponSanitizeShadowNode,D,null),sr(D),zr(D),D.content instanceof i&&U(D.content);Je(E.afterSanitizeShadowDOM,w,null)};return e.sanitize=function(U){let w=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},D=null,M=null,te=null,ve=null;if(nr=!U,nr&&(U="<!-->"),typeof U!="string"&&!Br(U))if(typeof U.toString=="function"){if(U=U.toString(),typeof U!="string")throw is("dirty is not a string, aborting")}else throw is("toString is not a function");if(!e.isSupported)return U;if(kn||Fr(w),e.removed=[],typeof U=="string"&&(st=!1),st){if(U.nodeName){const tt=Ie(U.nodeName);if(!ge[tt]||Pt[tt])throw is("root node is forbidden and cannot be sanitized in-place")}}else if(U instanceof l)D=ei("<!---->"),M=D.ownerDocument.importNode(U,!0),M.nodeType===as.element&&M.nodeName==="BODY"||M.nodeName==="HTML"?D=M:D.appendChild(M);else{if(!Nt&&!pt&&!Dt&&U.indexOf("<")===-1)return ee&&we?ee.createHTML(U):U;if(D=ei(U),!D)return Nt?null:we?he:""}D&&Cn&&We(D.firstChild);const fe=it(st?U:D);for(;te=fe.nextNode();)sr(te),zr(te),te.content instanceof i&&So(te.content);if(st)return U;if(Nt){if(me)for(ve=m.call(D.ownerDocument);D.firstChild;)ve.appendChild(D.firstChild);else ve=D;return(Ee.shadowroot||Ee.shadowrootmode)&&(ve=v.call(r,ve,!0)),ve}let xe=Dt?D.outerHTML:D.innerHTML;return Dt&&ge["!doctype"]&&D.ownerDocument&&D.ownerDocument.doctype&&D.ownerDocument.doctype.name&&qe(Zf,D.ownerDocument.doctype.name)&&(xe="<!DOCTYPE "+D.ownerDocument.doctype.name+`>
`+xe),pt&&_i([b,_,Ce],tt=>{xe=ss(xe,tt," ")}),ee&&we?ee.createHTML(xe):xe},e.setConfig=function(){let U=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Fr(U),kn=!0},e.clearConfig=function(){Xt=null,kn=!1},e.isValidAttribute=function(U,w,D){Xt||Fr({});const M=Ie(U),te=Ie(w);return qr(M,te,D)},e.addHook=function(U,w){typeof w=="function"&&rs(E[U],w)},e.removeHook=function(U,w){if(w!==void 0){const D=vI(E[U],w);return D===-1?void 0:AI(E[U],D,1)[0]}return Gu(E[U])},e.removeHooks=function(U){E[U]=[]},e.removeAllHooks=function(){E=Ju()},e}var BI=ep();re.setOptions({breaks:!0,gfm:!0});function tp(n){const e=re.parse(n);return BI.sanitize(e)}function qI(n,e){const t=document.createElement("div");t.innerHTML=n;const r=[...e].sort((i,a)=>a.startOffset-i.startOffset),s=t.textContent||"";for(const i of r)try{zI(t,i,s)}catch(a){console.error("Failed to apply highlight:",i.id,a)}return t.innerHTML}function zI(n,e,t){const{startOffset:r,endOffset:s,id:i,color:a,selectedText:l}=e,u=t.substring(r,s);u!==l&&console.warn(`Highlight text mismatch for ${i}. Expected: "${l}", Got: "${u}"`);const d=Zu(n,r),f=Zu(n,s);if(!d||!f){console.error("Could not find nodes for highlight:",i);return}const g=document.createRange();g.setStart(d.node,d.offset),g.setEnd(f.node,f.offset);const T=document.createElement("mark");T.id=`highlight-${i}`,T.className="highlight",T.dataset.highlightId=i,a&&(T.style.backgroundColor=a);try{g.surroundContents(T)}catch{const P=g.extractContents();T.appendChild(P),g.insertNode(T)}}function Zu(n,e){let t=0;function r(s){if(s.nodeType===Node.TEXT_NODE){const i=s.textContent?.length||0;if(t+i>=e)return{node:s,offset:e-t};t+=i}else if(s.nodeType===Node.ELEMENT_NODE)for(const i of Array.from(s.childNodes)){const a=r(i);if(a)return a}return null}return r(n)}function eh(n,e,t){let r=0;function s(a){if(a===e)return r+t;if(a.nodeType===Node.TEXT_NODE)r+=a.textContent?.length||0;else if(a.nodeType===Node.ELEMENT_NODE)for(const l of Array.from(a.childNodes)){const u=s(l);if(u!==null)return u}return null}const i=s(n);return i!==null?i:-1}function np(n){const e=n.match(/^#\s+(.+)$/m);if(e)return e[1].trim();const t=n.split(`
`).find(r=>r.trim().length>0);return t?t.trim().substring(0,100):"Untitled"}function jI(n){const e=window.getSelection();if(!e||e.isCollapsed||e.rangeCount===0)return null;const t=e.getRangeAt(0);if(!n.contains(t.commonAncestorContainer))return null;const r=t.toString().trim();if(!r)return null;const s=eh(n,t.startContainer,t.startOffset),i=eh(n,t.endContainer,t.endOffset);return s===-1||i===-1?(console.error("Could not calculate offsets for selection"),null):{startOffset:s,endOffset:i,selectedText:r}}function HI(n,e,t){return{id:Lf(),startOffset:n.startOffset,endOffset:n.endOffset,selectedText:n.selectedText,annotation:e,color:"#ffeb3b",createdAt:new Date}}function th(){const n=window.getSelection();n&&n.removeAllRanges()}function GI(n,e){const t=r=>{const i=r.target.closest("[data-highlight-id]");if(i){const a=i.dataset.highlightId;a&&(r.preventDefault(),e(a))}};return n.addEventListener("click",t),()=>{n.removeEventListener("click",t)}}function nh(n){const e=document.getElementById(`highlight-${n}`);e&&e.scrollIntoView({behavior:"smooth",block:"center"})}function rh(n){document.querySelectorAll(".highlight").forEach(t=>{t.classList.remove("emphasized")});const e=document.getElementById(`highlight-${n}`);e&&e.classList.add("emphasized")}function sh(n,e){const{user:t,gist:r,viewMode:s,isOwner:i}=n,a=t?`
      <div class="user-info">
        ${t.photoURL?`<img src="${t.photoURL}" alt="${t.displayName}" class="user-avatar">`:""}
        <span class="user-name">${t.displayName||t.email}</span>
        <button class="btn-secondary" data-action="sign-out">Sign Out</button>
      </div>
    `:`
      <button class="btn-primary" data-action="sign-in">Sign In with Google</button>
    `;return`
    <header class="app-header">
      <div class="header-left">
        <h1 class="app-title"><a href="#/" data-action="home">Sideshow</a></h1>
        ${i&&r?`
      <div class="editor-controls">
        <button class="btn-tab ${s==="edit"?"active":""}" data-action="mode-edit">Edit</button>
        <button class="btn-tab ${s==="preview"?"active":""}" data-action="mode-preview">Preview</button>
        <button class="btn-primary" data-action="save">Save</button>
        <button class="btn-secondary" data-action="share">Share</button>
      </div>
    `:""}
      </div>
      <div class="header-right">
        ${a}
      </div>
    </header>
  `}function WI(n,e){return n?`
    <div class="home">
      <div class="home-header">
        <h2>My Gists</h2>
        <button class="btn-primary" data-action="create">Create New Gist</button>
      </div>
      <div class="gist-list">
        ${e.length>0?e.map(r=>{const s=r.title||np(r.markdown),i=r.updatedAt.toLocaleDateString(),a=r.highlights.length;return`
          <div class="gist-item">
            <a href="#/${r.id}" class="gist-link">
              <h3>${Cs(s)}</h3>
              <div class="gist-meta">
                <span>${i}</span>
                <span>${a} highlight${a!==1?"s":""}</span>
              </div>
            </a>
          </div>
        `}).join(""):'<p class="empty-state">No gists yet. Create your first one!</p>'}
      </div>
    </div>
  `:`
      <div class="welcome">
        <h2>Welcome to Sideshow</h2>
        <p>Create annotated markdown documents with highlights and sidenotes.</p>
        <p>Sign in to get started.</p>
      </div>
    `}function KI(n){const{gist:e,viewMode:t,isOwner:r}=n;if(!e)return'<div class="error">Gist not found</div>';const s=!r;if(t==="edit")return`
      <div class="editor-container">
        <textarea
          id="markdown-editor"
          class="markdown-editor"
          placeholder="Paste your markdown here..."
          ${s?"readonly":""}
        >${Cs(e.markdown)}</textarea>
      </div>
    `;{const i=tp(e.markdown);return`
      <div class="preview-container">
        <div class="preview-content" id="preview-content">
          ${qI(i,e.highlights)}
        </div>
        <div class="annotations-panel" id="annotations-panel">
          ${QI(e,n.selectedHighlightId)}
        </div>
      </div>
    `}}function QI(n,e){return n.highlights.length===0?`
      <div class="annotations-empty">
        <p>No highlights yet.</p>
        <p class="help-text">Select text to create a highlight and add annotations.</p>
      </div>
    `:`
    <div class="annotations-list">
      <h3>Annotations</h3>
      ${[...n.highlights].sort((r,s)=>r.startOffset-s.startOffset).map(r=>YI(r,r.id===e)).join("")}
    </div>
  `}function YI(n,e){const r=n.selectedText.length>60?n.selectedText.substring(0,60)+"...":n.selectedText,s=tp(n.annotation);return`
    <div class="annotation-item ${e?"selected":""}" data-highlight-id="${n.id}">
      <div class="annotation-excerpt">"${Cs(r)}"</div>
      <div class="annotation-content">${s}</div>
      <div class="annotation-actions">
        <button class="btn-text" data-action="edit-annotation" data-highlight-id="${n.id}">Edit</button>
        <button class="btn-text" data-action="delete-highlight" data-highlight-id="${n.id}">Delete</button>
      </div>
    </div>
  `}function ih(n,e,t,r){const s=document.createElement("div");s.className="modal",s.innerHTML=`
    <div class="modal-content">
      <h3>Add Annotation</h3>
      <div class="modal-excerpt">"${Cs(n.substring(0,100))}${n.length>100?"...":""}"</div>
      <textarea
        id="annotation-input"
        class="annotation-input"
        placeholder="Enter your annotation (markdown supported)..."
      >${Cs(e||"")}</textarea>
      <div class="modal-actions">
        <button class="btn-primary" id="save-annotation">Save</button>
        <button class="btn-secondary" id="cancel-annotation">Cancel</button>
      </div>
    </div>
  `,document.body.appendChild(s);const i=s.querySelector("#annotation-input"),a=s.querySelector("#save-annotation"),l=s.querySelector("#cancel-annotation");i.focus();const u=()=>{s.remove()};a.onclick=()=>{const f=i.value.trim();f&&t&&t(f),u()},l.onclick=()=>{r&&r(),u()},s.onclick=f=>{f.target===s&&(r&&r(),u())};const d=f=>{f.key==="Escape"&&(r&&r(),u(),document.removeEventListener("keydown",d))};document.addEventListener("keydown",d)}function XI(n){const e=Lw(n),t=document.createElement("div");t.className="modal",t.innerHTML=`
    <div class="modal-content">
      <h3>Share Gist</h3>
      <p>Anyone with this link can view your gist:</p>
      <div class="share-url-container">
        <input type="text" class="share-url" value="${e}" readonly id="share-url">
        <button class="btn-primary" id="copy-url">Copy</button>
      </div>
      <div class="modal-actions">
        <button class="btn-secondary" id="close-share">Close</button>
      </div>
    </div>
  `,document.body.appendChild(t);const r=t.querySelector("#share-url"),s=t.querySelector("#copy-url"),i=t.querySelector("#close-share");r.select(),s.onclick=async()=>{try{await navigator.clipboard.writeText(e),s.textContent="Copied!",setTimeout(()=>{s.textContent="Copy"},2e3)}catch(l){console.error("Failed to copy:",l),alert("Failed to copy URL")}};const a=()=>{t.remove()};i.onclick=a,t.onclick=l=>{l.target===t&&a()}}function JI(n,e){const t=[];if(n.viewMode==="preview"&&n.gist&&n.isOwner){const s=document.getElementById("preview-content");if(s){const i=()=>{const l=jI(s);l&&ih(l.selectedText,void 0,async u=>{const d=HI(l,u);n.gist&&(await Uu(n.gist.id,d),n.gist.highlights.push(d),e({gist:n.gist})),th()},()=>{th()})};s.addEventListener("mouseup",i),t.push(()=>s.removeEventListener("mouseup",i));const a=GI(s,l=>{e({selectedHighlightId:l}),rh(l),nh(l)});t.push(a)}}const r=document.getElementById("annotations-panel");if(r){const s=async a=>{const l=a.target,u=l.dataset.action,d=l.dataset.highlightId;if(!(!u||!d||!n.gist)){if(u==="delete-highlight")confirm("Delete this highlight?")&&(await Ow(n.gist.id,d),n.gist.highlights=n.gist.highlights.filter(f=>f.id!==d),e({gist:n.gist,selectedHighlightId:null}));else if(u==="edit-annotation"){const f=n.gist.highlights.find(g=>g.id===d);f&&ih(f.selectedText,f.annotation,async g=>{f.annotation=g,await Uu(n.gist.id,f),e({gist:n.gist})})}}};r.addEventListener("click",s),t.push(()=>r.removeEventListener("click",s));const i=a=>{const u=a.target.closest(".annotation-item");if(u){const d=u.dataset.highlightId;d&&(e({selectedHighlightId:d}),rh(d),nh(d))}};r.addEventListener("click",i),t.push(()=>r.removeEventListener("click",i))}return()=>{t.forEach(s=>s())}}function Cs(n){const e=document.createElement("div");return e.textContent=n,e.innerHTML}let Q={user:null,gist:null,viewMode:"preview",isOwner:!1,selectedHighlightId:null},Pa=[];async function oh(){kw(e=>{Q.user=e,kt()}),Vw(e=>{ah(e)});const n=Ff();await ah(n)}async function ah(n){switch(Pa.forEach(e=>e()),Pa=[],n.type){case"home":await ZI();break;case"create":await rp();break;case"edit":await ev(n.gistId);break;case"view":await tv(n.gistId);break}}async function ZI(){Q.gist=null,Q.isOwner=!1;const n=Q.user?await xw(Q.user.uid):[];kt(WI(Q.user,n))}async function rp(){if(!Q.user){alert("Please sign in to create a gist"),Ar({type:"home"});return}const n=await Nw(`# New Gist

Start writing...`,Q.user.uid,"New Gist");Ar({type:"edit",gistId:n.id})}async function ev(n){if(!Q.user){Ar({type:"view",gistId:n});return}const e=await Io(n);if(!e){kt('<div class="error">Gist not found</div>');return}if(e.createdBy!==Q.user.uid){Ar({type:"view",gistId:n});return}Q.gist=e,Q.isOwner=!0,Q.viewMode="preview",kt()}async function tv(n){const e=await Io(n);if(!e){kt('<div class="error">Gist not found</div>');return}Q.gist=e,Q.isOwner=Q.user?.uid===e.createdBy,Q.viewMode="preview",kt()}function nv(n){Q={...Q,...n},kt()}function kt(n){const e=document.querySelector("#app");if(n){e.innerHTML=`
      ${sh(Q)}
      <main>${n}</main>
    `,ch();return}const t=Q.gist?KI(Q):"";if(e.innerHTML=`
    ${sh(Q)}
    <main>${t}</main>
  `,ch(),Q.gist){const r=JI(Q,nv);Pa.push(r)}}function ch(){document.querySelectorAll("[data-action]").forEach(n=>{n.addEventListener("click",e=>{e.preventDefault();const t=n.dataset.action;t&&rv(t)})})}async function rv(n){switch(n){case"sign-in":try{await Rw()}catch(e){console.error("Sign in failed:",e),alert("Failed to sign in. Please try again.")}break;case"sign-out":try{await Sw(),Ar({type:"home"})}catch(e){console.error("Sign out failed:",e)}break;case"home":Ar({type:"home"});break;case"create":await rp();break;case"mode-edit":Q.viewMode="edit",kt();break;case"mode-preview":Q.viewMode="preview",kt();break;case"save":await sv();break;case"share":Q.gist&&XI(Q.gist.id);break}}async function sv(){if(!(!Q.gist||!Q.isOwner))try{if(Q.viewMode==="edit"){const n=document.querySelector("#markdown-editor");n&&(Q.gist.markdown=n.value,Q.gist.title=np(n.value))}await Sc(Q.gist),alert("Gist saved successfully!"),Q.viewMode==="edit"&&(Q.viewMode="preview",kt())}catch(n){console.error("Failed to save gist:",n),alert("Failed to save gist. Please try again.")}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",oh):oh();
