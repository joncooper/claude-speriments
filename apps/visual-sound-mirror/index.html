<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Sound Mirror</title>
    <link rel="stylesheet" href="styles.css">
    <!-- MediaPipe for hand tracking -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        <video id="video" autoplay playsinline muted></video>

        <div id="overlay" class="active">
            <div id="welcome">
                <h1>Visual Sound Mirror</h1>
                <p>A hands-free interactive music instrument. Use hand gestures to switch modes and control sound - no keyboard required!</p>
                <button id="startButton">Begin Experience</button>
                <p class="hint">Camera and audio permissions required</p>
            </div>
        </div>

        <div id="controls">
            <div class="mode-switcher">
                <button class="mode-btn" data-mode="ribbons" title="Ribbons Mode (Show 1 finger)">ğŸ¨</button>
                <button class="mode-btn" data-mode="theremin" title="Theremin Mode (Show 2 fingers)">ğŸµ</button>
                <button class="mode-btn" data-mode="pads" title="Sample Pads Mode (Show 5 fingers)">ğŸ¥</button>
            </div>
            <div class="control-buttons">
                <button id="muteButton" title="Toggle Audio">ğŸ”Š</button>
                <button id="debugButton" title="Toggle Debug">ğŸ”</button>
                <button id="infoButton" title="Info">â„¹ï¸</button>
            </div>
        </div>

        <div id="debug" class="hidden">
            <div class="debug-panel">
                <h3>Debug Info</h3>
                <p>Motion Intensity: <span id="debugMotion">0</span></p>
                <p>Position: <span id="debugPosition">0, 0</span></p>
                <p>Particles: <span id="debugParticles">0</span></p>
                <p>Audio: <span id="debugAudio">Initializing...</span></p>
                <p>Hands Detected: <span id="debugHands">0</span></p>
            </div>
        </div>

        <div id="info" class="hidden">
            <div class="info-content">
                <h2>Visual Sound Mirror - v6.2</h2>
                <h3>Hands-Free Edition</h3>

                <h4>Mode Switching (Right Hand Gestures)</h4>
                <p><strong>Hold gesture steady for 2.5 seconds to switch modes:</strong></p>
                <ul>
                    <li><strong>1 finger:</strong> Ribbons Mode ğŸ¨</li>
                    <li><strong>2 fingers (peace sign):</strong> Theremin Mode ğŸµ</li>
                    <li><strong>5 fingers (open hand):</strong> Sample Pads Mode ğŸ¥</li>
                </ul>
                <p><em>A circular progress indicator shows when gesture is being held.</em></p>

                <h4>Modes</h4>
                <ul>
                    <li><strong>ğŸ¨ Ribbons:</strong> Flowing silk ribbons from your fingertips. Tap pads with each finger for different sounds.</li>
                    <li><strong>ğŸµ Theremin:</strong> Play melodies with hand position. X-axis = pitch (quantized to scale), Y-axis = filter brightness.</li>
                    <li><strong>ğŸ¥ Sample Pads:</strong> Tap the arc-based pads with your fingertips - 5 pads per finger, 25 total sounds.</li>
                </ul>

                <h4>Global Controls (Always Active)</h4>
                <ul>
                    <li><strong>Knobs (top-left):</strong> Pinch thumb + index inside any knob to rotate. Controls Filter, Reverb, Delay, Resonance.</li>
                    <li><strong>ğŸ”Š button:</strong> Toggle audio on/off</li>
                    <li><strong>ğŸ” button:</strong> Toggle debug mode (shows hand tracking)</li>
                </ul>

                <h4>Gestures</h4>
                <ul>
                    <li><strong>Tap:</strong> Move finger forward (toward camera) to trigger pads</li>
                    <li><strong>Pinch:</strong> Thumb + index to control knobs</li>
                    <li><strong>Touch fingertips:</strong> Create harmonic chords (Ribbons mode)</li>
                </ul>

                <p class="privacy">ğŸ”’ All processing happens locally - no data is recorded or transmitted</p>
                <button id="closeInfo">Close</button>
            </div>
        </div>

        <div id="status"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
